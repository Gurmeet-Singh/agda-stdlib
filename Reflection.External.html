<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Reflection.External</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- The Agda standard library</a>
<a id="103" class="Comment">--</a>
<a id="106" class="Comment">-- Support for system calls as part of reflection</a>
<a id="156" class="Comment">------------------------------------------------------------------------</a>

<a id="230" class="Symbol">{-#</a> <a id="234" class="Keyword">OPTIONS</a> <a id="242" class="Pragma">--cubical-compatible</a> <a id="263" class="Pragma">--safe</a> <a id="270" class="Symbol">#-}</a>

<a id="275" class="Keyword">module</a> <a id="282" href="Reflection.External.html" class="Module">Reflection.External</a> <a id="302" class="Keyword">where</a>

<a id="309" class="Keyword">import</a> <a id="316" href="Agda.Builtin.Reflection.External.html" class="Module">Agda.Builtin.Reflection.External</a> <a id="349" class="Symbol">as</a> <a id="352" class="Module">Builtin</a>

<a id="361" class="Keyword">open</a> <a id="366" class="Keyword">import</a> <a id="373" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a> <a id="387" class="Keyword">using</a> <a id="393" class="Symbol">(</a><a id="394" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a><a id="395" class="Symbol">;</a> <a id="397" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a><a id="400" class="Symbol">;</a> <a id="402" href="Agda.Builtin.Nat.html#204" class="InductiveConstructor">zero</a><a id="406" class="Symbol">;</a> <a id="408" href="Data.Nat.Base.html#2570" class="Record">NonZero</a><a id="415" class="Symbol">)</a>
<a id="417" class="Keyword">open</a> <a id="422" class="Keyword">import</a> <a id="429" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="444" class="Keyword">using</a> <a id="450" class="Symbol">(</a><a id="451" href="Agda.Builtin.List.html#130" class="Datatype">List</a><a id="455" class="Symbol">;</a> <a id="457" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">_∷_</a><a id="460" class="Symbol">;</a> <a id="462" href="Data.List.Base.html#7375" class="InductiveConstructor">[]</a><a id="464" class="Symbol">)</a>
<a id="466" class="Keyword">open</a> <a id="471" class="Keyword">import</a> <a id="478" href="Data.Product.html" class="Module">Data.Product</a> <a id="491" class="Keyword">using</a> <a id="497" class="Symbol">(</a><a id="498" href="Data.Product.Base.html#1618" class="Function Operator">_×_</a><a id="501" class="Symbol">;</a> <a id="503" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">_,_</a><a id="506" class="Symbol">)</a>
<a id="508" class="Keyword">open</a> <a id="513" class="Keyword">import</a> <a id="520" href="Data.String.Base.html" class="Module">Data.String.Base</a> <a id="537" class="Symbol">as</a> <a id="540" class="Module">String</a> <a id="547" class="Keyword">using</a> <a id="553" class="Symbol">(</a><a id="554" href="Agda.Builtin.String.html#318" class="Postulate">String</a><a id="560" class="Symbol">;</a> <a id="562" href="Data.String.Base.html#2400" class="Function Operator">_++_</a><a id="566" class="Symbol">)</a>
<a id="568" class="Keyword">open</a> <a id="573" class="Keyword">import</a> <a id="580" href="Data.Sum.html" class="Module">Data.Sum</a> <a id="589" class="Keyword">using</a> <a id="595" class="Symbol">(</a><a id="596" href="Data.Sum.Base.html#625" class="Datatype Operator">_⊎_</a><a id="599" class="Symbol">;</a> <a id="601" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a><a id="605" class="Symbol">;</a> <a id="607" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a><a id="611" class="Symbol">;</a> <a id="613" href="Data.Sum.Base.html#811" class="Function Operator">[_,_]</a><a id="618" class="Symbol">)</a>
<a id="620" class="Keyword">open</a> <a id="625" class="Keyword">import</a> <a id="632" href="Data.Unit.Base.html" class="Module">Data.Unit.Base</a> <a id="647" class="Keyword">using</a> <a id="653" class="Symbol">(</a><a id="654" href="Agda.Builtin.Unit.html#158" class="Record">⊤</a><a id="655" class="Symbol">;</a> <a id="657" href="Agda.Builtin.Unit.html#195" class="InductiveConstructor">tt</a><a id="659" class="Symbol">)</a>
<a id="661" class="Keyword">open</a> <a id="666" class="Keyword">import</a> <a id="673" href="Function.Base.html" class="Module">Function.Base</a> <a id="687" class="Keyword">using</a> <a id="693" class="Symbol">(</a><a id="694" href="Function.Base.html#4062" class="Function Operator">case_of_</a><a id="702" class="Symbol">;</a> <a id="704" href="Function.Base.html#2003" class="Function Operator">_$_</a><a id="707" class="Symbol">;</a> <a id="709" href="Function.Base.html#1115" class="Function Operator">_∘_</a><a id="712" class="Symbol">)</a>
<a id="714" class="Keyword">open</a> <a id="719" class="Keyword">import</a> <a id="726" href="Reflection.html" class="Module">Reflection</a> <a id="737" class="Keyword">hiding</a> <a id="744" class="Symbol">(</a><a id="745" href="Agda.Builtin.Reflection.html#4266" class="InductiveConstructor">name</a><a id="749" class="Symbol">)</a>

<a id="752" class="Comment">-- Type aliases for the various strings.</a>

<a id="CmdName"></a><a id="794" href="Reflection.External.html#794" class="Function">CmdName</a> <a id="802" class="Symbol">=</a> <a id="804" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
<a id="StdIn"></a><a id="811" href="Reflection.External.html#811" class="Function">StdIn</a>   <a id="819" class="Symbol">=</a> <a id="821" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
<a id="StdErr"></a><a id="828" href="Reflection.External.html#828" class="Function">StdErr</a>  <a id="836" class="Symbol">=</a> <a id="838" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
<a id="StdOut"></a><a id="845" href="Reflection.External.html#845" class="Function">StdOut</a>  <a id="853" class="Symbol">=</a> <a id="855" href="Agda.Builtin.String.html#318" class="Postulate">String</a>

<a id="863" class="Comment">-- Representation for exit codes, assuming 0 is consistently used to indicate</a>
<a id="941" class="Comment">-- success across platforms.</a>
<a id="970" class="Keyword">data</a> <a id="ExitCode"></a><a id="975" href="Reflection.External.html#975" class="Datatype">ExitCode</a> <a id="984" class="Symbol">:</a> <a id="986" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="990" class="Keyword">where</a>
  <a id="ExitCode.exitSuccess"></a><a id="998" href="Reflection.External.html#998" class="InductiveConstructor">exitSuccess</a> <a id="1010" class="Symbol">:</a> <a id="1012" href="Reflection.External.html#975" class="Datatype">ExitCode</a>
  <a id="ExitCode.exitFailure"></a><a id="1023" href="Reflection.External.html#1023" class="InductiveConstructor">exitFailure</a> <a id="1035" class="Symbol">:</a> <a id="1037" class="Symbol">(</a><a id="1038" href="Reflection.External.html#1038" class="Bound">n</a> <a id="1040" class="Symbol">:</a> <a id="1042" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a><a id="1043" class="Symbol">)</a> <a id="1045" class="Symbol">{</a><a id="1046" href="Reflection.External.html#1046" class="Bound">n≢0</a> <a id="1050" class="Symbol">:</a> <a id="1052" href="Data.Nat.Base.html#2570" class="Record">NonZero</a> <a id="1060" href="Reflection.External.html#1038" class="Bound">n</a><a id="1061" class="Symbol">}</a> <a id="1063" class="Symbol">→</a> <a id="1065" href="Reflection.External.html#975" class="Datatype">ExitCode</a>

<a id="1075" class="Comment">-- Specification for a command.</a>
<a id="1107" class="Keyword">record</a> <a id="CmdSpec"></a><a id="1114" href="Reflection.External.html#1114" class="Record">CmdSpec</a> <a id="1122" class="Symbol">:</a> <a id="1124" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1128" class="Keyword">where</a>
  <a id="1136" class="Keyword">constructor</a> <a id="cmdSpec"></a><a id="1148" href="Reflection.External.html#1148" class="InductiveConstructor">cmdSpec</a>
  <a id="1158" class="Keyword">field</a>
    <a id="CmdSpec.name"></a><a id="1168" href="Reflection.External.html#1168" class="Field">name</a>  <a id="1174" class="Symbol">:</a> <a id="1176" href="Reflection.External.html#794" class="Function">CmdName</a>     <a id="1188" class="Comment">-- ^ Executable name (see ~/.agda/executables)</a>
    <a id="CmdSpec.args"></a><a id="1239" href="Reflection.External.html#1239" class="Field">args</a>  <a id="1245" class="Symbol">:</a> <a id="1247" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="1252" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="1259" class="Comment">-- ^ Command-line arguments for executable</a>
    <a id="CmdSpec.input"></a><a id="1306" href="Reflection.External.html#1306" class="Field">input</a> <a id="1312" class="Symbol">:</a> <a id="1314" href="Reflection.External.html#811" class="Function">StdIn</a>       <a id="1326" class="Comment">-- ^ Contents of standard input</a>

<a id="1359" class="Comment">-- Result of running a command.</a>
<a id="1391" class="Keyword">record</a> <a id="Result"></a><a id="1398" href="Reflection.External.html#1398" class="Record">Result</a> <a id="1405" class="Symbol">:</a> <a id="1407" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1411" class="Keyword">where</a>
  <a id="1419" class="Keyword">constructor</a> <a id="result"></a><a id="1431" href="Reflection.External.html#1431" class="InductiveConstructor">result</a>
  <a id="1440" class="Keyword">field</a>
    <a id="Result.exitCode"></a><a id="1450" href="Reflection.External.html#1450" class="Field">exitCode</a> <a id="1459" class="Symbol">:</a> <a id="1461" href="Reflection.External.html#975" class="Datatype">ExitCode</a> <a id="1470" class="Comment">-- ^ Exit code returned by the process</a>
    <a id="Result.output"></a><a id="1513" href="Reflection.External.html#1513" class="Field">output</a>   <a id="1522" class="Symbol">:</a> <a id="1524" href="Reflection.External.html#845" class="Function">StdOut</a>   <a id="1533" class="Comment">-- ^ Contents of standard output</a>
    <a id="Result.error"></a><a id="1570" href="Reflection.External.html#1570" class="Field">error</a>    <a id="1579" class="Symbol">:</a> <a id="1581" href="Reflection.External.html#828" class="Function">StdErr</a>   <a id="1590" class="Comment">-- ^ Contents of standard error</a>

<a id="1623" class="Comment">-- Convert a natural number to an exit code.</a>
<a id="toExitCode"></a><a id="1668" href="Reflection.External.html#1668" class="Function">toExitCode</a> <a id="1679" class="Symbol">:</a> <a id="1681" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a> <a id="1683" class="Symbol">→</a> <a id="1685" href="Reflection.External.html#975" class="Datatype">ExitCode</a>
<a id="1694" href="Reflection.External.html#1668" class="Function">toExitCode</a> <a id="1705" href="Agda.Builtin.Nat.html#204" class="InductiveConstructor">zero</a>    <a id="1713" class="Symbol">=</a> <a id="1715" href="Reflection.External.html#998" class="InductiveConstructor">exitSuccess</a>
<a id="1727" href="Reflection.External.html#1668" class="Function">toExitCode</a> <a id="1738" class="Symbol">(</a><a id="1739" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a> <a id="1743" href="Reflection.External.html#1743" class="Bound">n</a><a id="1744" class="Symbol">)</a> <a id="1746" class="Symbol">=</a> <a id="1748" href="Reflection.External.html#1023" class="InductiveConstructor">exitFailure</a> <a id="1760" class="Symbol">(</a><a id="1761" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a> <a id="1765" href="Reflection.External.html#1743" class="Bound">n</a><a id="1766" class="Symbol">)</a>

<a id="1769" class="Comment">-- Quote an exit code as an Agda term.</a>
<a id="quoteExitCode"></a><a id="1808" href="Reflection.External.html#1808" class="Function">quoteExitCode</a> <a id="1822" class="Symbol">:</a> <a id="1824" href="Reflection.External.html#975" class="Datatype">ExitCode</a> <a id="1833" class="Symbol">→</a> <a id="1835" href="Agda.Builtin.Reflection.html#4670" class="Datatype">Term</a>
<a id="1840" href="Reflection.External.html#1808" class="Function">quoteExitCode</a> <a id="1854" href="Reflection.External.html#998" class="InductiveConstructor">exitSuccess</a> <a id="1866" class="Symbol">=</a>
  <a id="1870" href="Agda.Builtin.Reflection.html#4871" class="InductiveConstructor">con</a> <a id="1874" class="Symbol">(</a><a id="1875" class="Keyword">quote</a> <a id="1881" href="Reflection.External.html#998" class="InductiveConstructor">exitSuccess</a><a id="1892" class="Symbol">)</a> <a id="1894" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>
<a id="1897" href="Reflection.External.html#1808" class="Function">quoteExitCode</a> <a id="1911" class="Symbol">(</a><a id="1912" href="Reflection.External.html#1023" class="InductiveConstructor">exitFailure</a> <a id="1924" href="Reflection.External.html#1924" class="Bound">n</a><a id="1925" class="Symbol">)</a> <a id="1927" class="Symbol">=</a>
  <a id="1931" href="Agda.Builtin.Reflection.html#4871" class="InductiveConstructor">con</a> <a id="1935" class="Symbol">(</a><a id="1936" class="Keyword">quote</a> <a id="1942" href="Reflection.External.html#1023" class="InductiveConstructor">exitFailure</a><a id="1953" class="Symbol">)</a> <a id="1955" class="Symbol">(</a><a id="1956" href="Reflection.AST.Argument.html#1329" class="InductiveConstructor">vArg</a> <a id="1961" class="Symbol">(</a><a id="1962" href="Agda.Builtin.Reflection.html#5186" class="InductiveConstructor">lit</a> <a id="1966" class="Symbol">(</a><a id="1967" href="Agda.Builtin.Reflection.html#4096" class="InductiveConstructor">nat</a> <a id="1971" href="Reflection.External.html#1924" class="Bound">n</a><a id="1972" class="Symbol">))</a> <a id="1975" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="1977" href="Reflection.AST.Argument.html#1391" class="InductiveConstructor">hArg</a> <a id="1982" class="Symbol">(</a><a id="1983" href="Agda.Builtin.Reflection.html#4871" class="InductiveConstructor">con</a> <a id="1987" class="Symbol">(</a><a id="1988" class="Keyword">quote</a> <a id="1994" href="Agda.Builtin.Unit.html#195" class="InductiveConstructor">tt</a><a id="1996" class="Symbol">)</a> <a id="1998" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="2000" class="Symbol">)</a> <a id="2002" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2004" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="2006" class="Symbol">)</a>

<a id="2009" class="Comment">-- Quote a result as an Agda term.</a>
<a id="quoteResult"></a><a id="2044" href="Reflection.External.html#2044" class="Function">quoteResult</a> <a id="2056" class="Symbol">:</a> <a id="2058" href="Reflection.External.html#1398" class="Record">Result</a> <a id="2065" class="Symbol">→</a> <a id="2067" href="Agda.Builtin.Reflection.html#4670" class="Datatype">Term</a>
<a id="2072" href="Reflection.External.html#2044" class="Function">quoteResult</a> <a id="2084" class="Symbol">(</a><a id="2085" href="Reflection.External.html#1431" class="InductiveConstructor">result</a> <a id="2092" href="Reflection.External.html#2092" class="Bound">exitCode</a> <a id="2101" href="Reflection.External.html#2101" class="Bound">output</a> <a id="2108" href="Reflection.External.html#2108" class="Bound">error</a><a id="2113" class="Symbol">)</a> <a id="2115" class="Symbol">=</a>
  <a id="2119" href="Agda.Builtin.Reflection.html#4871" class="InductiveConstructor">con</a> <a id="2123" class="Symbol">(</a><a id="2124" class="Keyword">quote</a> <a id="2130" href="Reflection.External.html#1431" class="InductiveConstructor">result</a><a id="2136" class="Symbol">)</a> <a id="2138" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="2140" href="Reflection.AST.Argument.html#1329" class="InductiveConstructor">vArg</a> <a id="2145" class="Symbol">(</a><a id="2146" href="Reflection.External.html#1808" class="Function">quoteExitCode</a> <a id="2160" href="Reflection.External.html#2092" class="Bound">exitCode</a><a id="2168" class="Symbol">)</a>
                     <a id="2191" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2193" href="Reflection.AST.Argument.html#1329" class="InductiveConstructor">vArg</a> <a id="2198" class="Symbol">(</a><a id="2199" href="Agda.Builtin.Reflection.html#5186" class="InductiveConstructor">lit</a> <a id="2203" class="Symbol">(</a><a id="2204" href="Agda.Builtin.Reflection.html#4232" class="InductiveConstructor">string</a> <a id="2211" href="Reflection.External.html#2101" class="Bound">output</a><a id="2217" class="Symbol">))</a>
                     <a id="2241" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2243" href="Reflection.AST.Argument.html#1329" class="InductiveConstructor">vArg</a> <a id="2248" class="Symbol">(</a><a id="2249" href="Agda.Builtin.Reflection.html#5186" class="InductiveConstructor">lit</a> <a id="2253" class="Symbol">(</a><a id="2254" href="Agda.Builtin.Reflection.html#4232" class="InductiveConstructor">string</a> <a id="2261" href="Reflection.External.html#2108" class="Bound">error</a><a id="2266" class="Symbol">))</a>
                     <a id="2290" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2292" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

<a id="2296" class="Comment">-- Run command from specification and return the full result.</a>
<a id="2358" class="Comment">--</a>
<a id="2361" class="Comment">-- NOTE: If the command fails, this macro still succeeds, and returns the</a>
<a id="2435" class="Comment">--       full result, including exit code and the contents of stderr.</a>
<a id="2505" class="Comment">--</a>
<a id="unsafeRunCmdTC"></a><a id="2508" href="Reflection.External.html#2508" class="Function">unsafeRunCmdTC</a> <a id="2523" class="Symbol">:</a> <a id="2525" href="Reflection.External.html#1114" class="Record">CmdSpec</a> <a id="2533" class="Symbol">→</a> <a id="2535" href="Agda.Builtin.Reflection.html#8279" class="Postulate">TC</a> <a id="2538" href="Reflection.External.html#1398" class="Record">Result</a>
<a id="2545" href="Reflection.External.html#2508" class="Function">unsafeRunCmdTC</a> <a id="2560" href="Reflection.External.html#2560" class="Bound">c</a> <a id="2562" class="Symbol">=</a> <a id="2564" class="Keyword">do</a>
  <a id="2569" class="Symbol">(</a><a id="2570" href="Reflection.External.html#2570" class="Bound">exitCode</a> <a id="2579" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2581" class="Symbol">(</a><a id="2582" href="Reflection.External.html#2582" class="Bound">stdOut</a> <a id="2589" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2591" href="Reflection.External.html#2591" class="Bound">stdErr</a><a id="2597" class="Symbol">))</a>
    <a id="2604" href="Reflection.TCM.Syntax.html#623" class="Function Operator">←</a> <a id="2606" href="Agda.Builtin.Reflection.External.html#298" class="Postulate">Builtin.execTC</a> <a id="2621" class="Symbol">(</a><a id="2622" href="Reflection.External.html#1168" class="Field">CmdSpec.name</a> <a id="2635" href="Reflection.External.html#2560" class="Bound">c</a><a id="2636" class="Symbol">)</a> <a id="2638" class="Symbol">(</a><a id="2639" href="Reflection.External.html#1239" class="Field">CmdSpec.args</a> <a id="2652" href="Reflection.External.html#2560" class="Bound">c</a><a id="2653" class="Symbol">)</a> <a id="2655" class="Symbol">(</a><a id="2656" href="Reflection.External.html#1306" class="Field">CmdSpec.input</a> <a id="2670" href="Reflection.External.html#2560" class="Bound">c</a><a id="2671" class="Symbol">)</a>
  <a id="2675" href="Reflection.TCM.html#1025" class="Postulate">pure</a> <a id="2680" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="2682" href="Reflection.External.html#1431" class="InductiveConstructor">result</a> <a id="2689" class="Symbol">(</a><a id="2690" href="Reflection.External.html#1668" class="Function">toExitCode</a> <a id="2701" href="Reflection.External.html#2570" class="Bound">exitCode</a><a id="2709" class="Symbol">)</a> <a id="2711" href="Reflection.External.html#2582" class="Bound">stdOut</a> <a id="2718" href="Reflection.External.html#2591" class="Bound">stdErr</a>

<a id="2726" class="Keyword">macro</a>
  <a id="unsafeRunCmd"></a><a id="2734" href="Reflection.External.html#2734" class="Function">unsafeRunCmd</a> <a id="2747" class="Symbol">:</a> <a id="2749" href="Reflection.External.html#1114" class="Record">CmdSpec</a> <a id="2757" class="Symbol">→</a> <a id="2759" href="Agda.Builtin.Reflection.html#4670" class="Datatype">Term</a> <a id="2764" class="Symbol">→</a> <a id="2766" href="Agda.Builtin.Reflection.html#8279" class="Postulate">TC</a> <a id="2769" href="Agda.Builtin.Unit.html#158" class="Record">⊤</a>
  <a id="2773" href="Reflection.External.html#2734" class="Function">unsafeRunCmd</a> <a id="2786" href="Reflection.External.html#2786" class="Bound">c</a> <a id="2788" href="Reflection.External.html#2788" class="Bound">hole</a> <a id="2793" class="Symbol">=</a> <a id="2795" href="Reflection.External.html#2508" class="Function">unsafeRunCmdTC</a> <a id="2810" href="Reflection.External.html#2786" class="Bound">c</a> <a id="2812" href="Reflection.TCM.Syntax.html#623" class="Function Operator">&gt;&gt;=</a> <a id="2816" href="Agda.Builtin.Reflection.html#8452" class="Postulate">unify</a> <a id="2822" href="Reflection.External.html#2788" class="Bound">hole</a> <a id="2827" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2829" href="Reflection.External.html#2044" class="Function">quoteResult</a>


<a id="2843" class="Comment">-- Show a command for the user.</a>
<a id="showCmdSpec"></a><a id="2875" href="Reflection.External.html#2875" class="Function">showCmdSpec</a> <a id="2887" class="Symbol">:</a> <a id="2889" href="Reflection.External.html#1114" class="Record">CmdSpec</a> <a id="2897" class="Symbol">→</a> <a id="2899" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
<a id="2906" href="Reflection.External.html#2875" class="Function">showCmdSpec</a> <a id="2918" href="Reflection.External.html#2918" class="Bound">c</a> <a id="2920" class="Symbol">=</a> <a id="2922" href="Data.String.Base.html#2743" class="Function">String.unwords</a> <a id="2937" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="2939" href="Reflection.External.html#1168" class="Field">CmdSpec.name</a> <a id="2952" href="Reflection.External.html#2918" class="Bound">c</a> <a id="2954" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2956" href="Reflection.External.html#1239" class="Field">CmdSpec.args</a> <a id="2969" href="Reflection.External.html#2918" class="Bound">c</a>


<a id="2973" class="Keyword">private</a>
  <a id="2983" class="Comment">-- Helper function for throwing an error from reflection.</a>
  <a id="userError"></a><a id="3043" href="Reflection.External.html#3043" class="Function">userError</a> <a id="3053" class="Symbol">:</a> <a id="3055" class="Symbol">∀</a> <a id="3057" class="Symbol">{</a><a id="3058" href="Reflection.External.html#3058" class="Bound">a</a><a id="3059" class="Symbol">}</a> <a id="3061" class="Symbol">{</a><a id="3062" href="Reflection.External.html#3062" class="Bound">A</a> <a id="3064" class="Symbol">:</a> <a id="3066" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="3070" href="Reflection.External.html#3058" class="Bound">a</a><a id="3071" class="Symbol">}</a> <a id="3073" class="Symbol">→</a> <a id="3075" href="Reflection.External.html#1114" class="Record">CmdSpec</a> <a id="3083" class="Symbol">→</a> <a id="3085" href="Reflection.External.html#845" class="Function">StdOut</a> <a id="3092" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="3094" href="Reflection.External.html#828" class="Function">StdErr</a> <a id="3101" class="Symbol">→</a> <a id="3103" href="Agda.Builtin.Reflection.html#8279" class="Postulate">TC</a> <a id="3106" href="Reflection.External.html#3062" class="Bound">A</a>
  <a id="3110" href="Reflection.External.html#3043" class="Function">userError</a> <a id="3120" href="Reflection.External.html#3120" class="Bound">c</a> <a id="3122" class="Symbol">(</a><a id="3123" href="Reflection.External.html#3123" class="Bound">stdout</a> <a id="3130" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3132" href="Reflection.External.html#3132" class="Bound">stderr</a><a id="3138" class="Symbol">)</a> <a id="3140" class="Symbol">=</a> <a id="3142" href="Agda.Builtin.Reflection.html#8492" class="Postulate">typeError</a> <a id="3152" class="Symbol">(</a><a id="3153" href="Agda.Builtin.Reflection.html#7900" class="InductiveConstructor">strErr</a> <a id="3160" href="Reflection.External.html#3189" class="Function">errMsg</a> <a id="3167" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3169" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="3171" class="Symbol">)</a>
    <a id="3177" class="Keyword">where</a>
      <a id="3189" href="Reflection.External.html#3189" class="Function">errMsg</a> <a id="3196" class="Symbol">:</a> <a id="3198" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
      <a id="3211" href="Reflection.External.html#3189" class="Function">errMsg</a> <a id="3218" class="Symbol">=</a> <a id="3220" href="Data.String.Base.html#2801" class="Function">String.unlines</a>
             <a id="3248" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="3250" class="Symbol">(</a><a id="3251" class="String">&quot;Error while running command &#39;&quot;</a> <a id="3283" href="Data.String.Base.html#2400" class="Function Operator">++</a> <a id="3286" href="Reflection.External.html#2875" class="Function">showCmdSpec</a> <a id="3298" href="Reflection.External.html#3120" class="Bound">c</a> <a id="3300" href="Data.String.Base.html#2400" class="Function Operator">++</a> <a id="3303" class="String">&quot;&#39;&quot;</a><a id="3306" class="Symbol">)</a>
             <a id="3321" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3323" class="Symbol">(</a><a id="3324" class="String">&quot;Input:\n&quot;</a> <a id="3335" href="Data.String.Base.html#2400" class="Function Operator">++</a> <a id="3338" href="Reflection.External.html#1306" class="Field">CmdSpec.input</a> <a id="3352" href="Reflection.External.html#3120" class="Bound">c</a><a id="3353" class="Symbol">)</a>
             <a id="3368" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3370" class="Symbol">(</a><a id="3371" class="String">&quot;Output:\n&quot;</a> <a id="3383" href="Data.String.Base.html#2400" class="Function Operator">++</a> <a id="3386" href="Reflection.External.html#3123" class="Bound">stdout</a><a id="3392" class="Symbol">)</a>
             <a id="3407" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3409" class="Symbol">(</a><a id="3410" class="String">&quot;Error:\n&quot;</a> <a id="3421" href="Data.String.Base.html#2400" class="Function Operator">++</a> <a id="3424" href="Reflection.External.html#3132" class="Bound">stderr</a><a id="3430" class="Symbol">)</a>
             <a id="3445" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3447" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>


<a id="3452" class="Comment">-- Run command from specification. If the command succeeds, it returns the</a>
<a id="3527" class="Comment">-- contents of stdout. Otherwise, it throws a type error with the contents</a>
<a id="3602" class="Comment">-- of stderr.</a>
<a id="runCmdTC"></a><a id="3616" href="Reflection.External.html#3616" class="Function">runCmdTC</a> <a id="3625" class="Symbol">:</a> <a id="3627" href="Reflection.External.html#1114" class="Record">CmdSpec</a> <a id="3635" class="Symbol">→</a> <a id="3637" href="Agda.Builtin.Reflection.html#8279" class="Postulate">TC</a> <a id="3640" href="Reflection.External.html#845" class="Function">StdOut</a>
<a id="3647" href="Reflection.External.html#3616" class="Function">runCmdTC</a> <a id="3656" href="Reflection.External.html#3656" class="Bound">c</a> <a id="3658" class="Symbol">=</a> <a id="3660" class="Keyword">do</a>
  <a id="3665" href="Reflection.External.html#3665" class="Bound">r</a> <a id="3667" href="Reflection.TCM.Syntax.html#623" class="Function Operator">←</a> <a id="3669" href="Reflection.External.html#2508" class="Function">unsafeRunCmdTC</a> <a id="3684" href="Reflection.External.html#3656" class="Bound">c</a>
  <a id="3688" class="Keyword">let</a> <a id="3692" href="Reflection.External.html#3692" class="Bound">debugPrefix</a> <a id="3704" class="Symbol">=</a> <a id="3706" class="Symbol">(</a><a id="3707" class="String">&quot;user.&quot;</a> <a id="3715" href="Data.String.Base.html#2400" class="Function Operator">++</a> <a id="3718" href="Reflection.External.html#1168" class="Field">CmdSpec.name</a> <a id="3731" href="Reflection.External.html#3656" class="Bound">c</a><a id="3732" class="Symbol">)</a>
  <a id="3736" href="Function.Base.html#4062" class="Function Operator">case</a> <a id="3741" href="Reflection.External.html#1450" class="Field">Result.exitCode</a> <a id="3757" href="Reflection.External.html#3665" class="Bound">r</a> <a id="3759" href="Function.Base.html#4062" class="Function Operator">of</a> <a id="3762" class="Symbol">λ</a>
    <a id="3768" class="Symbol">{</a> <a id="3770" href="Reflection.External.html#998" class="InductiveConstructor">exitSuccess</a> <a id="3782" class="Symbol">→</a> <a id="3784" class="Keyword">do</a>
      <a id="3793" href="Agda.Builtin.Reflection.html#10141" class="Postulate">debugPrint</a> <a id="3804" class="Symbol">(</a><a id="3805" href="Reflection.External.html#3692" class="Bound">debugPrefix</a> <a id="3817" href="Data.String.Base.html#2400" class="Function Operator">++</a> <a id="3820" class="String">&quot;.stderr&quot;</a><a id="3829" class="Symbol">)</a> <a id="3831" class="Number">10</a> <a id="3834" class="Symbol">(</a><a id="3835" href="Agda.Builtin.Reflection.html#7900" class="InductiveConstructor">strErr</a> <a id="3842" class="Symbol">(</a><a id="3843" href="Reflection.External.html#1570" class="Field">Result.error</a> <a id="3856" href="Reflection.External.html#3665" class="Bound">r</a><a id="3857" class="Symbol">)</a> <a id="3859" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3861" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="3863" class="Symbol">)</a>
      <a id="3871" href="Reflection.TCM.html#1025" class="Postulate">pure</a> <a id="3876" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="3878" href="Reflection.External.html#1513" class="Field">Result.output</a> <a id="3892" href="Reflection.External.html#3665" class="Bound">r</a>
    <a id="3898" class="Symbol">;</a> <a id="3900" class="Symbol">(</a><a id="3901" href="Reflection.External.html#1023" class="InductiveConstructor">exitFailure</a> <a id="3913" href="Reflection.External.html#3913" class="Bound">n</a><a id="3914" class="Symbol">)</a> <a id="3916" class="Symbol">→</a> <a id="3918" class="Keyword">do</a>
      <a id="3927" href="Reflection.External.html#3043" class="Function">userError</a> <a id="3937" href="Reflection.External.html#3656" class="Bound">c</a> <a id="3939" class="Symbol">(</a><a id="3940" href="Reflection.External.html#1513" class="Field">Result.output</a> <a id="3954" href="Reflection.External.html#3665" class="Bound">r</a> <a id="3956" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3958" href="Reflection.External.html#1570" class="Field">Result.error</a> <a id="3971" href="Reflection.External.html#3665" class="Bound">r</a><a id="3972" class="Symbol">)</a>
    <a id="3978" class="Symbol">}</a>

<a id="3981" class="Keyword">macro</a>
  <a id="runCmd"></a><a id="3989" href="Reflection.External.html#3989" class="Function">runCmd</a> <a id="3996" class="Symbol">:</a> <a id="3998" href="Reflection.External.html#1114" class="Record">CmdSpec</a> <a id="4006" class="Symbol">→</a> <a id="4008" href="Agda.Builtin.Reflection.html#4670" class="Datatype">Term</a> <a id="4013" class="Symbol">→</a> <a id="4015" href="Agda.Builtin.Reflection.html#8279" class="Postulate">TC</a> <a id="4018" href="Agda.Builtin.Unit.html#158" class="Record">⊤</a>
  <a id="4022" href="Reflection.External.html#3989" class="Function">runCmd</a> <a id="4029" href="Reflection.External.html#4029" class="Bound">c</a> <a id="4031" href="Reflection.External.html#4031" class="Bound">hole</a> <a id="4036" class="Symbol">=</a> <a id="4038" href="Reflection.External.html#3616" class="Function">runCmdTC</a> <a id="4047" href="Reflection.External.html#4029" class="Bound">c</a> <a id="4049" href="Reflection.TCM.Syntax.html#623" class="Function Operator">&gt;&gt;=</a> <a id="4053" href="Agda.Builtin.Reflection.html#8452" class="Postulate">unify</a> <a id="4059" href="Reflection.External.html#4031" class="Bound">hole</a> <a id="4064" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="4066" href="Agda.Builtin.Reflection.html#5186" class="InductiveConstructor">lit</a> <a id="4070" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="4072" href="Agda.Builtin.Reflection.html#4232" class="InductiveConstructor">string</a>
</pre></body></html>