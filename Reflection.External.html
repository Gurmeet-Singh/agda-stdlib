<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Reflection.External</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- The Agda standard library</a>
<a id="103" class="Comment">--</a>
<a id="106" class="Comment">-- Support for system calls as part of reflection</a>
<a id="156" class="Comment">------------------------------------------------------------------------</a>

<a id="230" class="Symbol">{-#</a> <a id="234" class="Keyword">OPTIONS</a> <a id="242" class="Pragma">--cubical-compatible</a> <a id="263" class="Pragma">--safe</a> <a id="270" class="Symbol">#-}</a>

<a id="275" class="Keyword">module</a> <a id="282" href="Reflection.External.html" class="Module">Reflection.External</a> <a id="302" class="Keyword">where</a>

<a id="309" class="Keyword">import</a> <a id="316" href="Agda.Builtin.Reflection.External.html" class="Module">Agda.Builtin.Reflection.External</a> <a id="349" class="Symbol">as</a> <a id="352" class="Module">Builtin</a>

<a id="361" class="Keyword">open</a> <a id="366" class="Keyword">import</a> <a id="373" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a> <a id="387" class="Keyword">using</a> <a id="393" class="Symbol">(</a><a id="394" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a><a id="395" class="Symbol">;</a> <a id="397" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a><a id="400" class="Symbol">;</a> <a id="402" href="Agda.Builtin.Nat.html#204" class="InductiveConstructor">zero</a><a id="406" class="Symbol">;</a> <a id="408" href="Data.Nat.Base.html#2570" class="Record">NonZero</a><a id="415" class="Symbol">)</a>
<a id="417" class="Keyword">open</a> <a id="422" class="Keyword">import</a> <a id="429" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="444" class="Keyword">using</a> <a id="450" class="Symbol">(</a><a id="451" href="Agda.Builtin.List.html#130" class="Datatype">List</a><a id="455" class="Symbol">;</a> <a id="457" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">_∷_</a><a id="460" class="Symbol">;</a> <a id="462" href="Data.List.Base.html#7375" class="InductiveConstructor">[]</a><a id="464" class="Symbol">)</a>
<a id="466" class="Keyword">open</a> <a id="471" class="Keyword">import</a> <a id="478" href="Data.Product.html" class="Module">Data.Product</a> <a id="491" class="Keyword">using</a> <a id="497" class="Symbol">(</a><a id="498" href="Data.Product.Base.html#1618" class="Function Operator">_×_</a><a id="501" class="Symbol">;</a> <a id="503" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">_,_</a><a id="506" class="Symbol">)</a>
<a id="508" class="Keyword">open</a> <a id="513" class="Keyword">import</a> <a id="520" href="Data.String.Base.html" class="Module">Data.String.Base</a> <a id="537" class="Symbol">as</a> <a id="540" class="Module">String</a> <a id="547" class="Keyword">using</a> <a id="553" class="Symbol">(</a><a id="554" href="Agda.Builtin.String.html#318" class="Postulate">String</a><a id="560" class="Symbol">;</a> <a id="562" href="Data.String.Base.html#2400" class="Function Operator">_++_</a><a id="566" class="Symbol">)</a>
<a id="568" class="Keyword">open</a> <a id="573" class="Keyword">import</a> <a id="580" href="Data.Sum.Base.html" class="Module">Data.Sum.Base</a> <a id="594" class="Keyword">using</a> <a id="600" class="Symbol">(</a><a id="601" href="Data.Sum.Base.html#625" class="Datatype Operator">_⊎_</a><a id="604" class="Symbol">;</a> <a id="606" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a><a id="610" class="Symbol">;</a> <a id="612" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a><a id="616" class="Symbol">;</a> <a id="618" href="Data.Sum.Base.html#811" class="Function Operator">[_,_]</a><a id="623" class="Symbol">)</a>
<a id="625" class="Keyword">open</a> <a id="630" class="Keyword">import</a> <a id="637" href="Data.Unit.Base.html" class="Module">Data.Unit.Base</a> <a id="652" class="Keyword">using</a> <a id="658" class="Symbol">(</a><a id="659" href="Agda.Builtin.Unit.html#158" class="Record">⊤</a><a id="660" class="Symbol">;</a> <a id="662" href="Agda.Builtin.Unit.html#195" class="InductiveConstructor">tt</a><a id="664" class="Symbol">)</a>
<a id="666" class="Keyword">open</a> <a id="671" class="Keyword">import</a> <a id="678" href="Function.Base.html" class="Module">Function.Base</a> <a id="692" class="Keyword">using</a> <a id="698" class="Symbol">(</a><a id="699" href="Function.Base.html#4062" class="Function Operator">case_of_</a><a id="707" class="Symbol">;</a> <a id="709" href="Function.Base.html#2003" class="Function Operator">_$_</a><a id="712" class="Symbol">;</a> <a id="714" href="Function.Base.html#1115" class="Function Operator">_∘_</a><a id="717" class="Symbol">)</a>
<a id="719" class="Keyword">open</a> <a id="724" class="Keyword">import</a> <a id="731" href="Reflection.html" class="Module">Reflection</a> <a id="742" class="Keyword">hiding</a> <a id="749" class="Symbol">(</a><a id="750" href="Agda.Builtin.Reflection.html#4266" class="InductiveConstructor">name</a><a id="754" class="Symbol">)</a>

<a id="757" class="Comment">-- Type aliases for the various strings.</a>

<a id="CmdName"></a><a id="799" href="Reflection.External.html#799" class="Function">CmdName</a> <a id="807" class="Symbol">=</a> <a id="809" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
<a id="StdIn"></a><a id="816" href="Reflection.External.html#816" class="Function">StdIn</a>   <a id="824" class="Symbol">=</a> <a id="826" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
<a id="StdErr"></a><a id="833" href="Reflection.External.html#833" class="Function">StdErr</a>  <a id="841" class="Symbol">=</a> <a id="843" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
<a id="StdOut"></a><a id="850" href="Reflection.External.html#850" class="Function">StdOut</a>  <a id="858" class="Symbol">=</a> <a id="860" href="Agda.Builtin.String.html#318" class="Postulate">String</a>

<a id="868" class="Comment">-- Representation for exit codes, assuming 0 is consistently used to indicate</a>
<a id="946" class="Comment">-- success across platforms.</a>
<a id="975" class="Keyword">data</a> <a id="ExitCode"></a><a id="980" href="Reflection.External.html#980" class="Datatype">ExitCode</a> <a id="989" class="Symbol">:</a> <a id="991" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="995" class="Keyword">where</a>
  <a id="ExitCode.exitSuccess"></a><a id="1003" href="Reflection.External.html#1003" class="InductiveConstructor">exitSuccess</a> <a id="1015" class="Symbol">:</a> <a id="1017" href="Reflection.External.html#980" class="Datatype">ExitCode</a>
  <a id="ExitCode.exitFailure"></a><a id="1028" href="Reflection.External.html#1028" class="InductiveConstructor">exitFailure</a> <a id="1040" class="Symbol">:</a> <a id="1042" class="Symbol">(</a><a id="1043" href="Reflection.External.html#1043" class="Bound">n</a> <a id="1045" class="Symbol">:</a> <a id="1047" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a><a id="1048" class="Symbol">)</a> <a id="1050" class="Symbol">{</a><a id="1051" href="Reflection.External.html#1051" class="Bound">n≢0</a> <a id="1055" class="Symbol">:</a> <a id="1057" href="Data.Nat.Base.html#2570" class="Record">NonZero</a> <a id="1065" href="Reflection.External.html#1043" class="Bound">n</a><a id="1066" class="Symbol">}</a> <a id="1068" class="Symbol">→</a> <a id="1070" href="Reflection.External.html#980" class="Datatype">ExitCode</a>

<a id="1080" class="Comment">-- Specification for a command.</a>
<a id="1112" class="Keyword">record</a> <a id="CmdSpec"></a><a id="1119" href="Reflection.External.html#1119" class="Record">CmdSpec</a> <a id="1127" class="Symbol">:</a> <a id="1129" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1133" class="Keyword">where</a>
  <a id="1141" class="Keyword">constructor</a> <a id="cmdSpec"></a><a id="1153" href="Reflection.External.html#1153" class="InductiveConstructor">cmdSpec</a>
  <a id="1163" class="Keyword">field</a>
    <a id="CmdSpec.name"></a><a id="1173" href="Reflection.External.html#1173" class="Field">name</a>  <a id="1179" class="Symbol">:</a> <a id="1181" href="Reflection.External.html#799" class="Function">CmdName</a>     <a id="1193" class="Comment">-- ^ Executable name (see ~/.agda/executables)</a>
    <a id="CmdSpec.args"></a><a id="1244" href="Reflection.External.html#1244" class="Field">args</a>  <a id="1250" class="Symbol">:</a> <a id="1252" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="1257" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="1264" class="Comment">-- ^ Command-line arguments for executable</a>
    <a id="CmdSpec.input"></a><a id="1311" href="Reflection.External.html#1311" class="Field">input</a> <a id="1317" class="Symbol">:</a> <a id="1319" href="Reflection.External.html#816" class="Function">StdIn</a>       <a id="1331" class="Comment">-- ^ Contents of standard input</a>

<a id="1364" class="Comment">-- Result of running a command.</a>
<a id="1396" class="Keyword">record</a> <a id="Result"></a><a id="1403" href="Reflection.External.html#1403" class="Record">Result</a> <a id="1410" class="Symbol">:</a> <a id="1412" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1416" class="Keyword">where</a>
  <a id="1424" class="Keyword">constructor</a> <a id="result"></a><a id="1436" href="Reflection.External.html#1436" class="InductiveConstructor">result</a>
  <a id="1445" class="Keyword">field</a>
    <a id="Result.exitCode"></a><a id="1455" href="Reflection.External.html#1455" class="Field">exitCode</a> <a id="1464" class="Symbol">:</a> <a id="1466" href="Reflection.External.html#980" class="Datatype">ExitCode</a> <a id="1475" class="Comment">-- ^ Exit code returned by the process</a>
    <a id="Result.output"></a><a id="1518" href="Reflection.External.html#1518" class="Field">output</a>   <a id="1527" class="Symbol">:</a> <a id="1529" href="Reflection.External.html#850" class="Function">StdOut</a>   <a id="1538" class="Comment">-- ^ Contents of standard output</a>
    <a id="Result.error"></a><a id="1575" href="Reflection.External.html#1575" class="Field">error</a>    <a id="1584" class="Symbol">:</a> <a id="1586" href="Reflection.External.html#833" class="Function">StdErr</a>   <a id="1595" class="Comment">-- ^ Contents of standard error</a>

<a id="1628" class="Comment">-- Convert a natural number to an exit code.</a>
<a id="toExitCode"></a><a id="1673" href="Reflection.External.html#1673" class="Function">toExitCode</a> <a id="1684" class="Symbol">:</a> <a id="1686" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a> <a id="1688" class="Symbol">→</a> <a id="1690" href="Reflection.External.html#980" class="Datatype">ExitCode</a>
<a id="1699" href="Reflection.External.html#1673" class="Function">toExitCode</a> <a id="1710" href="Agda.Builtin.Nat.html#204" class="InductiveConstructor">zero</a>    <a id="1718" class="Symbol">=</a> <a id="1720" href="Reflection.External.html#1003" class="InductiveConstructor">exitSuccess</a>
<a id="1732" href="Reflection.External.html#1673" class="Function">toExitCode</a> <a id="1743" class="Symbol">(</a><a id="1744" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a> <a id="1748" href="Reflection.External.html#1748" class="Bound">n</a><a id="1749" class="Symbol">)</a> <a id="1751" class="Symbol">=</a> <a id="1753" href="Reflection.External.html#1028" class="InductiveConstructor">exitFailure</a> <a id="1765" class="Symbol">(</a><a id="1766" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a> <a id="1770" href="Reflection.External.html#1748" class="Bound">n</a><a id="1771" class="Symbol">)</a>

<a id="1774" class="Comment">-- Quote an exit code as an Agda term.</a>
<a id="quoteExitCode"></a><a id="1813" href="Reflection.External.html#1813" class="Function">quoteExitCode</a> <a id="1827" class="Symbol">:</a> <a id="1829" href="Reflection.External.html#980" class="Datatype">ExitCode</a> <a id="1838" class="Symbol">→</a> <a id="1840" href="Agda.Builtin.Reflection.html#4670" class="Datatype">Term</a>
<a id="1845" href="Reflection.External.html#1813" class="Function">quoteExitCode</a> <a id="1859" href="Reflection.External.html#1003" class="InductiveConstructor">exitSuccess</a> <a id="1871" class="Symbol">=</a>
  <a id="1875" href="Agda.Builtin.Reflection.html#4871" class="InductiveConstructor">con</a> <a id="1879" class="Symbol">(</a><a id="1880" class="Keyword">quote</a> <a id="1886" href="Reflection.External.html#1003" class="InductiveConstructor">exitSuccess</a><a id="1897" class="Symbol">)</a> <a id="1899" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>
<a id="1902" href="Reflection.External.html#1813" class="Function">quoteExitCode</a> <a id="1916" class="Symbol">(</a><a id="1917" href="Reflection.External.html#1028" class="InductiveConstructor">exitFailure</a> <a id="1929" href="Reflection.External.html#1929" class="Bound">n</a><a id="1930" class="Symbol">)</a> <a id="1932" class="Symbol">=</a>
  <a id="1936" href="Agda.Builtin.Reflection.html#4871" class="InductiveConstructor">con</a> <a id="1940" class="Symbol">(</a><a id="1941" class="Keyword">quote</a> <a id="1947" href="Reflection.External.html#1028" class="InductiveConstructor">exitFailure</a><a id="1958" class="Symbol">)</a> <a id="1960" class="Symbol">(</a><a id="1961" href="Reflection.AST.Argument.html#1329" class="InductiveConstructor">vArg</a> <a id="1966" class="Symbol">(</a><a id="1967" href="Agda.Builtin.Reflection.html#5186" class="InductiveConstructor">lit</a> <a id="1971" class="Symbol">(</a><a id="1972" href="Agda.Builtin.Reflection.html#4096" class="InductiveConstructor">nat</a> <a id="1976" href="Reflection.External.html#1929" class="Bound">n</a><a id="1977" class="Symbol">))</a> <a id="1980" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="1982" href="Reflection.AST.Argument.html#1391" class="InductiveConstructor">hArg</a> <a id="1987" class="Symbol">(</a><a id="1988" href="Agda.Builtin.Reflection.html#4871" class="InductiveConstructor">con</a> <a id="1992" class="Symbol">(</a><a id="1993" class="Keyword">quote</a> <a id="1999" href="Agda.Builtin.Unit.html#195" class="InductiveConstructor">tt</a><a id="2001" class="Symbol">)</a> <a id="2003" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="2005" class="Symbol">)</a> <a id="2007" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2009" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="2011" class="Symbol">)</a>

<a id="2014" class="Comment">-- Quote a result as an Agda term.</a>
<a id="quoteResult"></a><a id="2049" href="Reflection.External.html#2049" class="Function">quoteResult</a> <a id="2061" class="Symbol">:</a> <a id="2063" href="Reflection.External.html#1403" class="Record">Result</a> <a id="2070" class="Symbol">→</a> <a id="2072" href="Agda.Builtin.Reflection.html#4670" class="Datatype">Term</a>
<a id="2077" href="Reflection.External.html#2049" class="Function">quoteResult</a> <a id="2089" class="Symbol">(</a><a id="2090" href="Reflection.External.html#1436" class="InductiveConstructor">result</a> <a id="2097" href="Reflection.External.html#2097" class="Bound">exitCode</a> <a id="2106" href="Reflection.External.html#2106" class="Bound">output</a> <a id="2113" href="Reflection.External.html#2113" class="Bound">error</a><a id="2118" class="Symbol">)</a> <a id="2120" class="Symbol">=</a>
  <a id="2124" href="Agda.Builtin.Reflection.html#4871" class="InductiveConstructor">con</a> <a id="2128" class="Symbol">(</a><a id="2129" class="Keyword">quote</a> <a id="2135" href="Reflection.External.html#1436" class="InductiveConstructor">result</a><a id="2141" class="Symbol">)</a> <a id="2143" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="2145" href="Reflection.AST.Argument.html#1329" class="InductiveConstructor">vArg</a> <a id="2150" class="Symbol">(</a><a id="2151" href="Reflection.External.html#1813" class="Function">quoteExitCode</a> <a id="2165" href="Reflection.External.html#2097" class="Bound">exitCode</a><a id="2173" class="Symbol">)</a>
                     <a id="2196" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2198" href="Reflection.AST.Argument.html#1329" class="InductiveConstructor">vArg</a> <a id="2203" class="Symbol">(</a><a id="2204" href="Agda.Builtin.Reflection.html#5186" class="InductiveConstructor">lit</a> <a id="2208" class="Symbol">(</a><a id="2209" href="Agda.Builtin.Reflection.html#4232" class="InductiveConstructor">string</a> <a id="2216" href="Reflection.External.html#2106" class="Bound">output</a><a id="2222" class="Symbol">))</a>
                     <a id="2246" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2248" href="Reflection.AST.Argument.html#1329" class="InductiveConstructor">vArg</a> <a id="2253" class="Symbol">(</a><a id="2254" href="Agda.Builtin.Reflection.html#5186" class="InductiveConstructor">lit</a> <a id="2258" class="Symbol">(</a><a id="2259" href="Agda.Builtin.Reflection.html#4232" class="InductiveConstructor">string</a> <a id="2266" href="Reflection.External.html#2113" class="Bound">error</a><a id="2271" class="Symbol">))</a>
                     <a id="2295" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2297" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

<a id="2301" class="Comment">-- Run command from specification and return the full result.</a>
<a id="2363" class="Comment">--</a>
<a id="2366" class="Comment">-- NOTE: If the command fails, this macro still succeeds, and returns the</a>
<a id="2440" class="Comment">--       full result, including exit code and the contents of stderr.</a>
<a id="2510" class="Comment">--</a>
<a id="unsafeRunCmdTC"></a><a id="2513" href="Reflection.External.html#2513" class="Function">unsafeRunCmdTC</a> <a id="2528" class="Symbol">:</a> <a id="2530" href="Reflection.External.html#1119" class="Record">CmdSpec</a> <a id="2538" class="Symbol">→</a> <a id="2540" href="Agda.Builtin.Reflection.html#8279" class="Postulate">TC</a> <a id="2543" href="Reflection.External.html#1403" class="Record">Result</a>
<a id="2550" href="Reflection.External.html#2513" class="Function">unsafeRunCmdTC</a> <a id="2565" href="Reflection.External.html#2565" class="Bound">c</a> <a id="2567" class="Symbol">=</a> <a id="2569" class="Keyword">do</a>
  <a id="2574" class="Symbol">(</a><a id="2575" href="Reflection.External.html#2575" class="Bound">exitCode</a> <a id="2584" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2586" class="Symbol">(</a><a id="2587" href="Reflection.External.html#2587" class="Bound">stdOut</a> <a id="2594" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2596" href="Reflection.External.html#2596" class="Bound">stdErr</a><a id="2602" class="Symbol">))</a>
    <a id="2609" href="Reflection.TCM.Syntax.html#623" class="Function Operator">←</a> <a id="2611" href="Agda.Builtin.Reflection.External.html#298" class="Postulate">Builtin.execTC</a> <a id="2626" class="Symbol">(</a><a id="2627" href="Reflection.External.html#1173" class="Field">CmdSpec.name</a> <a id="2640" href="Reflection.External.html#2565" class="Bound">c</a><a id="2641" class="Symbol">)</a> <a id="2643" class="Symbol">(</a><a id="2644" href="Reflection.External.html#1244" class="Field">CmdSpec.args</a> <a id="2657" href="Reflection.External.html#2565" class="Bound">c</a><a id="2658" class="Symbol">)</a> <a id="2660" class="Symbol">(</a><a id="2661" href="Reflection.External.html#1311" class="Field">CmdSpec.input</a> <a id="2675" href="Reflection.External.html#2565" class="Bound">c</a><a id="2676" class="Symbol">)</a>
  <a id="2680" href="Reflection.TCM.html#1025" class="Postulate">pure</a> <a id="2685" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="2687" href="Reflection.External.html#1436" class="InductiveConstructor">result</a> <a id="2694" class="Symbol">(</a><a id="2695" href="Reflection.External.html#1673" class="Function">toExitCode</a> <a id="2706" href="Reflection.External.html#2575" class="Bound">exitCode</a><a id="2714" class="Symbol">)</a> <a id="2716" href="Reflection.External.html#2587" class="Bound">stdOut</a> <a id="2723" href="Reflection.External.html#2596" class="Bound">stdErr</a>

<a id="2731" class="Keyword">macro</a>
  <a id="unsafeRunCmd"></a><a id="2739" href="Reflection.External.html#2739" class="Function">unsafeRunCmd</a> <a id="2752" class="Symbol">:</a> <a id="2754" href="Reflection.External.html#1119" class="Record">CmdSpec</a> <a id="2762" class="Symbol">→</a> <a id="2764" href="Agda.Builtin.Reflection.html#4670" class="Datatype">Term</a> <a id="2769" class="Symbol">→</a> <a id="2771" href="Agda.Builtin.Reflection.html#8279" class="Postulate">TC</a> <a id="2774" href="Agda.Builtin.Unit.html#158" class="Record">⊤</a>
  <a id="2778" href="Reflection.External.html#2739" class="Function">unsafeRunCmd</a> <a id="2791" href="Reflection.External.html#2791" class="Bound">c</a> <a id="2793" href="Reflection.External.html#2793" class="Bound">hole</a> <a id="2798" class="Symbol">=</a> <a id="2800" href="Reflection.External.html#2513" class="Function">unsafeRunCmdTC</a> <a id="2815" href="Reflection.External.html#2791" class="Bound">c</a> <a id="2817" href="Reflection.TCM.Syntax.html#623" class="Function Operator">&gt;&gt;=</a> <a id="2821" href="Agda.Builtin.Reflection.html#8452" class="Postulate">unify</a> <a id="2827" href="Reflection.External.html#2793" class="Bound">hole</a> <a id="2832" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="2834" href="Reflection.External.html#2049" class="Function">quoteResult</a>


<a id="2848" class="Comment">-- Show a command for the user.</a>
<a id="showCmdSpec"></a><a id="2880" href="Reflection.External.html#2880" class="Function">showCmdSpec</a> <a id="2892" class="Symbol">:</a> <a id="2894" href="Reflection.External.html#1119" class="Record">CmdSpec</a> <a id="2902" class="Symbol">→</a> <a id="2904" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
<a id="2911" href="Reflection.External.html#2880" class="Function">showCmdSpec</a> <a id="2923" href="Reflection.External.html#2923" class="Bound">c</a> <a id="2925" class="Symbol">=</a> <a id="2927" href="Data.String.Base.html#2743" class="Function">String.unwords</a> <a id="2942" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="2944" href="Reflection.External.html#1173" class="Field">CmdSpec.name</a> <a id="2957" href="Reflection.External.html#2923" class="Bound">c</a> <a id="2959" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="2961" href="Reflection.External.html#1244" class="Field">CmdSpec.args</a> <a id="2974" href="Reflection.External.html#2923" class="Bound">c</a>


<a id="2978" class="Keyword">private</a>
  <a id="2988" class="Comment">-- Helper function for throwing an error from reflection.</a>
  <a id="userError"></a><a id="3048" href="Reflection.External.html#3048" class="Function">userError</a> <a id="3058" class="Symbol">:</a> <a id="3060" class="Symbol">∀</a> <a id="3062" class="Symbol">{</a><a id="3063" href="Reflection.External.html#3063" class="Bound">a</a><a id="3064" class="Symbol">}</a> <a id="3066" class="Symbol">{</a><a id="3067" href="Reflection.External.html#3067" class="Bound">A</a> <a id="3069" class="Symbol">:</a> <a id="3071" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="3075" href="Reflection.External.html#3063" class="Bound">a</a><a id="3076" class="Symbol">}</a> <a id="3078" class="Symbol">→</a> <a id="3080" href="Reflection.External.html#1119" class="Record">CmdSpec</a> <a id="3088" class="Symbol">→</a> <a id="3090" href="Reflection.External.html#850" class="Function">StdOut</a> <a id="3097" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="3099" href="Reflection.External.html#833" class="Function">StdErr</a> <a id="3106" class="Symbol">→</a> <a id="3108" href="Agda.Builtin.Reflection.html#8279" class="Postulate">TC</a> <a id="3111" href="Reflection.External.html#3067" class="Bound">A</a>
  <a id="3115" href="Reflection.External.html#3048" class="Function">userError</a> <a id="3125" href="Reflection.External.html#3125" class="Bound">c</a> <a id="3127" class="Symbol">(</a><a id="3128" href="Reflection.External.html#3128" class="Bound">stdout</a> <a id="3135" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3137" href="Reflection.External.html#3137" class="Bound">stderr</a><a id="3143" class="Symbol">)</a> <a id="3145" class="Symbol">=</a> <a id="3147" href="Agda.Builtin.Reflection.html#8492" class="Postulate">typeError</a> <a id="3157" class="Symbol">(</a><a id="3158" href="Agda.Builtin.Reflection.html#7900" class="InductiveConstructor">strErr</a> <a id="3165" href="Reflection.External.html#3194" class="Function">errMsg</a> <a id="3172" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3174" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="3176" class="Symbol">)</a>
    <a id="3182" class="Keyword">where</a>
      <a id="3194" href="Reflection.External.html#3194" class="Function">errMsg</a> <a id="3201" class="Symbol">:</a> <a id="3203" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
      <a id="3216" href="Reflection.External.html#3194" class="Function">errMsg</a> <a id="3223" class="Symbol">=</a> <a id="3225" href="Data.String.Base.html#2801" class="Function">String.unlines</a>
             <a id="3253" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="3255" class="Symbol">(</a><a id="3256" class="String">&quot;Error while running command &#39;&quot;</a> <a id="3288" href="Data.String.Base.html#2400" class="Function Operator">++</a> <a id="3291" href="Reflection.External.html#2880" class="Function">showCmdSpec</a> <a id="3303" href="Reflection.External.html#3125" class="Bound">c</a> <a id="3305" href="Data.String.Base.html#2400" class="Function Operator">++</a> <a id="3308" class="String">&quot;&#39;&quot;</a><a id="3311" class="Symbol">)</a>
             <a id="3326" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3328" class="Symbol">(</a><a id="3329" class="String">&quot;Input:\n&quot;</a> <a id="3340" href="Data.String.Base.html#2400" class="Function Operator">++</a> <a id="3343" href="Reflection.External.html#1311" class="Field">CmdSpec.input</a> <a id="3357" href="Reflection.External.html#3125" class="Bound">c</a><a id="3358" class="Symbol">)</a>
             <a id="3373" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3375" class="Symbol">(</a><a id="3376" class="String">&quot;Output:\n&quot;</a> <a id="3388" href="Data.String.Base.html#2400" class="Function Operator">++</a> <a id="3391" href="Reflection.External.html#3128" class="Bound">stdout</a><a id="3397" class="Symbol">)</a>
             <a id="3412" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3414" class="Symbol">(</a><a id="3415" class="String">&quot;Error:\n&quot;</a> <a id="3426" href="Data.String.Base.html#2400" class="Function Operator">++</a> <a id="3429" href="Reflection.External.html#3137" class="Bound">stderr</a><a id="3435" class="Symbol">)</a>
             <a id="3450" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3452" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>


<a id="3457" class="Comment">-- Run command from specification. If the command succeeds, it returns the</a>
<a id="3532" class="Comment">-- contents of stdout. Otherwise, it throws a type error with the contents</a>
<a id="3607" class="Comment">-- of stderr.</a>
<a id="runCmdTC"></a><a id="3621" href="Reflection.External.html#3621" class="Function">runCmdTC</a> <a id="3630" class="Symbol">:</a> <a id="3632" href="Reflection.External.html#1119" class="Record">CmdSpec</a> <a id="3640" class="Symbol">→</a> <a id="3642" href="Agda.Builtin.Reflection.html#8279" class="Postulate">TC</a> <a id="3645" href="Reflection.External.html#850" class="Function">StdOut</a>
<a id="3652" href="Reflection.External.html#3621" class="Function">runCmdTC</a> <a id="3661" href="Reflection.External.html#3661" class="Bound">c</a> <a id="3663" class="Symbol">=</a> <a id="3665" class="Keyword">do</a>
  <a id="3670" href="Reflection.External.html#3670" class="Bound">r</a> <a id="3672" href="Reflection.TCM.Syntax.html#623" class="Function Operator">←</a> <a id="3674" href="Reflection.External.html#2513" class="Function">unsafeRunCmdTC</a> <a id="3689" href="Reflection.External.html#3661" class="Bound">c</a>
  <a id="3693" class="Keyword">let</a> <a id="3697" href="Reflection.External.html#3697" class="Bound">debugPrefix</a> <a id="3709" class="Symbol">=</a> <a id="3711" class="Symbol">(</a><a id="3712" class="String">&quot;user.&quot;</a> <a id="3720" href="Data.String.Base.html#2400" class="Function Operator">++</a> <a id="3723" href="Reflection.External.html#1173" class="Field">CmdSpec.name</a> <a id="3736" href="Reflection.External.html#3661" class="Bound">c</a><a id="3737" class="Symbol">)</a>
  <a id="3741" href="Function.Base.html#4062" class="Function Operator">case</a> <a id="3746" href="Reflection.External.html#1455" class="Field">Result.exitCode</a> <a id="3762" href="Reflection.External.html#3670" class="Bound">r</a> <a id="3764" href="Function.Base.html#4062" class="Function Operator">of</a> <a id="3767" class="Symbol">λ</a>
    <a id="3773" class="Symbol">{</a> <a id="3775" href="Reflection.External.html#1003" class="InductiveConstructor">exitSuccess</a> <a id="3787" class="Symbol">→</a> <a id="3789" class="Keyword">do</a>
      <a id="3798" href="Agda.Builtin.Reflection.html#10141" class="Postulate">debugPrint</a> <a id="3809" class="Symbol">(</a><a id="3810" href="Reflection.External.html#3697" class="Bound">debugPrefix</a> <a id="3822" href="Data.String.Base.html#2400" class="Function Operator">++</a> <a id="3825" class="String">&quot;.stderr&quot;</a><a id="3834" class="Symbol">)</a> <a id="3836" class="Number">10</a> <a id="3839" class="Symbol">(</a><a id="3840" href="Agda.Builtin.Reflection.html#7900" class="InductiveConstructor">strErr</a> <a id="3847" class="Symbol">(</a><a id="3848" href="Reflection.External.html#1575" class="Field">Result.error</a> <a id="3861" href="Reflection.External.html#3670" class="Bound">r</a><a id="3862" class="Symbol">)</a> <a id="3864" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3866" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="3868" class="Symbol">)</a>
      <a id="3876" href="Reflection.TCM.html#1025" class="Postulate">pure</a> <a id="3881" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="3883" href="Reflection.External.html#1518" class="Field">Result.output</a> <a id="3897" href="Reflection.External.html#3670" class="Bound">r</a>
    <a id="3903" class="Symbol">;</a> <a id="3905" class="Symbol">(</a><a id="3906" href="Reflection.External.html#1028" class="InductiveConstructor">exitFailure</a> <a id="3918" href="Reflection.External.html#3918" class="Bound">n</a><a id="3919" class="Symbol">)</a> <a id="3921" class="Symbol">→</a> <a id="3923" class="Keyword">do</a>
      <a id="3932" href="Reflection.External.html#3048" class="Function">userError</a> <a id="3942" href="Reflection.External.html#3661" class="Bound">c</a> <a id="3944" class="Symbol">(</a><a id="3945" href="Reflection.External.html#1518" class="Field">Result.output</a> <a id="3959" href="Reflection.External.html#3670" class="Bound">r</a> <a id="3961" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3963" href="Reflection.External.html#1575" class="Field">Result.error</a> <a id="3976" href="Reflection.External.html#3670" class="Bound">r</a><a id="3977" class="Symbol">)</a>
    <a id="3983" class="Symbol">}</a>

<a id="3986" class="Keyword">macro</a>
  <a id="runCmd"></a><a id="3994" href="Reflection.External.html#3994" class="Function">runCmd</a> <a id="4001" class="Symbol">:</a> <a id="4003" href="Reflection.External.html#1119" class="Record">CmdSpec</a> <a id="4011" class="Symbol">→</a> <a id="4013" href="Agda.Builtin.Reflection.html#4670" class="Datatype">Term</a> <a id="4018" class="Symbol">→</a> <a id="4020" href="Agda.Builtin.Reflection.html#8279" class="Postulate">TC</a> <a id="4023" href="Agda.Builtin.Unit.html#158" class="Record">⊤</a>
  <a id="4027" href="Reflection.External.html#3994" class="Function">runCmd</a> <a id="4034" href="Reflection.External.html#4034" class="Bound">c</a> <a id="4036" href="Reflection.External.html#4036" class="Bound">hole</a> <a id="4041" class="Symbol">=</a> <a id="4043" href="Reflection.External.html#3621" class="Function">runCmdTC</a> <a id="4052" href="Reflection.External.html#4034" class="Bound">c</a> <a id="4054" href="Reflection.TCM.Syntax.html#623" class="Function Operator">&gt;&gt;=</a> <a id="4058" href="Agda.Builtin.Reflection.html#8452" class="Postulate">unify</a> <a id="4064" href="Reflection.External.html#4036" class="Bound">hole</a> <a id="4069" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="4071" href="Agda.Builtin.Reflection.html#5186" class="InductiveConstructor">lit</a> <a id="4075" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="4077" href="Agda.Builtin.Reflection.html#4232" class="InductiveConstructor">string</a>
</pre></body></html>