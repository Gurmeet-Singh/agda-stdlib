<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Test.Golden</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- The Agda standard library</a>
<a id="103" class="Comment">--</a>
<a id="106" class="Comment">-- Golden testing framework</a>
<a id="134" class="Comment">------------------------------------------------------------------------</a>

<a id="208" class="Comment">-- This is a port of the golden testing framework used by the Idris2</a>
<a id="277" class="Comment">-- compiler and various Idris2 libraries.</a>
<a id="319" class="Comment">-- It provides the core features required to perform golden file testing.</a>
<a id="393" class="Comment">--</a>
<a id="396" class="Comment">-- We provide the core functionality to run a *single* golden file test,</a>
<a id="469" class="Comment">-- or a whole test tree. This allows the developer freedom to use as is</a>
<a id="541" class="Comment">-- or design the rest of the test harness to their liking.</a>

<a id="601" class="Comment">------------------------------------------------------------------------</a>
<a id="674" class="Comment">-- Test Structure</a>
<a id="692" class="Comment">--</a>
<a id="695" class="Comment">-- This harness works from the assumption that each individual golden</a>
<a id="765" class="Comment">-- test comprises of a directory with the following structure:</a>
<a id="828" class="Comment">--</a>
<a id="831" class="Comment">-- + `run` a *shell* script that runs the test. We expect it to:</a>
<a id="896" class="Comment">--   * Use `$1` as the variable standing for the Agda executable to be tested</a>
<a id="974" class="Comment">--   * Clean up after itself (e.g. by running `rm -rf build/`)</a>
<a id="1037" class="Comment">--</a>
<a id="1040" class="Comment">-- + `expected` a file containting the expected output of `run`</a>
<a id="1104" class="Comment">--</a>
<a id="1107" class="Comment">-- During testing, the test harness will generate an `output` file.</a>
<a id="1175" class="Comment">-- It will be compared to the `expected` golden file provided by the user.</a>
<a id="1250" class="Comment">-- In case there is a mismatch, the framework will:</a>

<a id="1303" class="Comment">-- + either display output &amp; expected if the session is not interactive</a>
<a id="1375" class="Comment">-- + or use the following command line to produce a diff and ask the user</a>
<a id="1449" class="Comment">--   whether they want to overwrite the currently `expected` value:</a>
<a id="1517" class="Comment">--</a>
<a id="1520" class="Comment">--  git diff --no-index --exit-code --word-diff=color expected output</a>
<a id="1590" class="Comment">--</a>
<a id="1593" class="Comment">-- If `git` fails then the runner will simply present the expected and</a>
<a id="1664" class="Comment">-- &#39;given&#39; files side-by-side.</a>
<a id="1695" class="Comment">--</a>
<a id="1698" class="Comment">-- Of note, it is helpful to add `output` to a local `.gitignore` instance</a>
<a id="1773" class="Comment">-- to ensure that it is not mistakenly versioned.</a>


<a id="1825" class="Comment">------------------------------------------------------------------------</a>
<a id="1898" class="Comment">-- Options</a>
<a id="1909" class="Comment">--</a>
<a id="1912" class="Comment">-- The test harness has several options that may be set:</a>
<a id="1969" class="Comment">--</a>
<a id="1972" class="Comment">-- + `exeUnderTest` The path of the executable we are testing (typically `agda`)</a>
<a id="2053" class="Comment">-- + `onlyNames`    The tests to run relative to the generated executable.</a>
<a id="2128" class="Comment">-- + `onlyFile`     The file listing the tests to run relative to the generated executable.</a>
<a id="2220" class="Comment">-- + `interactive`  Whether to offer to update the expected file or not.</a>
<a id="2293" class="Comment">-- + `timing`       Whether to display time taken for each test.</a>
<a id="2358" class="Comment">-- + `failureFile`  The file in which to write the list of failing tests.</a>
<a id="2432" class="Comment">-- + `colour`       The output should use ANSI escape codes</a>
<a id="2492" class="Comment">--</a>
<a id="2495" class="Comment">-- We provide an options parser (`options`) that takes the list of command line</a>
<a id="2575" class="Comment">-- arguments and constructs this for you.</a>
<a id="2617" class="Comment">---</a>

<a id="2622" class="Comment">------------------------------------------------------------------------</a>
<a id="2695" class="Comment">-- Usage</a>
<a id="2704" class="Comment">--</a>
<a id="2707" class="Comment">-- When compiled to an executable the expected usage is:</a>
<a id="2764" class="Comment">--</a>
<a id="2767" class="Comment">--```sh</a>
<a id="2775" class="Comment">--runtests &lt;path to executable under test&gt;</a>
<a id="2818" class="Comment">--   [--timing]</a>
<a id="2834" class="Comment">--   [--interactive]</a>
<a id="2855" class="Comment">--   [--only-file PATH]</a>
<a id="2879" class="Comment">--   [--failure-file PATH]</a>
<a id="2906" class="Comment">--   [--no-colour]</a>
<a id="2925" class="Comment">--   [--only [NAMES]]</a>
<a id="2947" class="Comment">--```</a>
<a id="2953" class="Comment">--</a>
<a id="2956" class="Comment">-- assuming that the test runner is compiled to an executable named `runtests`.</a>

<a id="3037" class="Symbol">{-#</a> <a id="3041" class="Keyword">OPTIONS</a> <a id="3049" class="Pragma">--cubical-compatible</a> <a id="3070" class="Pragma">--guardedness</a> <a id="3084" class="Symbol">#-}</a>

<a id="3089" class="Keyword">module</a> <a id="3096" href="Test.Golden.html" class="Module">Test.Golden</a> <a id="3108" class="Keyword">where</a>

<a id="3115" class="Keyword">open</a> <a id="3120" class="Keyword">import</a> <a id="3127" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a> <a id="3142" class="Keyword">using</a> <a id="3148" class="Symbol">(</a><a id="3149" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a><a id="3153" class="Symbol">;</a> <a id="3155" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a><a id="3159" class="Symbol">;</a> <a id="3161" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a><a id="3166" class="Symbol">;</a> <a id="3168" href="Data.Bool.Base.html#1292" class="Function Operator">if_then_else_</a><a id="3181" class="Symbol">)</a>
<a id="3183" class="Keyword">import</a> <a id="3190" href="Data.Char.html" class="Module">Data.Char</a> <a id="3200" class="Symbol">as</a> <a id="3203" class="Module">Char</a>
<a id="3208" class="Keyword">open</a> <a id="3213" class="Keyword">import</a> <a id="3220" href="Data.Fin.html" class="Module">Data.Fin</a> <a id="3229" class="Keyword">using</a> <a id="3235" class="Symbol">(</a><a id="3236" href="Data.Fin.html#739" class="Function Operator">#_</a><a id="3238" class="Symbol">)</a>
<a id="3240" class="Keyword">import</a> <a id="3247" href="Data.Integer.Base.html" class="Module">Data.Integer.Base</a> <a id="3265" class="Symbol">as</a> <a id="3268" class="Module">ℤ</a>
<a id="3270" class="Keyword">open</a> <a id="3275" class="Keyword">import</a> <a id="3282" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="3297" class="Symbol">as</a> <a id="3300" class="Module">List</a> <a id="3305" class="Keyword">using</a> <a id="3311" class="Symbol">(</a><a id="3312" href="Agda.Builtin.List.html#130" class="Datatype">List</a><a id="3316" class="Symbol">;</a> <a id="3318" href="Data.List.Base.html#7375" class="InductiveConstructor">[]</a><a id="3320" class="Symbol">;</a> <a id="3322" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">_∷_</a><a id="3325" class="Symbol">;</a> <a id="3327" href="Data.List.Base.html#1943" class="Function Operator">_++_</a><a id="3331" class="Symbol">;</a> <a id="3333" href="Data.List.Base.html#11417" class="Function">filter</a><a id="3339" class="Symbol">;</a> <a id="3341" href="Data.List.Base.html#3893" class="Function">partitionSums</a><a id="3354" class="Symbol">)</a>
<a id="3356" class="Keyword">open</a> <a id="3361" class="Keyword">import</a> <a id="3368" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html" class="Module">Data.List.Relation.Binary.Infix.Heterogeneous.Properties</a> <a id="3425" class="Keyword">using</a> <a id="3431" class="Symbol">(</a><a id="3432" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html#6668" class="Function">infix?</a><a id="3438" class="Symbol">)</a>
<a id="3440" class="Keyword">open</a> <a id="3445" class="Keyword">import</a> <a id="3452" href="Data.List.Relation.Unary.Any.html" class="Module">Data.List.Relation.Unary.Any</a> <a id="3481" class="Keyword">using</a> <a id="3487" class="Symbol">(</a><a id="3488" href="Data.List.Relation.Unary.Any.html#2680" class="Function">any?</a><a id="3492" class="Symbol">)</a>
<a id="3494" class="Keyword">open</a> <a id="3499" class="Keyword">import</a> <a id="3506" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="3522" class="Keyword">using</a> <a id="3528" class="Symbol">(</a><a id="3529" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a><a id="3534" class="Symbol">;</a> <a id="3536" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a><a id="3540" class="Symbol">;</a> <a id="3542" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a><a id="3549" class="Symbol">;</a> <a id="3551" href="Data.Maybe.Base.html#1661" class="Function">fromMaybe</a><a id="3560" class="Symbol">)</a>
<a id="3562" class="Keyword">open</a> <a id="3567" class="Keyword">import</a> <a id="3574" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a> <a id="3588" class="Keyword">using</a> <a id="3594" class="Symbol">(</a><a id="3595" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a><a id="3596" class="Symbol">;</a> <a id="3598" href="Data.Nat.Base.html#1136" class="Primitive Operator">_≡ᵇ_</a><a id="3602" class="Symbol">;</a> <a id="3604" href="Data.Nat.Base.html#1310" class="Primitive Operator">_&lt;ᵇ_</a><a id="3608" class="Symbol">;</a> <a id="3610" href="Agda.Builtin.Nat.html#319" class="Primitive Operator">_+_</a><a id="3613" class="Symbol">;</a> <a id="3615" href="Data.Nat.Base.html#3211" class="Primitive Operator">_∸_</a><a id="3618" class="Symbol">)</a>
<a id="3620" class="Keyword">import</a> <a id="3627" href="Data.Nat.Show.html" class="Module">Data.Nat.Show</a> <a id="3641" class="Symbol">as</a> <a id="3644" class="Module">ℕ</a> <a id="3646" class="Keyword">using</a> <a id="3652" class="Symbol">(</a><a id="3653" href="Data.Nat.Show.html#1972" class="Function">show</a><a id="3657" class="Symbol">)</a>
<a id="3659" class="Keyword">open</a> <a id="3664" class="Keyword">import</a> <a id="3671" href="Data.Product.Base.html" class="Module">Data.Product.Base</a> <a id="3689" class="Keyword">using</a> <a id="3695" class="Symbol">(</a><a id="3696" href="Data.Product.Base.html#1618" class="Function Operator">_×_</a><a id="3699" class="Symbol">;</a> <a id="3701" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">_,_</a><a id="3704" class="Symbol">)</a>
<a id="3706" class="Keyword">open</a> <a id="3711" class="Keyword">import</a> <a id="3718" href="Data.String.html" class="Module">Data.String</a> <a id="3730" class="Symbol">as</a> <a id="3733" class="Module">String</a> <a id="3740" class="Keyword">using</a> <a id="3746" class="Symbol">(</a><a id="3747" href="Agda.Builtin.String.html#318" class="Postulate">String</a><a id="3753" class="Symbol">;</a> <a id="3755" href="Data.String.Base.html#5084" class="Function">lines</a><a id="3760" class="Symbol">;</a> <a id="3762" href="Data.String.Base.html#2801" class="Function">unlines</a><a id="3769" class="Symbol">;</a> <a id="3771" href="Data.String.Base.html#2743" class="Function">unwords</a><a id="3778" class="Symbol">;</a> <a id="3780" href="Data.String.Base.html#2588" class="Function">concat</a><a id="3786" class="Symbol">;</a> <a id="3788" href="Data.String.Properties.html#2305" class="Function Operator">_≟_</a><a id="3791" class="Symbol">)</a>
<a id="3793" class="Keyword">open</a> <a id="3798" class="Keyword">import</a> <a id="3805" href="Data.Sum.Base.html" class="Module">Data.Sum.Base</a> <a id="3819" class="Keyword">using</a> <a id="3825" class="Symbol">(</a><a id="3826" href="Data.Sum.Base.html#625" class="Datatype Operator">_⊎_</a><a id="3829" class="Symbol">;</a> <a id="3831" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a><a id="3835" class="Symbol">;</a> <a id="3837" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a><a id="3841" class="Symbol">)</a>
<a id="3843" class="Keyword">open</a> <a id="3848" class="Keyword">import</a> <a id="3855" href="Data.Unit.Base.html" class="Module">Data.Unit.Base</a> <a id="3870" class="Keyword">using</a> <a id="3876" class="Symbol">(</a><a id="3877" href="Agda.Builtin.Unit.html#158" class="Record">⊤</a><a id="3878" class="Symbol">)</a>

<a id="3881" class="Keyword">open</a> <a id="3886" class="Keyword">import</a> <a id="3893" href="Function.Base.html" class="Module">Function.Base</a> <a id="3907" class="Keyword">using</a> <a id="3913" class="Symbol">(</a><a id="3914" href="Function.Base.html#704" class="Function">id</a><a id="3916" class="Symbol">;</a> <a id="3918" href="Function.Base.html#2003" class="Function Operator">_$_</a><a id="3921" class="Symbol">;</a> <a id="3923" href="Function.Base.html#4062" class="Function Operator">case_of_</a><a id="3931" class="Symbol">)</a>

<a id="3934" class="Keyword">open</a> <a id="3939" class="Keyword">import</a> <a id="3946" href="Relation.Nullary.Decidable.html" class="Module">Relation.Nullary.Decidable</a> <a id="3973" class="Keyword">using</a> <a id="3979" class="Symbol">(</a><a id="3980" href="Relation.Nullary.Decidable.Core.html#1560" class="Field">does</a><a id="3984" class="Symbol">)</a>

<a id="3987" class="Keyword">open</a> <a id="3992" class="Keyword">import</a> <a id="3999" href="Codata.Musical.Notation.html" class="Module">Codata.Musical.Notation</a> <a id="4023" class="Keyword">using</a> <a id="4029" class="Symbol">(</a><a id="4030" href="Agda.Builtin.Coinduction.html#212" class="CoinductiveConstructor Operator">♯_</a><a id="4032" class="Symbol">)</a>
<a id="4034" class="Keyword">open</a> <a id="4039" class="Keyword">import</a> <a id="4046" href="IO.html" class="Module">IO</a>

<a id="4050" class="Keyword">open</a> <a id="4055" class="Keyword">import</a> <a id="4062" href="System.Clock.html" class="Module">System.Clock</a> <a id="4075" class="Symbol">as</a> <a id="4078" class="Module">Clock</a> <a id="4084" class="Keyword">using</a> <a id="4090" class="Symbol">(</a><a id="4091" href="System.Clock.html#2777" class="Function">time′</a><a id="4096" class="Symbol">;</a> <a id="4098" href="System.Clock.html#1932" class="Record">Time</a><a id="4102" class="Symbol">;</a> <a id="4104" href="System.Clock.html#1978" class="Field">seconds</a><a id="4111" class="Symbol">)</a>
<a id="4113" class="Keyword">open</a> <a id="4118" class="Keyword">import</a> <a id="4125" href="System.Console.ANSI.html" class="Module">System.Console.ANSI</a>
<a id="4145" class="Keyword">open</a> <a id="4150" class="Keyword">import</a> <a id="4157" href="System.Directory.html" class="Module">System.Directory</a> <a id="4174" class="Keyword">using</a> <a id="4180" class="Symbol">(</a><a id="4181" href="System.Directory.html#3068" class="Function">doesFileExist</a><a id="4194" class="Symbol">;</a> <a id="4196" href="System.Directory.html#3120" class="Function">doesDirectoryExist</a><a id="4214" class="Symbol">)</a>
<a id="4216" class="Keyword">open</a> <a id="4221" class="Keyword">import</a> <a id="4228" href="System.Environment.html" class="Module">System.Environment</a> <a id="4247" class="Keyword">using</a> <a id="4253" class="Symbol">(</a><a id="4254" href="System.Environment.html#660" class="Function">getArgs</a><a id="4261" class="Symbol">;</a> <a id="4263" href="System.Environment.html#777" class="Function">lookupEnv</a><a id="4272" class="Symbol">)</a>
<a id="4274" class="Keyword">open</a> <a id="4279" class="Keyword">import</a> <a id="4286" href="System.Exit.html" class="Module">System.Exit</a>
<a id="4298" class="Keyword">open</a> <a id="4303" class="Keyword">import</a> <a id="4310" href="System.FilePath.Posix.html" class="Module">System.FilePath.Posix</a> <a id="4332" class="Keyword">using</a> <a id="4338" class="Symbol">(</a><a id="4339" href="System.FilePath.Posix.Primitive.html#2556" class="Postulate">mkFilePath</a><a id="4349" class="Symbol">)</a>
<a id="4351" class="Keyword">open</a> <a id="4356" class="Keyword">import</a> <a id="4363" href="System.Process.html" class="Module">System.Process</a> <a id="4378" class="Keyword">using</a> <a id="4384" class="Symbol">(</a><a id="4385" href="System.Process.html#654" class="Function">callCommand</a><a id="4396" class="Symbol">;</a> <a id="4398" href="System.Process.html#734" class="Function">system</a><a id="4404" class="Symbol">)</a>

<a id="4407" class="Keyword">record</a> <a id="Options"></a><a id="4414" href="Test.Golden.html#4414" class="Record">Options</a> <a id="4422" class="Symbol">:</a> <a id="4424" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="4428" class="Keyword">where</a>
  <a id="4436" class="Keyword">field</a>
    <a id="4446" class="Comment">-- What is the name of the Agda executable?</a>
    <a id="Options.exeUnderTest"></a><a id="4494" href="Test.Golden.html#4494" class="Field">exeUnderTest</a> <a id="4507" class="Symbol">:</a> <a id="4509" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
    <a id="4520" class="Comment">-- Should we only run some specific cases?</a>
    <a id="Options.onlyNames"></a><a id="4567" href="Test.Golden.html#4567" class="Field">onlyNames</a> <a id="4577" class="Symbol">:</a> <a id="4579" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="4584" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
    <a id="4595" class="Comment">-- Should we run the test suite interactively?</a>
    <a id="Options.interactive"></a><a id="4646" href="Test.Golden.html#4646" class="Field">interactive</a> <a id="4658" class="Symbol">:</a> <a id="4660" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>
    <a id="4669" class="Comment">-- Should we time and display the tests?</a>
    <a id="Options.timing"></a><a id="4714" href="Test.Golden.html#4714" class="Field">timing</a> <a id="4721" class="Symbol">:</a> <a id="4723" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>
    <a id="4732" class="Comment">-- Should we write the list of failing cases to a file?</a>
    <a id="Options.failureFile"></a><a id="4792" href="Test.Golden.html#4792" class="Field">failureFile</a> <a id="4804" class="Symbol">:</a> <a id="4806" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="4812" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
    <a id="4823" class="Comment">-- Should we use ANSI escape codes to colour the output?</a>
    <a id="Options.colour"></a><a id="4884" href="Test.Golden.html#4884" class="Field">colour</a> <a id="4891" class="Symbol">:</a> <a id="4893" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>
<a id="4898" class="Keyword">open</a> <a id="4903" href="Test.Golden.html#4414" class="Module">Options</a>

<a id="initOptions"></a><a id="4912" href="Test.Golden.html#4912" class="Function">initOptions</a> <a id="4924" class="Symbol">:</a> <a id="4926" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="4933" class="Symbol">→</a> <a id="4935" href="Test.Golden.html#4414" class="Record">Options</a>
<a id="4943" href="Test.Golden.html#4912" class="Function">initOptions</a> <a id="4955" href="Test.Golden.html#4955" class="Bound">exe</a> <a id="4959" class="Symbol">=</a> <a id="4961" class="Keyword">record</a>
  <a id="4970" class="Symbol">{</a> <a id="4972" href="Test.Golden.html#4494" class="Field">exeUnderTest</a> <a id="4985" class="Symbol">=</a> <a id="4987" href="Test.Golden.html#4955" class="Bound">exe</a>
  <a id="4993" class="Symbol">;</a> <a id="4995" href="Test.Golden.html#4567" class="Field">onlyNames</a>    <a id="5008" class="Symbol">=</a> <a id="5010" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>
  <a id="5015" class="Symbol">;</a> <a id="5017" href="Test.Golden.html#4646" class="Field">interactive</a>  <a id="5030" class="Symbol">=</a> <a id="5032" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>
  <a id="5040" class="Symbol">;</a> <a id="5042" href="Test.Golden.html#4714" class="Field">timing</a>       <a id="5055" class="Symbol">=</a> <a id="5057" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>
  <a id="5065" class="Symbol">;</a> <a id="5067" href="Test.Golden.html#4792" class="Field">failureFile</a>  <a id="5080" class="Symbol">=</a> <a id="5082" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>
  <a id="5092" class="Symbol">;</a> <a id="5094" href="Test.Golden.html#4884" class="Field">colour</a>       <a id="5107" class="Symbol">=</a> <a id="5109" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
  <a id="5116" class="Symbol">}</a>

<a id="usage"></a><a id="5119" href="Test.Golden.html#5119" class="Function">usage</a> <a id="5125" class="Symbol">:</a> <a id="5127" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
<a id="5134" href="Test.Golden.html#5119" class="Function">usage</a> <a id="5140" class="Symbol">=</a> <a id="5142" href="Data.String.Base.html#2743" class="Function">unwords</a>
  <a id="5152" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="5154" class="String">&quot;Usage:&quot;</a>
  <a id="5165" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5167" class="String">&quot;runtests &lt;path&gt;&quot;</a>
  <a id="5187" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5189" class="String">&quot;[--timing]&quot;</a>
  <a id="5204" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5206" class="String">&quot;[--interactive]&quot;</a>
  <a id="5226" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5228" class="String">&quot;[--failure-file PATH]&quot;</a>
  <a id="5254" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5256" class="String">&quot;[--only-file PATH]&quot;</a>
  <a id="5279" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5281" class="String">&quot;[--no-colour]&quot;</a>
  <a id="5299" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5301" class="String">&quot;[--only [NAMES]]&quot;</a>
  <a id="5322" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5324" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

<a id="5328" class="Keyword">data</a> <a id="Error"></a><a id="5333" href="Test.Golden.html#5333" class="Datatype">Error</a> <a id="5339" class="Symbol">:</a> <a id="5341" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="5345" class="Keyword">where</a>
  <a id="Error.MissingExecutable"></a><a id="5353" href="Test.Golden.html#5353" class="InductiveConstructor">MissingExecutable</a> <a id="5371" class="Symbol">:</a> <a id="5373" href="Test.Golden.html#5333" class="Datatype">Error</a>
  <a id="Error.InvalidArgument"></a><a id="5381" href="Test.Golden.html#5381" class="InductiveConstructor">InvalidArgument</a> <a id="5397" class="Symbol">:</a> <a id="5399" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="5406" class="Symbol">→</a> <a id="5408" href="Test.Golden.html#5333" class="Datatype">Error</a>

<a id="show"></a><a id="5415" href="Test.Golden.html#5415" class="Function">show</a> <a id="5420" class="Symbol">:</a> <a id="5422" href="Test.Golden.html#5333" class="Datatype">Error</a> <a id="5428" class="Symbol">→</a> <a id="5430" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
<a id="5437" href="Test.Golden.html#5415" class="Function">show</a> <a id="5442" href="Test.Golden.html#5353" class="InductiveConstructor">MissingExecutable</a> <a id="5460" class="Symbol">=</a> <a id="5462" class="String">&quot;Expected a path to Agda, got nothing&quot;</a>
<a id="5501" href="Test.Golden.html#5415" class="Function">show</a> <a id="5506" class="Symbol">(</a><a id="5507" href="Test.Golden.html#5381" class="InductiveConstructor">InvalidArgument</a> <a id="5523" href="Test.Golden.html#5523" class="Bound">arg</a><a id="5526" class="Symbol">)</a> <a id="5528" class="Symbol">=</a> <a id="5530" class="String">&quot;Invalid argument: &quot;</a> <a id="5551" href="Data.String.Base.html#2400" class="Function Operator">String.++</a> <a id="5561" href="Test.Golden.html#5523" class="Bound">arg</a>

<a id="5566" class="Comment">-- Process the command line options</a>
<a id="options"></a><a id="5602" href="Test.Golden.html#5602" class="Function">options</a> <a id="5610" class="Symbol">:</a> <a id="5612" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="5617" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="5624" class="Symbol">→</a> <a id="5626" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="5629" class="Symbol">(</a><a id="5630" href="Test.Golden.html#5333" class="Datatype">Error</a> <a id="5636" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="5638" href="Test.Golden.html#4414" class="Record">Options</a><a id="5645" class="Symbol">)</a>
<a id="5647" href="Test.Golden.html#5602" class="Function">options</a><a id="5654" class="Symbol">(</a><a id="5655" href="Test.Golden.html#5655" class="Bound">exe</a> <a id="5659" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5661" href="Test.Golden.html#5661" class="Bound">rest</a><a id="5665" class="Symbol">)</a> <a id="5667" class="Symbol">=</a> <a id="5669" href="Test.Golden.html#6470" class="Function">mkOptions</a> <a id="5679" href="Test.Golden.html#5655" class="Bound">exe</a> <a id="5683" href="Test.Golden.html#5661" class="Bound">rest</a> <a id="5688" class="Keyword">where</a>

  <a id="5697" href="Test.Golden.html#5697" class="Function">go</a> <a id="5700" class="Symbol">:</a> <a id="5702" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="5707" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="5714" class="Symbol">→</a> <a id="5716" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="5722" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="5729" class="Symbol">→</a> <a id="5731" href="Test.Golden.html#4414" class="Record">Options</a> <a id="5739" class="Symbol">→</a> <a id="5741" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="5748" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="5750" class="Symbol">(</a><a id="5751" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="5757" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="5764" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5766" href="Test.Golden.html#4414" class="Record">Options</a><a id="5773" class="Symbol">)</a>
  <a id="5777" href="Test.Golden.html#5697" class="Function">go</a> <a id="5780" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>                             <a id="5811" href="Test.Golden.html#5811" class="Bound">mfp</a> <a id="5815" href="Test.Golden.html#5815" class="Bound">opts</a> <a id="5820" class="Symbol">=</a> <a id="5822" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="5827" class="Symbol">(</a><a id="5828" href="Test.Golden.html#5811" class="Bound">mfp</a> <a id="5832" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5834" href="Test.Golden.html#5815" class="Bound">opts</a><a id="5838" class="Symbol">)</a>
  <a id="5842" href="Test.Golden.html#5697" class="Function">go</a> <a id="5845" class="Symbol">(</a><a id="5846" class="String">&quot;--timing&quot;</a>            <a id="5868" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5870" href="Test.Golden.html#5870" class="Bound">args</a><a id="5874" class="Symbol">)</a> <a id="5876" href="Test.Golden.html#5876" class="Bound">mfp</a> <a id="5880" href="Test.Golden.html#5880" class="Bound">opts</a> <a id="5885" class="Symbol">=</a>
    <a id="5891" href="Test.Golden.html#5697" class="Function">go</a> <a id="5894" href="Test.Golden.html#5870" class="Bound">args</a> <a id="5899" href="Test.Golden.html#5876" class="Bound">mfp</a> <a id="5903" class="Symbol">(</a><a id="5904" class="Keyword">record</a> <a id="5911" href="Test.Golden.html#5880" class="Bound">opts</a> <a id="5916" class="Symbol">{</a> <a id="5918" href="Test.Golden.html#4714" class="Field">timing</a> <a id="5925" class="Symbol">=</a> <a id="5927" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a> <a id="5932" class="Symbol">})</a>
  <a id="5937" href="Test.Golden.html#5697" class="Function">go</a> <a id="5940" class="Symbol">(</a><a id="5941" class="String">&quot;--interactive&quot;</a>       <a id="5963" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5965" href="Test.Golden.html#5965" class="Bound">args</a><a id="5969" class="Symbol">)</a> <a id="5971" href="Test.Golden.html#5971" class="Bound">mfp</a> <a id="5975" href="Test.Golden.html#5975" class="Bound">opts</a> <a id="5980" class="Symbol">=</a>
    <a id="5986" href="Test.Golden.html#5697" class="Function">go</a> <a id="5989" href="Test.Golden.html#5965" class="Bound">args</a> <a id="5994" href="Test.Golden.html#5971" class="Bound">mfp</a> <a id="5998" class="Symbol">(</a><a id="5999" class="Keyword">record</a> <a id="6006" href="Test.Golden.html#5975" class="Bound">opts</a> <a id="6011" class="Symbol">{</a> <a id="6013" href="Test.Golden.html#4646" class="Field">interactive</a> <a id="6025" class="Symbol">=</a> <a id="6027" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a> <a id="6032" class="Symbol">})</a>
  <a id="6037" href="Test.Golden.html#5697" class="Function">go</a> <a id="6040" class="Symbol">(</a><a id="6041" class="String">&quot;--failure-file&quot;</a> <a id="6058" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="6060" href="Test.Golden.html#6060" class="Bound">fp</a> <a id="6063" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="6065" href="Test.Golden.html#6065" class="Bound">args</a><a id="6069" class="Symbol">)</a> <a id="6071" href="Test.Golden.html#6071" class="Bound">mfp</a> <a id="6075" href="Test.Golden.html#6075" class="Bound">opts</a> <a id="6080" class="Symbol">=</a>
    <a id="6086" href="Test.Golden.html#5697" class="Function">go</a> <a id="6089" href="Test.Golden.html#6065" class="Bound">args</a> <a id="6094" href="Test.Golden.html#6071" class="Bound">mfp</a> <a id="6098" class="Symbol">(</a><a id="6099" class="Keyword">record</a> <a id="6106" href="Test.Golden.html#6075" class="Bound">opts</a> <a id="6111" class="Symbol">{</a> <a id="6113" href="Test.Golden.html#4792" class="Field">failureFile</a> <a id="6125" class="Symbol">=</a> <a id="6127" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="6132" href="Test.Golden.html#6060" class="Bound">fp</a> <a id="6135" class="Symbol">})</a>
  <a id="6140" href="Test.Golden.html#5697" class="Function">go</a> <a id="6143" class="Symbol">(</a><a id="6144" class="String">&quot;--only&quot;</a>              <a id="6166" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="6168" href="Test.Golden.html#6168" class="Bound">args</a><a id="6172" class="Symbol">)</a> <a id="6174" href="Test.Golden.html#6174" class="Bound">mfp</a> <a id="6178" href="Test.Golden.html#6178" class="Bound">opts</a> <a id="6183" class="Symbol">=</a>
    <a id="6189" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6194" class="Symbol">(</a><a id="6195" href="Test.Golden.html#6174" class="Bound">mfp</a> <a id="6199" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="6201" class="Symbol">(</a><a id="6202" class="Keyword">record</a> <a id="6209" href="Test.Golden.html#6178" class="Bound">opts</a> <a id="6214" class="Symbol">{</a> <a id="6216" href="Test.Golden.html#4567" class="Field">onlyNames</a> <a id="6226" class="Symbol">=</a> <a id="6228" href="Test.Golden.html#6168" class="Bound">args</a> <a id="6233" class="Symbol">}))</a>
  <a id="6239" href="Test.Golden.html#5697" class="Function">go</a> <a id="6242" class="Symbol">(</a><a id="6243" class="String">&quot;--only-file&quot;</a> <a id="6257" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="6259" href="Test.Golden.html#6259" class="Bound">fp</a>    <a id="6265" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="6267" href="Test.Golden.html#6267" class="Bound">args</a><a id="6271" class="Symbol">)</a> <a id="6273" href="Test.Golden.html#6273" class="Bound">mfp</a> <a id="6277" href="Test.Golden.html#6277" class="Bound">opts</a> <a id="6282" class="Symbol">=</a>
    <a id="6288" href="Test.Golden.html#5697" class="Function">go</a> <a id="6291" href="Test.Golden.html#6267" class="Bound">args</a> <a id="6296" class="Symbol">(</a><a id="6297" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="6302" href="Test.Golden.html#6259" class="Bound">fp</a><a id="6304" class="Symbol">)</a> <a id="6306" class="Symbol">(</a><a id="6307" class="Keyword">record</a> <a id="6314" href="Test.Golden.html#6277" class="Bound">opts</a> <a id="6319" class="Symbol">{</a> <a id="6321" href="Test.Golden.html#4567" class="Field">onlyNames</a> <a id="6331" class="Symbol">=</a> <a id="6333" href="Test.Golden.html#6267" class="Bound">args</a> <a id="6338" class="Symbol">})</a>
  <a id="6343" href="Test.Golden.html#5697" class="Function">go</a> <a id="6346" class="Symbol">(</a><a id="6347" class="String">&quot;--no-colour&quot;</a>         <a id="6369" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="6371" href="Test.Golden.html#6371" class="Bound">args</a><a id="6375" class="Symbol">)</a> <a id="6377" href="Test.Golden.html#6377" class="Bound">mfp</a> <a id="6381" href="Test.Golden.html#6381" class="Bound">opts</a> <a id="6386" class="Symbol">=</a>
    <a id="6392" href="Test.Golden.html#5697" class="Function">go</a> <a id="6395" href="Test.Golden.html#6371" class="Bound">args</a> <a id="6400" href="Test.Golden.html#6377" class="Bound">mfp</a> <a id="6404" class="Symbol">(</a><a id="6405" class="Keyword">record</a> <a id="6412" href="Test.Golden.html#6381" class="Bound">opts</a> <a id="6417" class="Symbol">{</a> <a id="6419" href="Test.Golden.html#4884" class="Field">colour</a> <a id="6426" class="Symbol">=</a> <a id="6428" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a> <a id="6434" class="Symbol">})</a>
  <a id="6439" href="Test.Golden.html#5697" class="CatchallClause Function">go</a><a id="6441" class="CatchallClause"> </a><a id="6442" class="CatchallClause Symbol">(</a><a id="6443" href="Test.Golden.html#6443" class="CatchallClause Bound">arg</a><a id="6446" class="CatchallClause"> </a><a id="6447" href="Agda.Builtin.List.html#182" class="CatchallClause InductiveConstructor Operator">∷</a><a id="6448" class="CatchallClause"> </a><a id="6449" class="CatchallClause Symbol">_)</a><a id="6451" class="CatchallClause"> </a><a id="6452" class="CatchallClause Symbol">_</a><a id="6453" class="CatchallClause"> </a><a id="6454" class="CatchallClause Symbol">_</a> <a id="6456" class="Symbol">=</a> <a id="6458" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="6463" href="Test.Golden.html#6443" class="Bound">arg</a>

  <a id="6470" href="Test.Golden.html#6470" class="Function">mkOptions</a> <a id="6480" class="Symbol">:</a> <a id="6482" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="6489" class="Symbol">→</a> <a id="6491" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="6496" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="6503" class="Symbol">→</a> <a id="6505" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="6508" class="Symbol">(</a><a id="6509" href="Test.Golden.html#5333" class="Datatype">Error</a> <a id="6515" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="6517" href="Test.Golden.html#4414" class="Record">Options</a><a id="6524" class="Symbol">)</a>
  <a id="6528" href="Test.Golden.html#6470" class="Function">mkOptions</a> <a id="6538" href="Test.Golden.html#6538" class="Bound">exe</a> <a id="6542" href="Test.Golden.html#6542" class="Bound">rest</a> <a id="6547" class="Symbol">=</a> <a id="6549" class="Keyword">do</a>
    <a id="6556" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6561" class="Symbol">(</a><a id="6562" href="Test.Golden.html#6562" class="Bound">mfp</a> <a id="6566" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="6568" href="Test.Golden.html#6568" class="Bound">opts</a><a id="6572" class="Symbol">)</a> <a id="6574" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="6576" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="6581" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="6583" href="Test.Golden.html#5697" class="Function">go</a> <a id="6586" href="Test.Golden.html#6542" class="Bound">rest</a> <a id="6591" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="6599" class="Symbol">(</a><a id="6600" href="Test.Golden.html#4912" class="Function">initOptions</a> <a id="6612" href="Test.Golden.html#6538" class="Bound">exe</a><a id="6615" class="Symbol">)</a>
      <a id="6623" class="Keyword">where</a> <a id="6629" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="6634" href="Test.Golden.html#6634" class="Bound">arg</a> <a id="6638" class="Symbol">→</a> <a id="6640" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="6645" class="Symbol">(</a><a id="6646" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="6651" class="Symbol">(</a><a id="6652" href="Test.Golden.html#5381" class="InductiveConstructor">InvalidArgument</a> <a id="6668" href="Test.Golden.html#6634" class="Bound">arg</a><a id="6671" class="Symbol">))</a>
    <a id="6678" href="Test.Golden.html#6678" class="Bound">term</a> <a id="6683" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="6685" href="Data.Maybe.Base.html#1661" class="Function">fromMaybe</a> <a id="6695" class="String">&quot;&quot;</a> <a id="6698" href="IO.Base.html#1973" class="Function Operator">&lt;$&gt;</a> <a id="6702" href="System.Environment.html#777" class="Function">lookupEnv</a> <a id="6712" class="String">&quot;TERM&quot;</a>
    <a id="6723" class="Keyword">let</a> <a id="6727" href="Test.Golden.html#6727" class="Bound">opts</a> <a id="6732" class="Symbol">=</a> <a id="6734" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="6737" href="Relation.Nullary.Decidable.Core.html#1560" class="Field">does</a> <a id="6742" class="Symbol">(</a><a id="6743" href="Test.Golden.html#6678" class="Bound">term</a> <a id="6748" href="Data.String.Properties.html#2305" class="Function Operator">≟</a> <a id="6750" class="String">&quot;DUMB&quot;</a><a id="6756" class="Symbol">)</a>
               <a id="6773" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="6778" class="Keyword">record</a> <a id="6785" href="Test.Golden.html#6568" class="Bound">opts</a> <a id="6790" class="Symbol">{</a> <a id="6792" href="Test.Golden.html#4884" class="Field">colour</a> <a id="6799" class="Symbol">=</a> <a id="6801" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a> <a id="6807" class="Symbol">}</a>
               <a id="6824" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="6829" href="Test.Golden.html#6568" class="Bound">opts</a>
    <a id="6838" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="6843" href="Test.Golden.html#6843" class="Bound">fp</a> <a id="6846" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="6848" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="6853" href="Test.Golden.html#6562" class="Bound">mfp</a>
      <a id="6863" class="Keyword">where</a> <a id="6869" class="CatchallClause Symbol">_</a> <a id="6871" class="Symbol">→</a> <a id="6873" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="6878" class="Symbol">(</a><a id="6879" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6884" href="Test.Golden.html#6727" class="Bound">opts</a><a id="6888" class="Symbol">)</a>
    <a id="6894" href="Test.Golden.html#6894" class="Bound">only</a> <a id="6899" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="6901" href="IO.html#2873" class="Function">readFiniteFile</a> <a id="6916" href="Test.Golden.html#6843" class="Bound">fp</a>
    <a id="6923" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="6928" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="6930" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6935" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="6937" class="Keyword">record</a> <a id="6944" href="Test.Golden.html#6727" class="Bound">opts</a> <a id="6949" class="Symbol">{</a> <a id="6951" href="Test.Golden.html#4567" class="Field">onlyNames</a> <a id="6961" class="Symbol">=</a> <a id="6963" href="Data.String.Base.html#5084" class="Function">lines</a> <a id="6969" href="Test.Golden.html#6894" class="Bound">only</a> <a id="6974" href="Data.List.Base.html#1943" class="Function Operator">++</a> <a id="6977" href="Test.Golden.html#4567" class="Field">onlyNames</a> <a id="6987" href="Test.Golden.html#6727" class="Bound">opts</a> <a id="6992" class="Symbol">}</a>

<a id="6995" href="Test.Golden.html#5602" class="Function">options</a> <a id="7003" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="7006" class="Symbol">=</a> <a id="7008" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="7013" class="Symbol">(</a><a id="7014" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="7019" href="Test.Golden.html#5353" class="InductiveConstructor">MissingExecutable</a><a id="7036" class="Symbol">)</a>


<a id="7040" class="Comment">-- The result of a test run</a>
<a id="7068" class="Comment">-- `Left` corresponds to a failure and `Right` to a success</a>
<a id="Result"></a><a id="7128" href="Test.Golden.html#7128" class="Function">Result</a> <a id="7135" class="Symbol">:</a> <a id="7137" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="7141" href="Test.Golden.html#7128" class="Function">Result</a> <a id="7148" class="Symbol">=</a> <a id="7150" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="7157" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="7159" href="Agda.Builtin.String.html#318" class="Postulate">String</a>

<a id="7167" class="Comment">-- Run the specified golden test with the supplied options.</a>
<a id="runTest"></a><a id="7227" href="Test.Golden.html#7227" class="Function">runTest</a> <a id="7235" class="Symbol">:</a> <a id="7237" href="Test.Golden.html#4414" class="Record">Options</a> <a id="7245" class="Symbol">→</a> <a id="7247" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="7254" class="Symbol">→</a> <a id="7256" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="7259" href="Test.Golden.html#7128" class="Function">Result</a>
<a id="7266" href="Test.Golden.html#7227" class="Function">runTest</a> <a id="7274" href="Test.Golden.html#7274" class="Bound">opts</a> <a id="7279" href="Test.Golden.html#7279" class="Bound">testPath</a> <a id="7288" class="Symbol">=</a> <a id="7290" class="Keyword">do</a>

  <a id="7296" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a> <a id="7301" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="7303" href="System.Directory.html#3120" class="Function">doesDirectoryExist</a> <a id="7322" class="Symbol">(</a><a id="7323" href="System.FilePath.Posix.Primitive.html#2556" class="Postulate">mkFilePath</a> <a id="7334" href="Test.Golden.html#7279" class="Bound">testPath</a><a id="7342" class="Symbol">)</a>
    <a id="7348" class="Keyword">where</a> <a id="7354" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a> <a id="7360" class="Symbol">→</a> <a id="7362" href="Test.Golden.html#8907" class="Function">fail</a> <a id="7367" href="Test.Golden.html#8528" class="Function">directoryNotFound</a>

  <a id="7388" href="Test.Golden.html#7388" class="Bound">time</a> <a id="7393" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="7395" href="System.Clock.html#2777" class="Function">time′</a> <a id="7401" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="7403" href="System.Process.html#654" class="Function">callCommand</a> <a id="7415" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="7417" href="Data.String.Base.html#2743" class="Function">unwords</a>
           <a id="7436" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="7438" class="String">&quot;cd&quot;</a> <a id="7443" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="7445" href="Test.Golden.html#7279" class="Bound">testPath</a>
           <a id="7465" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="7467" class="String">&quot;&amp;&amp;&quot;</a> <a id="7472" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="7474" class="String">&quot;sh ./run&quot;</a> <a id="7485" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="7487" href="Test.Golden.html#7274" class="Bound">opts</a> <a id="7492" class="Symbol">.</a><a id="7493" href="Test.Golden.html#4494" class="Field">exeUnderTest</a>
           <a id="7517" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="7519" class="String">&quot;| tr -d &#39;\\r&#39; &gt; output&quot;</a>
           <a id="7555" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="7557" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

  <a id="7563" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="7568" href="Test.Golden.html#7568" class="Bound">out</a> <a id="7572" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="7574" href="Test.Golden.html#9008" class="Function">readLocalFile</a> <a id="7588" class="String">&quot;output&quot;</a>
    <a id="7601" class="Keyword">where</a> <a id="7607" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="7615" class="Symbol">→</a> <a id="7617" href="Test.Golden.html#8907" class="Function">fail</a> <a id="7622" class="Symbol">(</a><a id="7623" href="Test.Golden.html#8707" class="Function">fileNotFound</a> <a id="7636" class="String">&quot;output&quot;</a><a id="7644" class="Symbol">)</a>
  <a id="7648" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="7653" href="Test.Golden.html#7653" class="Bound">exp</a> <a id="7657" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="7659" href="Test.Golden.html#9008" class="Function">readLocalFile</a> <a id="7673" class="String">&quot;expected&quot;</a>
    <a id="7688" class="Keyword">where</a> <a id="7694" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="7702" class="Symbol">→</a> <a id="7704" class="Keyword">do</a> <a id="7707" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="7710" href="Test.Golden.html#7274" class="Bound">opts</a> <a id="7715" class="Symbol">.</a><a id="7716" href="Test.Golden.html#4646" class="Field">interactive</a>
                         <a id="7753" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="7758" href="Test.Golden.html#9775" class="Function">mayOverwrite</a> <a id="7771" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="7779" href="Test.Golden.html#7568" class="Bound">out</a>
                         <a id="7808" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="7813" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="7822" class="Symbol">(</a><a id="7823" href="Test.Golden.html#8707" class="Function">fileNotFound</a> <a id="7836" class="String">&quot;expected&quot;</a><a id="7846" class="Symbol">)</a>
                       <a id="7871" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="7876" class="Symbol">(</a><a id="7877" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="7882" href="Test.Golden.html#7279" class="Bound">testPath</a><a id="7890" class="Symbol">)</a>

  <a id="7895" class="Keyword">let</a> <a id="7899" href="Test.Golden.html#7899" class="Bound">result</a> <a id="7906" class="Symbol">=</a> <a id="7908" href="Relation.Nullary.Decidable.Core.html#1560" class="Field">does</a> <a id="7913" class="Symbol">(</a><a id="7914" href="Test.Golden.html#7568" class="Bound">out</a> <a id="7918" href="Data.String.Properties.html#2305" class="Function Operator">String.≟</a> <a id="7927" href="Test.Golden.html#7653" class="Bound">exp</a><a id="7930" class="Symbol">)</a>

  <a id="7935" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="7938" href="Test.Golden.html#7899" class="Bound">result</a>
    <a id="7949" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="7954" href="Test.Golden.html#10591" class="Function">printTiming</a> <a id="7966" class="Symbol">(</a><a id="7967" href="Test.Golden.html#7274" class="Bound">opts</a> <a id="7972" class="Symbol">.</a><a id="7973" href="Test.Golden.html#4714" class="Field">timing</a><a id="7979" class="Symbol">)</a> <a id="7981" href="Test.Golden.html#7388" class="Bound">time</a>
           <a id="7997" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="7999" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="8002" href="Test.Golden.html#7274" class="Bound">opts</a> <a id="8007" class="Symbol">.</a><a id="8008" href="Test.Golden.html#4884" class="Field">colour</a>
               <a id="8030" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="8035" href="System.Console.ANSI.html#2086" class="Function">withCommand</a> <a id="8047" class="Symbol">(</a><a id="8048" href="System.Console.ANSI.html#987" class="InductiveConstructor">setColour</a> <a id="8058" href="System.Console.ANSI.html#556" class="InductiveConstructor">foreground</a> <a id="8069" href="System.Console.ANSI.html#699" class="InductiveConstructor">classic</a> <a id="8077" href="System.Console.ANSI.html#623" class="InductiveConstructor">green</a><a id="8082" class="Symbol">)</a>
               <a id="8099" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="8104" href="Function.Base.html#704" class="Function">id</a>
           <a id="8118" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="8120" class="String">&quot;success&quot;</a>
    <a id="8134" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="8139" class="Keyword">do</a> <a id="8142" href="Test.Golden.html#10591" class="Function">printTiming</a> <a id="8154" class="Symbol">(</a><a id="8155" href="Test.Golden.html#7274" class="Bound">opts</a> <a id="8160" class="Symbol">.</a><a id="8161" href="Test.Golden.html#4714" class="Field">timing</a><a id="8167" class="Symbol">)</a> <a id="8169" href="Test.Golden.html#7388" class="Bound">time</a>
             <a id="8187" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="8189" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="8192" href="Test.Golden.html#7274" class="Bound">opts</a> <a id="8197" class="Symbol">.</a><a id="8198" href="Test.Golden.html#4884" class="Field">colour</a>
               <a id="8220" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="8225" href="System.Console.ANSI.html#2086" class="Function">withCommand</a> <a id="8237" class="Symbol">(</a><a id="8238" href="System.Console.ANSI.html#987" class="InductiveConstructor">setColour</a> <a id="8248" href="System.Console.ANSI.html#556" class="InductiveConstructor">foreground</a> <a id="8259" href="System.Console.ANSI.html#707" class="InductiveConstructor">bright</a> <a id="8266" href="System.Console.ANSI.html#619" class="InductiveConstructor">red</a><a id="8269" class="Symbol">)</a>
               <a id="8286" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="8291" href="Function.Base.html#704" class="Function">id</a>
             <a id="8307" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="8309" class="String">&quot;FAILURE&quot;</a>
            <a id="8331" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="8334" href="Test.Golden.html#7274" class="Bound">opts</a> <a id="8339" class="Symbol">.</a><a id="8340" href="Test.Golden.html#4646" class="Field">interactive</a>
              <a id="8366" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="8371" href="Test.Golden.html#9775" class="Function">mayOverwrite</a> <a id="8384" class="Symbol">(</a><a id="8385" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="8390" href="Test.Golden.html#7653" class="Bound">exp</a><a id="8393" class="Symbol">)</a> <a id="8395" href="Test.Golden.html#7568" class="Bound">out</a>
              <a id="8413" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="8418" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="8427" class="Symbol">(</a><a id="8428" href="Data.String.Base.html#2801" class="Function">unlines</a> <a id="8436" class="Symbol">(</a><a id="8437" href="Test.Golden.html#9541" class="Function">expVsOut</a> <a id="8446" href="Test.Golden.html#7653" class="Bound">exp</a> <a id="8450" href="Test.Golden.html#7568" class="Bound">out</a><a id="8453" class="Symbol">))</a>

  <a id="8459" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="8464" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="8466" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="8469" href="Test.Golden.html#7899" class="Bound">result</a> <a id="8476" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="8481" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="8486" href="Test.Golden.html#7279" class="Bound">testPath</a> <a id="8495" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="8500" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="8505" href="Test.Golden.html#7279" class="Bound">testPath</a>

  <a id="8517" class="Keyword">where</a>

    <a id="8528" href="Test.Golden.html#8528" class="Function">directoryNotFound</a> <a id="8546" class="Symbol">:</a> <a id="8548" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
    <a id="8559" href="Test.Golden.html#8528" class="Function">directoryNotFound</a> <a id="8577" class="Symbol">=</a> <a id="8579" href="Data.String.Base.html#2743" class="Function">unwords</a>
                      <a id="8609" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="8611" class="String">&quot;Directory&quot;</a>
                      <a id="8645" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="8647" href="Test.Golden.html#7279" class="Bound">testPath</a>
                      <a id="8678" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="8680" class="String">&quot;does not exist&quot;</a> <a id="8697" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="8699" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

    <a id="8707" href="Test.Golden.html#8707" class="Function">fileNotFound</a> <a id="8720" class="Symbol">:</a> <a id="8722" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="8729" class="Symbol">→</a> <a id="8731" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
    <a id="8742" href="Test.Golden.html#8707" class="Function">fileNotFound</a> <a id="8755" href="Test.Golden.html#8755" class="Bound">name</a> <a id="8760" class="Symbol">=</a> <a id="8762" href="Data.String.Base.html#2743" class="Function">unwords</a>
                      <a id="8792" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="8794" class="String">&quot;File&quot;</a>
                      <a id="8823" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="8825" class="Symbol">(</a><a id="8826" href="Test.Golden.html#7279" class="Bound">testPath</a> <a id="8835" href="Data.String.Base.html#2400" class="Function Operator">String.++</a> <a id="8845" class="String">&quot;/output&quot;</a><a id="8854" class="Symbol">)</a>
                      <a id="8878" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="8880" class="String">&quot;does not exist&quot;</a> <a id="8897" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="8899" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

    <a id="8907" href="Test.Golden.html#8907" class="Function">fail</a> <a id="8912" class="Symbol">:</a> <a id="8914" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="8921" class="Symbol">→</a> <a id="8923" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="8926" href="Test.Golden.html#7128" class="Function">Result</a>
    <a id="8937" href="Test.Golden.html#8907" class="Function">fail</a> <a id="8942" href="Test.Golden.html#8942" class="Bound">msg</a> <a id="8946" class="Symbol">=</a> <a id="8948" class="Keyword">do</a> <a id="8951" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="8960" href="Test.Golden.html#8942" class="Bound">msg</a>
                  <a id="8982" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="8987" class="Symbol">(</a><a id="8988" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="8993" href="Test.Golden.html#7279" class="Bound">testPath</a><a id="9001" class="Symbol">)</a>

    <a id="9008" href="Test.Golden.html#9008" class="Function">readLocalFile</a> <a id="9022" class="Symbol">:</a> <a id="9024" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="9031" class="Symbol">→</a> <a id="9033" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="9036" class="Symbol">(</a><a id="9037" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="9043" href="Agda.Builtin.String.html#318" class="Postulate">String</a><a id="9049" class="Symbol">)</a>
    <a id="9055" href="Test.Golden.html#9008" class="Function">readLocalFile</a> <a id="9069" href="Test.Golden.html#9069" class="Bound">name</a> <a id="9074" class="Symbol">=</a> <a id="9076" class="Keyword">do</a>
      <a id="9085" class="Keyword">let</a> <a id="9089" href="Test.Golden.html#9089" class="Bound">fp</a> <a id="9092" class="Symbol">=</a> <a id="9094" href="Data.String.Base.html#2588" class="Function">concat</a> <a id="9101" class="Symbol">(</a><a id="9102" href="Test.Golden.html#7279" class="Bound">testPath</a> <a id="9111" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="9113" class="String">&quot;/&quot;</a> <a id="9117" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="9119" href="Test.Golden.html#9069" class="Bound">name</a> <a id="9124" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="9126" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="9128" class="Symbol">)</a>
      <a id="9136" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a> <a id="9141" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="9143" href="System.Directory.html#3068" class="Function">doesFileExist</a> <a id="9157" class="Symbol">(</a><a id="9158" href="System.FilePath.Posix.Primitive.html#2556" class="Postulate">mkFilePath</a> <a id="9169" href="Test.Golden.html#9089" class="Bound">fp</a><a id="9171" class="Symbol">)</a>
        <a id="9181" class="Keyword">where</a> <a id="9187" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a> <a id="9193" class="Symbol">→</a> <a id="9195" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="9200" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>
      <a id="9214" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="9219" href="IO.Base.html#1973" class="Function Operator">&lt;$&gt;</a> <a id="9223" href="IO.html#2873" class="Function">readFiniteFile</a> <a id="9238" href="Test.Golden.html#9089" class="Bound">fp</a>

    <a id="9246" href="Test.Golden.html#9246" class="Function">getAnswer</a> <a id="9256" class="Symbol">:</a> <a id="9258" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="9261" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>
    <a id="9270" href="Test.Golden.html#9246" class="Function">getAnswer</a> <a id="9280" class="Symbol">=</a> <a id="9282" href="IO.Base.html#3674" class="Function">untilJust</a> <a id="9292" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="9294" class="Keyword">do</a>
      <a id="9303" href="Test.Golden.html#9303" class="Bound">str</a> <a id="9307" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="9309" href="IO.Finite.html#1045" class="Function">getLine</a>
      <a id="9323" href="Function.Base.html#4062" class="Function Operator">case</a> <a id="9328" href="Test.Golden.html#9303" class="Bound">str</a> <a id="9332" href="Function.Base.html#4062" class="Function Operator">of</a> <a id="9335" class="Symbol">λ</a> <a id="9337" class="Keyword">where</a>
        <a id="9351" class="String">&quot;y&quot;</a> <a id="9355" class="Symbol">→</a> <a id="9357" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="9362" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="9364" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="9369" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
        <a id="9382" class="String">&quot;n&quot;</a> <a id="9386" class="Symbol">→</a> <a id="9388" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="9393" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="9395" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="9400" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>
        <a id="9414" class="String">&quot;&quot;</a>  <a id="9418" class="Symbol">→</a> <a id="9420" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="9425" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="9427" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="9432" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a> <a id="9438" class="Comment">-- default answer is no</a>
        <a id="9470" class="Symbol">_</a>   <a id="9474" class="Symbol">→</a> <a id="9476" class="Keyword">do</a> <a id="9479" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="9488" class="String">&quot;Invalid answer.&quot;</a>
                 <a id="9523" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="9528" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>

    <a id="9541" href="Test.Golden.html#9541" class="Function">expVsOut</a> <a id="9550" class="Symbol">:</a> <a id="9552" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="9559" class="Symbol">→</a> <a id="9561" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="9568" class="Symbol">→</a> <a id="9570" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="9575" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
    <a id="9586" href="Test.Golden.html#9541" class="Function">expVsOut</a> <a id="9595" href="Test.Golden.html#9595" class="Bound">exp</a> <a id="9599" href="Test.Golden.html#9599" class="Bound">out</a> <a id="9603" class="Symbol">=</a> <a id="9605" class="String">&quot;Expected:&quot;</a> <a id="9617" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="9619" href="Test.Golden.html#9595" class="Bound">exp</a> <a id="9623" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="9625" class="String">&quot;Given:&quot;</a> <a id="9634" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="9636" href="Test.Golden.html#9599" class="Bound">out</a> <a id="9640" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="9642" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

    <a id="9650" href="Test.Golden.html#9650" class="Function">hasFailed</a> <a id="9660" class="Symbol">:</a> <a id="9662" href="System.Exit.Primitive.html#402" class="Datatype">ExitCode</a> <a id="9671" class="Symbol">→</a> <a id="9673" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>
    <a id="9682" href="Test.Golden.html#9650" class="Function">hasFailed</a> <a id="9692" href="System.Exit.Primitive.html#425" class="InductiveConstructor">ExitSuccess</a>        <a id="9711" class="Symbol">=</a> <a id="9713" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>
    <a id="9723" href="Test.Golden.html#9650" class="Function">hasFailed</a> <a id="9733" class="Symbol">(</a><a id="9734" href="System.Exit.Primitive.html#450" class="InductiveConstructor">ExitFailure</a> <a id="9746" href="Test.Golden.html#9746" class="Bound">code</a><a id="9750" class="Symbol">)</a> <a id="9752" class="Symbol">=</a> <a id="9754" href="Test.Golden.html#9746" class="Bound">code</a> <a id="9759" href="Data.Integer.Base.html#2610" class="Function Operator">ℤ.≤ᵇ</a> <a id="9764" href="Agda.Builtin.Int.html#246" class="InductiveConstructor Operator">ℤ.+</a> <a id="9768" class="Number">0</a>

    <a id="9775" href="Test.Golden.html#9775" class="Function">mayOverwrite</a> <a id="9788" class="Symbol">:</a> <a id="9790" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="9796" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="9803" class="Symbol">→</a> <a id="9805" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="9812" class="Symbol">→</a> <a id="9814" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="9817" class="Symbol">_</a>
    <a id="9823" href="Test.Golden.html#9775" class="Function">mayOverwrite</a> <a id="9836" href="Test.Golden.html#9836" class="Bound">mexp</a> <a id="9841" href="Test.Golden.html#9841" class="Bound">out</a> <a id="9845" class="Symbol">=</a> <a id="9847" class="Keyword">do</a>
      <a id="9856" href="Function.Base.html#4062" class="Function Operator">case</a> <a id="9861" href="Test.Golden.html#9836" class="Bound">mexp</a> <a id="9866" href="Function.Base.html#4062" class="Function Operator">of</a> <a id="9869" class="Symbol">λ</a> <a id="9871" class="Keyword">where</a>
        <a id="9885" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="9893" class="Symbol">→</a> <a id="9895" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="9904" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="9906" href="Data.String.Base.html#2801" class="Function">unlines</a>
          <a id="9924" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="9926" class="String">&quot;Golden value missing. I computed the following result:&quot;</a>
          <a id="9993" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="9995" href="Test.Golden.html#9841" class="Bound">out</a>
          <a id="10009" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10011" class="String">&quot;Accept new golden value? [y/N]&quot;</a>
          <a id="10054" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10056" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>
        <a id="10067" class="Symbol">(</a><a id="10068" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="10073" href="Test.Golden.html#10073" class="Bound">exp</a><a id="10076" class="Symbol">)</a> <a id="10078" class="Symbol">→</a> <a id="10080" class="Keyword">do</a>
          <a id="10093" href="Test.Golden.html#10093" class="Bound">code</a> <a id="10098" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="10100" href="System.Process.html#734" class="Function">system</a> <a id="10107" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="10109" href="Data.String.Base.html#2588" class="Function">concat</a>
            <a id="10128" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="10130" class="String">&quot;git diff --no-index --exit-code --word-diff=color &quot;</a>
            <a id="10195" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10197" href="Test.Golden.html#7279" class="Bound">testPath</a> <a id="10206" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10208" class="String">&quot;/expected &quot;</a>
            <a id="10233" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10235" href="Test.Golden.html#7279" class="Bound">testPath</a> <a id="10244" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10246" class="String">&quot;/output&quot;</a>
            <a id="10268" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10270" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>
          <a id="10283" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="10292" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="10294" href="Data.String.Base.html#2801" class="Function">unlines</a>
            <a id="10314" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="10316" class="String">&quot;Golden value differs from actual value.&quot;</a>
            <a id="10370" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10372" class="Symbol">(</a><a id="10373" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="10376" href="Test.Golden.html#9650" class="Function">hasFailed</a> <a id="10386" href="Test.Golden.html#10093" class="Bound">code</a> <a id="10391" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="10396" href="Test.Golden.html#9541" class="Function">expVsOut</a> <a id="10405" href="Test.Golden.html#10073" class="Bound">exp</a> <a id="10409" href="Test.Golden.html#9841" class="Bound">out</a> <a id="10413" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="10418" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="10420" class="Symbol">)</a>
            <a id="10434" href="Data.List.Base.html#1943" class="Function Operator">++</a> <a id="10437" class="String">&quot;Accept actual value as new golden value? [y/N]&quot;</a>
            <a id="10498" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10500" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

      <a id="10510" href="Test.Golden.html#10510" class="Bound">b</a> <a id="10512" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="10514" href="Test.Golden.html#9246" class="Function">getAnswer</a>
      <a id="10530" href="IO.Base.html#3334" class="Function">when</a> <a id="10535" href="Test.Golden.html#10510" class="Bound">b</a> <a id="10537" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="10539" href="IO.Finite.html#1276" class="Function">writeFile</a> <a id="10549" class="Symbol">(</a><a id="10550" href="Test.Golden.html#7279" class="Bound">testPath</a> <a id="10559" href="Data.String.Base.html#2400" class="Function Operator">String.++</a> <a id="10569" class="String">&quot;/expected&quot;</a><a id="10580" class="Symbol">)</a> <a id="10582" href="Test.Golden.html#9841" class="Bound">out</a>

    <a id="10591" href="Test.Golden.html#10591" class="Function">printTiming</a> <a id="10603" class="Symbol">:</a> <a id="10605" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a> <a id="10610" class="Symbol">→</a> <a id="10612" href="System.Clock.html#1932" class="Record">Time</a> <a id="10617" class="Symbol">→</a> <a id="10619" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="10626" class="Symbol">→</a> <a id="10628" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="10631" class="Symbol">_</a>
    <a id="10637" href="Test.Golden.html#10591" class="Function">printTiming</a> <a id="10649" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a> <a id="10655" class="Symbol">_</a>    <a id="10660" href="Test.Golden.html#10660" class="Bound">msg</a> <a id="10664" class="Symbol">=</a> <a id="10666" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="10675" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="10677" href="Data.String.Base.html#2588" class="Function">concat</a> <a id="10684" class="Symbol">(</a><a id="10685" href="Test.Golden.html#7279" class="Bound">testPath</a> <a id="10694" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10696" class="String">&quot;: &quot;</a> <a id="10701" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10703" href="Test.Golden.html#10660" class="Bound">msg</a> <a id="10707" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10709" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="10711" class="Symbol">)</a>
    <a id="10717" href="Test.Golden.html#10591" class="Function">printTiming</a> <a id="10729" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>  <a id="10735" href="Test.Golden.html#10735" class="Bound">time</a> <a id="10740" href="Test.Golden.html#10740" class="Bound">msg</a> <a id="10744" class="Symbol">=</a>
      <a id="10752" class="Keyword">let</a> <a id="10756" href="Test.Golden.html#10756" class="Bound">time</a>  <a id="10762" class="Symbol">=</a> <a id="10764" href="Data.Nat.Show.html#1972" class="Function">ℕ.show</a> <a id="10771" class="Symbol">(</a><a id="10772" href="Test.Golden.html#10735" class="Bound">time</a> <a id="10777" class="Symbol">.</a><a id="10778" href="System.Clock.html#1978" class="Field">seconds</a><a id="10785" class="Symbol">)</a> <a id="10787" href="Data.String.Base.html#2400" class="Function Operator">String.++</a> <a id="10797" class="String">&quot;s&quot;</a>
          <a id="10811" href="Test.Golden.html#10811" class="Bound">spent</a> <a id="10817" class="Symbol">=</a> <a id="10819" class="Number">9</a> <a id="10821" href="Agda.Builtin.Nat.html#319" class="Primitive Operator">+</a> <a id="10823" href="Data.List.Base.html#4992" class="Function">List.sum</a> <a id="10832" class="Symbol">(</a><a id="10833" href="Data.List.Base.html#1620" class="Function">List.map</a> <a id="10842" href="Data.String.Base.html#2464" class="Function">String.length</a> <a id="10856" class="Symbol">(</a><a id="10857" href="Test.Golden.html#7279" class="Bound">testPath</a> <a id="10866" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10868" href="Test.Golden.html#10756" class="Bound">time</a> <a id="10873" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10875" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="10877" class="Symbol">))</a>
               <a id="10895" class="Comment">-- ^ hack: both &quot;success&quot; and &quot;FAILURE&quot; have the same length</a>
               <a id="10971" class="Comment">--   can&#39;t use `String.length msg` because the msg contains escape codes</a>
          <a id="11054" href="Test.Golden.html#11054" class="Bound">pad</a>   <a id="11060" class="Symbol">=</a> <a id="11062" href="Data.String.Base.html#2515" class="Function">String.replicate</a> <a id="11079" class="Symbol">(</a><a id="11080" class="Number">72</a> <a id="11083" href="Data.Nat.Base.html#3211" class="Primitive Operator">∸</a> <a id="11085" href="Test.Golden.html#10811" class="Bound">spent</a><a id="11090" class="Symbol">)</a> <a id="11092" class="String">&#39; &#39;</a>
      <a id="11102" class="Keyword">in</a> <a id="11105" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="11114" class="Symbol">(</a><a id="11115" href="Data.String.Base.html#2588" class="Function">concat</a> <a id="11122" class="Symbol">(</a><a id="11123" href="Test.Golden.html#7279" class="Bound">testPath</a> <a id="11132" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="11134" class="String">&quot;: &quot;</a> <a id="11139" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="11141" href="Test.Golden.html#10740" class="Bound">msg</a> <a id="11145" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="11147" href="Test.Golden.html#11054" class="Bound">pad</a> <a id="11151" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="11153" href="Test.Golden.html#10756" class="Bound">time</a> <a id="11158" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="11160" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="11162" class="Symbol">))</a>

<a id="11166" class="Comment">-- A test pool is characterised by</a>
<a id="11201" class="Comment">--  + a name</a>
<a id="11214" class="Comment">--  + and a list of directory paths</a>
<a id="11250" class="Keyword">record</a> <a id="TestPool"></a><a id="11257" href="Test.Golden.html#11257" class="Record">TestPool</a> <a id="11266" class="Symbol">:</a> <a id="11268" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="11272" class="Keyword">where</a>
  <a id="11280" class="Keyword">constructor</a> <a id="mkTestPool"></a><a id="11292" href="Test.Golden.html#11292" class="InductiveConstructor">mkTestPool</a>
  <a id="11305" class="Keyword">field</a>
    <a id="TestPool.poolName"></a><a id="11315" href="Test.Golden.html#11315" class="Field">poolName</a> <a id="11324" class="Symbol">:</a> <a id="11326" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
    <a id="TestPool.testCases"></a><a id="11337" href="Test.Golden.html#11337" class="Field">testCases</a> <a id="11347" class="Symbol">:</a> <a id="11349" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="11354" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
<a id="11361" class="Keyword">open</a> <a id="11366" href="Test.Golden.html#11257" class="Module">TestPool</a>

<a id="11376" class="Keyword">module</a> <a id="Summary"></a><a id="11383" href="Test.Golden.html#11383" class="Module">Summary</a> <a id="11391" class="Keyword">where</a>

  <a id="11400" class="Comment">-- The summary of a test pool run</a>
  <a id="11436" class="Keyword">record</a> <a id="Summary.Summary"></a><a id="11443" href="Test.Golden.html#11443" class="Record">Summary</a> <a id="11451" class="Symbol">:</a> <a id="11453" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="11457" class="Keyword">where</a>
    <a id="11467" class="Keyword">constructor</a> <a id="Summary.mkSummary"></a><a id="11479" href="Test.Golden.html#11479" class="InductiveConstructor">mkSummary</a>
    <a id="11493" class="Keyword">field</a>
      <a id="Summary.Summary.success"></a><a id="11505" href="Test.Golden.html#11505" class="Field">success</a> <a id="11513" class="Symbol">:</a> <a id="11515" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="11520" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
      <a id="Summary.Summary.failure"></a><a id="11533" href="Test.Golden.html#11533" class="Field">failure</a> <a id="11541" class="Symbol">:</a> <a id="11543" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="11548" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
  <a id="11557" class="Keyword">open</a> <a id="11562" href="Test.Golden.html#11443" class="Module">Summary</a> <a id="11570" class="Keyword">public</a>

  <a id="Summary.init"></a><a id="11580" href="Test.Golden.html#11580" class="Function">init</a> <a id="11585" class="Symbol">:</a> <a id="11587" href="Test.Golden.html#11443" class="Record">Summary</a>
  <a id="11597" href="Test.Golden.html#11580" class="Function">init</a> <a id="11602" class="Symbol">=</a> <a id="11604" href="Test.Golden.html#11479" class="InductiveConstructor">mkSummary</a> <a id="11614" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="11617" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

  <a id="Summary.merge"></a><a id="11623" href="Test.Golden.html#11623" class="Function">merge</a> <a id="11629" class="Symbol">:</a> <a id="11631" href="Test.Golden.html#11443" class="Record">Summary</a> <a id="11639" class="Symbol">→</a> <a id="11641" href="Test.Golden.html#11443" class="Record">Summary</a> <a id="11649" class="Symbol">→</a> <a id="11651" href="Test.Golden.html#11443" class="Record">Summary</a>
  <a id="11661" href="Test.Golden.html#11623" class="Function">merge</a> <a id="11667" class="Symbol">(</a><a id="11668" href="Test.Golden.html#11479" class="InductiveConstructor">mkSummary</a> <a id="11678" href="Test.Golden.html#11678" class="Bound">ws1</a> <a id="11682" href="Test.Golden.html#11682" class="Bound">ls1</a><a id="11685" class="Symbol">)</a> <a id="11687" class="Symbol">(</a><a id="11688" href="Test.Golden.html#11479" class="InductiveConstructor">mkSummary</a> <a id="11698" href="Test.Golden.html#11698" class="Bound">ws2</a> <a id="11702" href="Test.Golden.html#11702" class="Bound">ls2</a><a id="11705" class="Symbol">)</a> <a id="11707" class="Symbol">=</a>
   <a id="11712" href="Test.Golden.html#11479" class="InductiveConstructor">mkSummary</a> <a id="11722" class="Symbol">(</a><a id="11723" href="Test.Golden.html#11698" class="Bound">ws2</a> <a id="11727" href="Data.List.Base.html#1943" class="Function Operator">++</a> <a id="11730" href="Test.Golden.html#11678" class="Bound">ws1</a><a id="11733" class="Symbol">)</a> <a id="11735" class="Symbol">(</a><a id="11736" href="Test.Golden.html#11702" class="Bound">ls2</a> <a id="11740" href="Data.List.Base.html#1943" class="Function Operator">++</a> <a id="11743" href="Test.Golden.html#11682" class="Bound">ls1</a><a id="11746" class="Symbol">)</a>

  <a id="Summary.update"></a><a id="11751" href="Test.Golden.html#11751" class="Function">update</a> <a id="11758" class="Symbol">:</a> <a id="11760" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="11765" href="Test.Golden.html#7128" class="Function">Result</a> <a id="11772" class="Symbol">→</a> <a id="11774" href="Test.Golden.html#11443" class="Record">Summary</a> <a id="11782" class="Symbol">→</a> <a id="11784" href="Test.Golden.html#11443" class="Record">Summary</a>
  <a id="11794" href="Test.Golden.html#11751" class="Function">update</a> <a id="11801" href="Test.Golden.html#11801" class="Bound">res</a> <a id="11805" href="Test.Golden.html#11805" class="Bound">sum</a> <a id="11809" class="Symbol">=</a>
    <a id="11815" class="Keyword">let</a> <a id="11819" class="Symbol">(</a><a id="11820" href="Test.Golden.html#11820" class="Bound">ls2</a> <a id="11824" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="11826" href="Test.Golden.html#11826" class="Bound">ws2</a><a id="11829" class="Symbol">)</a> <a id="11831" class="Symbol">=</a> <a id="11833" href="Data.List.Base.html#3893" class="Function">partitionSums</a> <a id="11847" href="Test.Golden.html#11801" class="Bound">res</a> <a id="11851" class="Keyword">in</a>
    <a id="11858" href="Test.Golden.html#11623" class="Function">merge</a> <a id="11864" href="Test.Golden.html#11805" class="Bound">sum</a> <a id="11868" class="Symbol">(</a><a id="11869" href="Test.Golden.html#11479" class="InductiveConstructor">mkSummary</a> <a id="11879" href="Test.Golden.html#11826" class="Bound">ws2</a> <a id="11883" href="Test.Golden.html#11820" class="Bound">ls2</a><a id="11886" class="Symbol">)</a>

<a id="11889" class="Keyword">open</a> <a id="11894" href="Test.Golden.html#11383" class="Module">Summary</a> <a id="11902" class="Keyword">using</a> <a id="11908" class="Symbol">(</a><a id="11909" href="Test.Golden.html#11443" class="Record">Summary</a><a id="11916" class="Symbol">)</a> <a id="11918" class="Keyword">hiding</a> <a id="11925" class="Symbol">(</a><a id="11926" class="Keyword">module</a> <a id="11933" href="Test.Golden.html#11443" class="Module">Summary</a><a id="11940" class="Symbol">)</a>

<a id="11943" class="Comment">-- Only keep the tests that have been asked for</a>
<a id="filterTests"></a><a id="11991" href="Test.Golden.html#11991" class="Function">filterTests</a> <a id="12003" class="Symbol">:</a> <a id="12005" href="Test.Golden.html#4414" class="Record">Options</a> <a id="12013" class="Symbol">→</a> <a id="12015" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="12020" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="12027" class="Symbol">→</a> <a id="12029" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="12034" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
<a id="12041" href="Test.Golden.html#11991" class="Function">filterTests</a> <a id="12053" href="Test.Golden.html#12053" class="Bound">opts</a> <a id="12058" class="Symbol">=</a> <a id="12060" href="Function.Base.html#4062" class="Function Operator">case</a> <a id="12065" href="Test.Golden.html#4567" class="Field">onlyNames</a> <a id="12075" href="Test.Golden.html#12053" class="Bound">opts</a> <a id="12080" href="Function.Base.html#4062" class="Function Operator">of</a> <a id="12083" class="Symbol">λ</a> <a id="12085" class="Keyword">where</a>
  <a id="12093" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="12096" class="Symbol">→</a> <a id="12098" href="Function.Base.html#704" class="Function">id</a>
  <a id="12103" href="Test.Golden.html#12103" class="CatchallClause Bound">xs</a> <a id="12106" class="Symbol">→</a> <a id="12108" class="Keyword">let</a> <a id="12112" href="Test.Golden.html#12112" class="Bound">names</a> <a id="12118" class="Symbol">=</a> <a id="12120" href="Data.List.Base.html#1620" class="Function">List.map</a> <a id="12129" href="Data.String.Base.html#1533" class="Primitive">String.toList</a> <a id="12143" href="Test.Golden.html#12103" class="Bound">xs</a> <a id="12146" class="Keyword">in</a>
       <a id="12156" href="Data.List.Base.html#11417" class="Function">filter</a> <a id="12163" class="Symbol">(λ</a> <a id="12166" href="Test.Golden.html#12166" class="Bound">n</a> <a id="12168" class="Symbol">→</a> <a id="12170" href="Data.List.Relation.Unary.Any.html#2680" class="Function">any?</a> <a id="12175" class="Symbol">(λ</a> <a id="12178" href="Test.Golden.html#12178" class="Bound">m</a> <a id="12180" class="Symbol">→</a> <a id="12182" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html#6668" class="Function">infix?</a> <a id="12189" href="Data.Char.Properties.html#1575" class="Function Operator">Char._≟_</a> <a id="12198" href="Test.Golden.html#12178" class="Bound">m</a> <a id="12200" class="Symbol">(</a><a id="12201" href="Data.String.Base.html#1533" class="Primitive">String.toList</a> <a id="12215" href="Test.Golden.html#12166" class="Bound">n</a><a id="12216" class="Symbol">))</a> <a id="12219" href="Test.Golden.html#12112" class="Bound">names</a><a id="12224" class="Symbol">)</a>

<a id="poolRunner"></a><a id="12227" href="Test.Golden.html#12227" class="Function">poolRunner</a> <a id="12238" class="Symbol">:</a> <a id="12240" href="Test.Golden.html#4414" class="Record">Options</a> <a id="12248" class="Symbol">→</a> <a id="12250" href="Test.Golden.html#11257" class="Record">TestPool</a> <a id="12259" class="Symbol">→</a> <a id="12261" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="12264" href="Test.Golden.html#11443" class="Record">Summary</a>
<a id="12272" href="Test.Golden.html#12227" class="Function">poolRunner</a> <a id="12283" href="Test.Golden.html#12283" class="Bound">opts</a> <a id="12288" href="Test.Golden.html#12288" class="Bound">pool</a> <a id="12293" class="Symbol">=</a> <a id="12295" class="Keyword">do</a>
  <a id="12300" class="Comment">-- check there is a non-empty list of tests we want to run</a>
  <a id="12361" class="Keyword">let</a> <a id="12365" href="Test.Golden.html#12365" class="Bound">tests</a> <a id="12371" class="Symbol">=</a> <a id="12373" href="Test.Golden.html#11991" class="Function">filterTests</a> <a id="12385" href="Test.Golden.html#12283" class="Bound">opts</a> <a id="12390" class="Symbol">(</a><a id="12391" href="Test.Golden.html#12288" class="Bound">pool</a> <a id="12396" class="Symbol">.</a><a id="12397" href="Test.Golden.html#11337" class="Field">testCases</a><a id="12406" class="Symbol">)</a>
  <a id="12410" class="Symbol">(_</a> <a id="12413" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="12415" class="Symbol">_)</a> <a id="12418" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="12420" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="12425" href="Test.Golden.html#12365" class="Bound">tests</a>
    <a id="12435" class="Keyword">where</a> <a id="12441" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="12444" class="Symbol">→</a> <a id="12446" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="12451" href="Test.Golden.html#11580" class="Function">Summary.init</a>

  <a id="12467" class="Comment">-- announce the test pool and run them</a>
  <a id="12508" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="12517" href="Test.Golden.html#12622" class="Function">banner</a>
  <a id="12526" href="Test.Golden.html#12752" class="Function">loop</a> <a id="12531" href="Test.Golden.html#11580" class="Function">Summary.init</a> <a id="12544" href="Test.Golden.html#12365" class="Bound">tests</a>

  <a id="12553" class="Keyword">where</a>

  <a id="12562" href="Test.Golden.html#12562" class="Function">separator</a> <a id="12572" class="Symbol">:</a> <a id="12574" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
  <a id="12583" href="Test.Golden.html#12562" class="Function">separator</a> <a id="12593" class="Symbol">=</a> <a id="12595" href="Data.String.Base.html#2515" class="Function">String.replicate</a> <a id="12612" class="Number">72</a> <a id="12615" class="String">&#39;-&#39;</a>

  <a id="12622" href="Test.Golden.html#12622" class="Function">banner</a> <a id="12629" class="Symbol">:</a> <a id="12631" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
  <a id="12640" href="Test.Golden.html#12622" class="Function">banner</a> <a id="12647" class="Symbol">=</a> <a id="12649" href="Data.String.Base.html#2801" class="Function">unlines</a>
         <a id="12666" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="12668" class="String">&quot;&quot;</a> <a id="12671" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="12673" href="Test.Golden.html#12562" class="Function">separator</a>
         <a id="12692" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="12694" href="Test.Golden.html#12288" class="Bound">pool</a> <a id="12699" class="Symbol">.</a><a id="12700" href="Test.Golden.html#11315" class="Field">poolName</a>
         <a id="12718" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="12720" href="Test.Golden.html#12562" class="Function">separator</a> <a id="12730" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="12732" class="String">&quot;&quot;</a>
         <a id="12744" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="12746" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

  <a id="12752" href="Test.Golden.html#12752" class="Function">loop</a> <a id="12757" class="Symbol">:</a> <a id="12759" href="Test.Golden.html#11443" class="Record">Summary</a> <a id="12767" class="Symbol">→</a> <a id="12769" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="12774" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="12781" class="Symbol">→</a> <a id="12783" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="12786" href="Test.Golden.html#11443" class="Record">Summary</a>
  <a id="12796" href="Test.Golden.html#12752" class="Function">loop</a> <a id="12801" href="Test.Golden.html#12801" class="Bound">acc</a> <a id="12805" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="12808" class="Symbol">=</a> <a id="12810" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="12815" href="Test.Golden.html#12801" class="Bound">acc</a>
  <a id="12821" href="Test.Golden.html#12752" class="Function">loop</a> <a id="12826" href="Test.Golden.html#12826" class="Bound">acc</a> <a id="12830" class="Symbol">(</a><a id="12831" href="Test.Golden.html#12831" class="Bound">test</a> <a id="12836" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="12838" href="Test.Golden.html#12838" class="Bound">tests</a><a id="12843" class="Symbol">)</a> <a id="12845" class="Symbol">=</a> <a id="12847" class="Keyword">do</a>
    <a id="12854" href="Test.Golden.html#12854" class="Bound">res</a> <a id="12858" href="IO.Base.html#2084" class="Function Operator">&lt;-</a> <a id="12861" href="Test.Golden.html#7227" class="Function">runTest</a> <a id="12869" href="Test.Golden.html#12283" class="Bound">opts</a> <a id="12874" href="Test.Golden.html#12831" class="Bound">test</a>
    <a id="12883" href="Test.Golden.html#12752" class="Function">loop</a> <a id="12888" class="Symbol">(</a><a id="12889" href="Test.Golden.html#11751" class="Function">Summary.update</a> <a id="12904" class="Symbol">(</a><a id="12905" href="Test.Golden.html#12854" class="Bound">res</a> <a id="12909" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="12911" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="12913" class="Symbol">)</a> <a id="12915" href="Test.Golden.html#12826" class="Bound">acc</a><a id="12918" class="Symbol">)</a> <a id="12920" href="Test.Golden.html#12838" class="Bound">tests</a>

<a id="runner"></a><a id="12927" href="Test.Golden.html#12927" class="Function">runner</a> <a id="12934" class="Symbol">:</a> <a id="12936" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="12941" href="Test.Golden.html#11257" class="Record">TestPool</a> <a id="12950" class="Symbol">→</a> <a id="12952" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="12955" href="Agda.Builtin.Unit.html#158" class="Record">⊤</a>
<a id="12957" href="Test.Golden.html#12927" class="Function">runner</a> <a id="12964" href="Test.Golden.html#12964" class="Bound">tests</a> <a id="12970" class="Symbol">=</a> <a id="12972" class="Keyword">do</a>
  <a id="12977" class="Comment">-- figure out the options</a>
  <a id="13005" href="Test.Golden.html#13005" class="Bound">args</a> <a id="13010" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="13012" href="System.Environment.html#660" class="Function">getArgs</a>
  <a id="13022" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="13027" href="Test.Golden.html#13027" class="Bound">opts</a> <a id="13032" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="13034" href="Test.Golden.html#5602" class="Function">options</a> <a id="13042" href="Test.Golden.html#13005" class="Bound">args</a>
    <a id="13051" class="Keyword">where</a> <a id="13057" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="13062" href="Test.Golden.html#13062" class="Bound">err</a> <a id="13066" class="Symbol">→</a> <a id="13068" href="System.Exit.html#1366" class="Function">die</a> <a id="13072" class="Symbol">(</a><a id="13073" href="Data.String.Base.html#2801" class="Function">unlines</a> <a id="13081" class="Symbol">(</a><a id="13082" href="Test.Golden.html#5415" class="Function">show</a> <a id="13087" href="Test.Golden.html#13062" class="Bound">err</a> <a id="13091" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="13093" href="Test.Golden.html#5119" class="Function">usage</a> <a id="13099" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="13101" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="13103" class="Symbol">))</a>

  <a id="13109" class="Comment">-- run the tests</a>
  <a id="13128" href="Test.Golden.html#13128" class="Bound">ress</a> <a id="13133" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="13135" href="IO.html#2045" class="Function">List.mapM</a> <a id="13145" class="Symbol">(</a><a id="13146" href="Test.Golden.html#12227" class="Function">poolRunner</a> <a id="13157" href="Test.Golden.html#13027" class="Bound">opts</a><a id="13161" class="Symbol">)</a> <a id="13163" href="Test.Golden.html#12964" class="Bound">tests</a>
  <a id="13171" class="Keyword">let</a> <a id="13175" class="Keyword">open</a> <a id="13180" href="Test.Golden.html#11383" class="Module">Summary</a>
  <a id="13190" class="Keyword">let</a> <a id="13194" href="Test.Golden.html#13194" class="Bound">res</a> <a id="13198" class="Symbol">=</a> <a id="13200" href="Data.List.Base.html#4426" class="Function">List.foldl</a> <a id="13211" href="Test.Golden.html#11623" class="Function">merge</a> <a id="13217" href="Test.Golden.html#11580" class="Function">init</a> <a id="13222" href="Test.Golden.html#13128" class="Bound">ress</a>

  <a id="13230" class="Comment">-- report the result</a>
  <a id="13253" class="Keyword">let</a> <a id="13257" href="Test.Golden.html#13257" class="Bound">nsucc</a> <a id="13263" class="Symbol">=</a> <a id="13265" href="Data.List.Base.html#5072" class="Function">List.length</a> <a id="13277" class="Symbol">(</a><a id="13278" href="Test.Golden.html#13194" class="Bound">res</a> <a id="13282" class="Symbol">.</a><a id="13283" href="Test.Golden.html#11505" class="Field">success</a><a id="13290" class="Symbol">)</a>
  <a id="13294" class="Keyword">let</a> <a id="13298" href="Test.Golden.html#13298" class="Bound">nfail</a> <a id="13304" class="Symbol">=</a> <a id="13306" href="Data.List.Base.html#5072" class="Function">List.length</a> <a id="13318" class="Symbol">(</a><a id="13319" href="Test.Golden.html#13194" class="Bound">res</a> <a id="13323" class="Symbol">.</a><a id="13324" href="Test.Golden.html#11533" class="Field">failure</a><a id="13331" class="Symbol">)</a>
  <a id="13335" class="Keyword">let</a> <a id="13339" href="Test.Golden.html#13339" class="Bound">ntotal</a> <a id="13346" class="Symbol">=</a> <a id="13348" href="Test.Golden.html#13257" class="Bound">nsucc</a> <a id="13354" href="Agda.Builtin.Nat.html#319" class="Primitive Operator">+</a> <a id="13356" href="Test.Golden.html#13298" class="Bound">nfail</a>
  <a id="13364" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="13373" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="13375" href="Data.String.Base.html#2588" class="Function">concat</a> <a id="13382" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="13384" href="Data.Nat.Show.html#1972" class="Function">ℕ.show</a> <a id="13391" href="Test.Golden.html#13257" class="Bound">nsucc</a> <a id="13397" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="13399" class="String">&quot;/&quot;</a> <a id="13403" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="13405" href="Data.Nat.Show.html#1972" class="Function">ℕ.show</a> <a id="13412" href="Test.Golden.html#13339" class="Bound">ntotal</a> <a id="13419" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="13421" class="String">&quot; tests successful&quot;</a> <a id="13441" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="13443" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

  <a id="13449" class="Comment">-- deal with failures</a>
  <a id="13473" class="Keyword">let</a> <a id="13477" href="Test.Golden.html#13477" class="Bound">list</a> <a id="13482" class="Symbol">=</a> <a id="13484" href="Data.String.Base.html#2801" class="Function">unlines</a> <a id="13492" class="Symbol">(</a><a id="13493" href="Test.Golden.html#13194" class="Bound">res</a> <a id="13497" class="Symbol">.</a><a id="13498" href="Test.Golden.html#11533" class="Field">failure</a><a id="13505" class="Symbol">)</a>
  <a id="13509" href="IO.Base.html#3334" class="Function">when</a> <a id="13514" class="Symbol">(</a><a id="13515" class="Number">0</a> <a id="13517" href="Data.Nat.Base.html#1310" class="Primitive Operator">&lt;ᵇ</a> <a id="13520" href="Test.Golden.html#13298" class="Bound">nfail</a><a id="13525" class="Symbol">)</a> <a id="13527" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="13529" class="Keyword">do</a>
    <a id="13536" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="13545" class="String">&quot;Failing tests:&quot;</a>
    <a id="13566" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="13575" href="Test.Golden.html#13477" class="Bound">list</a>
  <a id="13582" href="IO.Base.html#3457" class="Function">whenJust</a> <a id="13591" class="Symbol">(</a><a id="13592" href="Test.Golden.html#13027" class="Bound">opts</a> <a id="13597" class="Symbol">.</a><a id="13598" href="Test.Golden.html#4792" class="Field">failureFile</a><a id="13609" class="Symbol">)</a> <a id="13611" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="13613" class="Symbol">λ</a> <a id="13615" href="Test.Golden.html#13615" class="Bound">fp</a> <a id="13618" class="Symbol">→</a> <a id="13620" href="IO.Finite.html#1276" class="Function">writeFile</a> <a id="13630" href="Test.Golden.html#13615" class="Bound">fp</a> <a id="13633" href="Test.Golden.html#13477" class="Bound">list</a>

  <a id="13641" class="Comment">-- exit</a>
  <a id="13651" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="13654" class="Number">0</a> <a id="13656" href="Data.Nat.Base.html#1136" class="Primitive Operator">≡ᵇ</a> <a id="13659" href="Test.Golden.html#13298" class="Bound">nfail</a>
   <a id="13668" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="13673" href="System.Exit.html#1311" class="Function">exitSuccess</a>
   <a id="13688" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="13693" href="System.Exit.html#1248" class="Function">exitFailure</a>
</pre></body></html>