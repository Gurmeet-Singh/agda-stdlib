<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Test.Golden</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- The Agda standard library</a>
<a id="103" class="Comment">--</a>
<a id="106" class="Comment">-- Golden testing framework</a>
<a id="134" class="Comment">------------------------------------------------------------------------</a>

<a id="208" class="Comment">-- This is a port of the golden testing framework used by the Idris2</a>
<a id="277" class="Comment">-- compiler and various Idris2 libraries.</a>
<a id="319" class="Comment">-- It provides the core features required to perform golden file testing.</a>
<a id="393" class="Comment">--</a>
<a id="396" class="Comment">-- We provide the core functionality to run a *single* golden file test,</a>
<a id="469" class="Comment">-- or a whole test tree. This allows the developer freedom to use as is</a>
<a id="541" class="Comment">-- or design the rest of the test harness to their liking.</a>

<a id="601" class="Comment">------------------------------------------------------------------------</a>
<a id="674" class="Comment">-- Test Structure</a>
<a id="692" class="Comment">--</a>
<a id="695" class="Comment">-- This harness works from the assumption that each individual golden</a>
<a id="765" class="Comment">-- test comprises of a directory with the following structure:</a>
<a id="828" class="Comment">--</a>
<a id="831" class="Comment">-- + `run` a *shell* script that runs the test. We expect it to:</a>
<a id="896" class="Comment">--   * Use `$1` as the variable standing for the Agda executable to be tested</a>
<a id="974" class="Comment">--   * Clean up after itself (e.g. by running `rm -rf build/`)</a>
<a id="1037" class="Comment">--</a>
<a id="1040" class="Comment">-- + `expected` a file containting the expected output of `run`</a>
<a id="1104" class="Comment">--</a>
<a id="1107" class="Comment">-- During testing, the test harness will generate an `output` file.</a>
<a id="1175" class="Comment">-- It will be compared to the `expected` golden file provided by the user.</a>
<a id="1250" class="Comment">-- In case there is a mismatch, the framework will:</a>

<a id="1303" class="Comment">-- + either display output &amp; expected if the session is not interactive</a>
<a id="1375" class="Comment">-- + or use the following command line to produce a diff and ask the user</a>
<a id="1449" class="Comment">--   whether they want to overwrite the currently `expected` value:</a>
<a id="1517" class="Comment">--</a>
<a id="1520" class="Comment">--  git diff --no-index --exit-code --word-diff=color expected output</a>
<a id="1590" class="Comment">--</a>
<a id="1593" class="Comment">-- If `git` fails then the runner will simply present the expected and</a>
<a id="1664" class="Comment">-- &#39;given&#39; files side-by-side.</a>
<a id="1695" class="Comment">--</a>
<a id="1698" class="Comment">-- Of note, it is helpful to add `output` to a local `.gitignore` instance</a>
<a id="1773" class="Comment">-- to ensure that it is not mistakenly versioned.</a>


<a id="1825" class="Comment">------------------------------------------------------------------------</a>
<a id="1898" class="Comment">-- Options</a>
<a id="1909" class="Comment">--</a>
<a id="1912" class="Comment">-- The test harness has several options that may be set:</a>
<a id="1969" class="Comment">--</a>
<a id="1972" class="Comment">-- + `exeUnderTest` The path of the executable we are testing (typically `agda`)</a>
<a id="2053" class="Comment">-- + `onlyNames`    The tests to run relative to the generated executable.</a>
<a id="2128" class="Comment">-- + `onlyFile`     The file listing the tests to run relative to the generated executable.</a>
<a id="2220" class="Comment">-- + `interactive`  Whether to offer to update the expected file or not.</a>
<a id="2293" class="Comment">-- + `timing`       Whether to display time taken for each test.</a>
<a id="2358" class="Comment">-- + `failureFile`  The file in which to write the list of failing tests.</a>
<a id="2432" class="Comment">-- + `colour`       The output should use ANSI escape codes</a>
<a id="2492" class="Comment">--</a>
<a id="2495" class="Comment">-- We provide an options parser (`options`) that takes the list of command line</a>
<a id="2575" class="Comment">-- arguments and constructs this for you.</a>
<a id="2617" class="Comment">--</a>

<a id="2621" class="Comment">------------------------------------------------------------------------</a>
<a id="2694" class="Comment">-- Usage</a>
<a id="2703" class="Comment">--</a>
<a id="2706" class="Comment">-- When compiled to an executable the expected usage is:</a>
<a id="2763" class="Comment">--</a>
<a id="2766" class="Comment">--```sh</a>
<a id="2774" class="Comment">--runtests &lt;path to executable under test&gt;</a>
<a id="2817" class="Comment">--   [--timing]</a>
<a id="2833" class="Comment">--   [--interactive]</a>
<a id="2854" class="Comment">--   [--only-file PATH]</a>
<a id="2878" class="Comment">--   [--failure-file PATH]</a>
<a id="2905" class="Comment">--   [--no-colour]</a>
<a id="2924" class="Comment">--   [--only [NAMES]]</a>
<a id="2946" class="Comment">--```</a>
<a id="2952" class="Comment">--</a>
<a id="2955" class="Comment">-- assuming that the test runner is compiled to an executable named `runtests`.</a>

<a id="3036" class="Symbol">{-#</a> <a id="3040" class="Keyword">OPTIONS</a> <a id="3048" class="Pragma">--cubical-compatible</a> <a id="3069" class="Pragma">--guardedness</a> <a id="3083" class="Symbol">#-}</a>

<a id="3088" class="Keyword">module</a> <a id="3095" href="Test.Golden.html" class="Module">Test.Golden</a> <a id="3107" class="Keyword">where</a>

<a id="3114" class="Keyword">open</a> <a id="3119" class="Keyword">import</a> <a id="3126" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a> <a id="3141" class="Keyword">using</a> <a id="3147" class="Symbol">(</a><a id="3148" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a><a id="3152" class="Symbol">;</a> <a id="3154" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a><a id="3158" class="Symbol">;</a> <a id="3160" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a><a id="3165" class="Symbol">;</a> <a id="3167" href="Data.Bool.Base.html#1292" class="Function Operator">if_then_else_</a><a id="3180" class="Symbol">)</a>
<a id="3182" class="Keyword">import</a> <a id="3189" href="Data.Char.html" class="Module">Data.Char</a> <a id="3199" class="Symbol">as</a> <a id="3202" class="Module">Char</a>
<a id="3207" class="Keyword">open</a> <a id="3212" class="Keyword">import</a> <a id="3219" href="Data.Fin.html" class="Module">Data.Fin</a> <a id="3228" class="Keyword">using</a> <a id="3234" class="Symbol">(</a><a id="3235" href="Data.Fin.html#739" class="Function Operator">#_</a><a id="3237" class="Symbol">)</a>
<a id="3239" class="Keyword">import</a> <a id="3246" href="Data.Integer.Base.html" class="Module">Data.Integer.Base</a> <a id="3264" class="Symbol">as</a> <a id="3267" class="Module">ℤ</a>
<a id="3269" class="Keyword">open</a> <a id="3274" class="Keyword">import</a> <a id="3281" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="3296" class="Symbol">as</a> <a id="3299" class="Module">List</a> <a id="3304" class="Keyword">using</a> <a id="3310" class="Symbol">(</a><a id="3311" href="Agda.Builtin.List.html#130" class="Datatype">List</a><a id="3315" class="Symbol">;</a> <a id="3317" href="Data.List.Base.html#7375" class="InductiveConstructor">[]</a><a id="3319" class="Symbol">;</a> <a id="3321" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">_∷_</a><a id="3324" class="Symbol">;</a> <a id="3326" href="Data.List.Base.html#1943" class="Function Operator">_++_</a><a id="3330" class="Symbol">;</a> <a id="3332" href="Data.List.Base.html#11417" class="Function">filter</a><a id="3338" class="Symbol">;</a> <a id="3340" href="Data.List.Base.html#3893" class="Function">partitionSums</a><a id="3353" class="Symbol">)</a>
<a id="3355" class="Keyword">open</a> <a id="3360" class="Keyword">import</a> <a id="3367" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html" class="Module">Data.List.Relation.Binary.Infix.Heterogeneous.Properties</a> <a id="3424" class="Keyword">using</a> <a id="3430" class="Symbol">(</a><a id="3431" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html#6668" class="Function">infix?</a><a id="3437" class="Symbol">)</a>
<a id="3439" class="Keyword">open</a> <a id="3444" class="Keyword">import</a> <a id="3451" href="Data.List.Relation.Unary.Any.html" class="Module">Data.List.Relation.Unary.Any</a> <a id="3480" class="Keyword">using</a> <a id="3486" class="Symbol">(</a><a id="3487" href="Data.List.Relation.Unary.Any.html#2680" class="Function">any?</a><a id="3491" class="Symbol">)</a>
<a id="3493" class="Keyword">open</a> <a id="3498" class="Keyword">import</a> <a id="3505" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="3521" class="Keyword">using</a> <a id="3527" class="Symbol">(</a><a id="3528" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a><a id="3533" class="Symbol">;</a> <a id="3535" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a><a id="3539" class="Symbol">;</a> <a id="3541" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a><a id="3548" class="Symbol">;</a> <a id="3550" href="Data.Maybe.Base.html#1661" class="Function">fromMaybe</a><a id="3559" class="Symbol">)</a>
<a id="3561" class="Keyword">open</a> <a id="3566" class="Keyword">import</a> <a id="3573" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a> <a id="3587" class="Keyword">using</a> <a id="3593" class="Symbol">(</a><a id="3594" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a><a id="3595" class="Symbol">;</a> <a id="3597" href="Data.Nat.Base.html#1136" class="Primitive Operator">_≡ᵇ_</a><a id="3601" class="Symbol">;</a> <a id="3603" href="Data.Nat.Base.html#1310" class="Primitive Operator">_&lt;ᵇ_</a><a id="3607" class="Symbol">;</a> <a id="3609" href="Agda.Builtin.Nat.html#319" class="Primitive Operator">_+_</a><a id="3612" class="Symbol">;</a> <a id="3614" href="Data.Nat.Base.html#3211" class="Primitive Operator">_∸_</a><a id="3617" class="Symbol">)</a>
<a id="3619" class="Keyword">import</a> <a id="3626" href="Data.Nat.Show.html" class="Module">Data.Nat.Show</a> <a id="3640" class="Symbol">as</a> <a id="3643" class="Module">ℕ</a> <a id="3645" class="Keyword">using</a> <a id="3651" class="Symbol">(</a><a id="3652" href="Data.Nat.Show.html#1972" class="Function">show</a><a id="3656" class="Symbol">)</a>
<a id="3658" class="Keyword">open</a> <a id="3663" class="Keyword">import</a> <a id="3670" href="Data.Product.Base.html" class="Module">Data.Product.Base</a> <a id="3688" class="Keyword">using</a> <a id="3694" class="Symbol">(</a><a id="3695" href="Data.Product.Base.html#1618" class="Function Operator">_×_</a><a id="3698" class="Symbol">;</a> <a id="3700" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">_,_</a><a id="3703" class="Symbol">)</a>
<a id="3705" class="Keyword">open</a> <a id="3710" class="Keyword">import</a> <a id="3717" href="Data.String.html" class="Module">Data.String</a> <a id="3729" class="Symbol">as</a> <a id="3732" class="Module">String</a> <a id="3739" class="Keyword">using</a> <a id="3745" class="Symbol">(</a><a id="3746" href="Agda.Builtin.String.html#318" class="Postulate">String</a><a id="3752" class="Symbol">;</a> <a id="3754" href="Data.String.Base.html#5084" class="Function">lines</a><a id="3759" class="Symbol">;</a> <a id="3761" href="Data.String.Base.html#2801" class="Function">unlines</a><a id="3768" class="Symbol">;</a> <a id="3770" href="Data.String.Base.html#2743" class="Function">unwords</a><a id="3777" class="Symbol">;</a> <a id="3779" href="Data.String.Base.html#2588" class="Function">concat</a><a id="3785" class="Symbol">;</a> <a id="3787" href="Data.String.Properties.html#2306" class="Function Operator">_≟_</a><a id="3790" class="Symbol">)</a>
<a id="3792" class="Keyword">open</a> <a id="3797" class="Keyword">import</a> <a id="3804" href="Data.Sum.Base.html" class="Module">Data.Sum.Base</a> <a id="3818" class="Keyword">using</a> <a id="3824" class="Symbol">(</a><a id="3825" href="Data.Sum.Base.html#625" class="Datatype Operator">_⊎_</a><a id="3828" class="Symbol">;</a> <a id="3830" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a><a id="3834" class="Symbol">;</a> <a id="3836" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a><a id="3840" class="Symbol">)</a>
<a id="3842" class="Keyword">open</a> <a id="3847" class="Keyword">import</a> <a id="3854" href="Data.Unit.Base.html" class="Module">Data.Unit.Base</a> <a id="3869" class="Keyword">using</a> <a id="3875" class="Symbol">(</a><a id="3876" href="Agda.Builtin.Unit.html#158" class="Record">⊤</a><a id="3877" class="Symbol">)</a>

<a id="3880" class="Keyword">open</a> <a id="3885" class="Keyword">import</a> <a id="3892" href="Function.Base.html" class="Module">Function.Base</a> <a id="3906" class="Keyword">using</a> <a id="3912" class="Symbol">(</a><a id="3913" href="Function.Base.html#704" class="Function">id</a><a id="3915" class="Symbol">;</a> <a id="3917" href="Function.Base.html#2003" class="Function Operator">_$_</a><a id="3920" class="Symbol">;</a> <a id="3922" href="Function.Base.html#4062" class="Function Operator">case_of_</a><a id="3930" class="Symbol">)</a>

<a id="3933" class="Keyword">open</a> <a id="3938" class="Keyword">import</a> <a id="3945" href="Relation.Nullary.Decidable.html" class="Module">Relation.Nullary.Decidable</a> <a id="3972" class="Keyword">using</a> <a id="3978" class="Symbol">(</a><a id="3979" href="Relation.Nullary.Decidable.Core.html#1560" class="Field">does</a><a id="3983" class="Symbol">)</a>

<a id="3986" class="Keyword">open</a> <a id="3991" class="Keyword">import</a> <a id="3998" href="Codata.Musical.Notation.html" class="Module">Codata.Musical.Notation</a> <a id="4022" class="Keyword">using</a> <a id="4028" class="Symbol">(</a><a id="4029" href="Agda.Builtin.Coinduction.html#212" class="CoinductiveConstructor Operator">♯_</a><a id="4031" class="Symbol">)</a>
<a id="4033" class="Keyword">open</a> <a id="4038" class="Keyword">import</a> <a id="4045" href="IO.html" class="Module">IO</a>

<a id="4049" class="Keyword">open</a> <a id="4054" class="Keyword">import</a> <a id="4061" href="System.Clock.html" class="Module">System.Clock</a> <a id="4074" class="Symbol">as</a> <a id="4077" class="Module">Clock</a> <a id="4083" class="Keyword">using</a> <a id="4089" class="Symbol">(</a><a id="4090" href="System.Clock.html#2777" class="Function">time′</a><a id="4095" class="Symbol">;</a> <a id="4097" href="System.Clock.html#1932" class="Record">Time</a><a id="4101" class="Symbol">;</a> <a id="4103" href="System.Clock.html#1978" class="Field">seconds</a><a id="4110" class="Symbol">)</a>
<a id="4112" class="Keyword">open</a> <a id="4117" class="Keyword">import</a> <a id="4124" href="System.Console.ANSI.html" class="Module">System.Console.ANSI</a>
<a id="4144" class="Keyword">open</a> <a id="4149" class="Keyword">import</a> <a id="4156" href="System.Directory.html" class="Module">System.Directory</a> <a id="4173" class="Keyword">using</a> <a id="4179" class="Symbol">(</a><a id="4180" href="System.Directory.html#3068" class="Function">doesFileExist</a><a id="4193" class="Symbol">;</a> <a id="4195" href="System.Directory.html#3120" class="Function">doesDirectoryExist</a><a id="4213" class="Symbol">)</a>
<a id="4215" class="Keyword">open</a> <a id="4220" class="Keyword">import</a> <a id="4227" href="System.Environment.html" class="Module">System.Environment</a> <a id="4246" class="Keyword">using</a> <a id="4252" class="Symbol">(</a><a id="4253" href="System.Environment.html#660" class="Function">getArgs</a><a id="4260" class="Symbol">;</a> <a id="4262" href="System.Environment.html#777" class="Function">lookupEnv</a><a id="4271" class="Symbol">)</a>
<a id="4273" class="Keyword">open</a> <a id="4278" class="Keyword">import</a> <a id="4285" href="System.Exit.html" class="Module">System.Exit</a>
<a id="4297" class="Keyword">open</a> <a id="4302" class="Keyword">import</a> <a id="4309" href="System.FilePath.Posix.html" class="Module">System.FilePath.Posix</a> <a id="4331" class="Keyword">using</a> <a id="4337" class="Symbol">(</a><a id="4338" href="System.FilePath.Posix.Primitive.html#2556" class="Postulate">mkFilePath</a><a id="4348" class="Symbol">)</a>
<a id="4350" class="Keyword">open</a> <a id="4355" class="Keyword">import</a> <a id="4362" href="System.Process.html" class="Module">System.Process</a> <a id="4377" class="Keyword">using</a> <a id="4383" class="Symbol">(</a><a id="4384" href="System.Process.html#655" class="Function">callCommand</a><a id="4395" class="Symbol">;</a> <a id="4397" href="System.Process.html#735" class="Function">system</a><a id="4403" class="Symbol">)</a>

<a id="4406" class="Keyword">record</a> <a id="Options"></a><a id="4413" href="Test.Golden.html#4413" class="Record">Options</a> <a id="4421" class="Symbol">:</a> <a id="4423" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="4427" class="Keyword">where</a>
  <a id="4435" class="Keyword">field</a>
    <a id="4445" class="Comment">-- What is the name of the Agda executable?</a>
    <a id="Options.exeUnderTest"></a><a id="4493" href="Test.Golden.html#4493" class="Field">exeUnderTest</a> <a id="4506" class="Symbol">:</a> <a id="4508" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
    <a id="4519" class="Comment">-- Should we only run some specific cases?</a>
    <a id="Options.onlyNames"></a><a id="4566" href="Test.Golden.html#4566" class="Field">onlyNames</a> <a id="4576" class="Symbol">:</a> <a id="4578" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="4583" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
    <a id="4594" class="Comment">-- Should we run the test suite interactively?</a>
    <a id="Options.interactive"></a><a id="4645" href="Test.Golden.html#4645" class="Field">interactive</a> <a id="4657" class="Symbol">:</a> <a id="4659" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>
    <a id="4668" class="Comment">-- Should we time and display the tests?</a>
    <a id="Options.timing"></a><a id="4713" href="Test.Golden.html#4713" class="Field">timing</a> <a id="4720" class="Symbol">:</a> <a id="4722" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>
    <a id="4731" class="Comment">-- Should we write the list of failing cases to a file?</a>
    <a id="Options.failureFile"></a><a id="4791" href="Test.Golden.html#4791" class="Field">failureFile</a> <a id="4803" class="Symbol">:</a> <a id="4805" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="4811" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
    <a id="4822" class="Comment">-- Should we use ANSI escape codes to colour the output?</a>
    <a id="Options.colour"></a><a id="4883" href="Test.Golden.html#4883" class="Field">colour</a> <a id="4890" class="Symbol">:</a> <a id="4892" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>
<a id="4897" class="Keyword">open</a> <a id="4902" href="Test.Golden.html#4413" class="Module">Options</a>

<a id="initOptions"></a><a id="4911" href="Test.Golden.html#4911" class="Function">initOptions</a> <a id="4923" class="Symbol">:</a> <a id="4925" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="4932" class="Symbol">→</a> <a id="4934" href="Test.Golden.html#4413" class="Record">Options</a>
<a id="4942" href="Test.Golden.html#4911" class="Function">initOptions</a> <a id="4954" href="Test.Golden.html#4954" class="Bound">exe</a> <a id="4958" class="Symbol">=</a> <a id="4960" class="Keyword">record</a>
  <a id="4969" class="Symbol">{</a> <a id="4971" href="Test.Golden.html#4493" class="Field">exeUnderTest</a> <a id="4984" class="Symbol">=</a> <a id="4986" href="Test.Golden.html#4954" class="Bound">exe</a>
  <a id="4992" class="Symbol">;</a> <a id="4994" href="Test.Golden.html#4566" class="Field">onlyNames</a>    <a id="5007" class="Symbol">=</a> <a id="5009" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>
  <a id="5014" class="Symbol">;</a> <a id="5016" href="Test.Golden.html#4645" class="Field">interactive</a>  <a id="5029" class="Symbol">=</a> <a id="5031" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>
  <a id="5039" class="Symbol">;</a> <a id="5041" href="Test.Golden.html#4713" class="Field">timing</a>       <a id="5054" class="Symbol">=</a> <a id="5056" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>
  <a id="5064" class="Symbol">;</a> <a id="5066" href="Test.Golden.html#4791" class="Field">failureFile</a>  <a id="5079" class="Symbol">=</a> <a id="5081" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>
  <a id="5091" class="Symbol">;</a> <a id="5093" href="Test.Golden.html#4883" class="Field">colour</a>       <a id="5106" class="Symbol">=</a> <a id="5108" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
  <a id="5115" class="Symbol">}</a>

<a id="usage"></a><a id="5118" href="Test.Golden.html#5118" class="Function">usage</a> <a id="5124" class="Symbol">:</a> <a id="5126" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
<a id="5133" href="Test.Golden.html#5118" class="Function">usage</a> <a id="5139" class="Symbol">=</a> <a id="5141" href="Data.String.Base.html#2743" class="Function">unwords</a>
  <a id="5151" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="5153" class="String">&quot;Usage:&quot;</a>
  <a id="5164" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5166" class="String">&quot;runtests &lt;path&gt;&quot;</a>
  <a id="5186" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5188" class="String">&quot;[--timing]&quot;</a>
  <a id="5203" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5205" class="String">&quot;[--interactive]&quot;</a>
  <a id="5225" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5227" class="String">&quot;[--failure-file PATH]&quot;</a>
  <a id="5253" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5255" class="String">&quot;[--only-file PATH]&quot;</a>
  <a id="5278" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5280" class="String">&quot;[--no-colour]&quot;</a>
  <a id="5298" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5300" class="String">&quot;[--only [NAMES]]&quot;</a>
  <a id="5321" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5323" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

<a id="5327" class="Keyword">data</a> <a id="Error"></a><a id="5332" href="Test.Golden.html#5332" class="Datatype">Error</a> <a id="5338" class="Symbol">:</a> <a id="5340" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="5344" class="Keyword">where</a>
  <a id="Error.MissingExecutable"></a><a id="5352" href="Test.Golden.html#5352" class="InductiveConstructor">MissingExecutable</a> <a id="5370" class="Symbol">:</a> <a id="5372" href="Test.Golden.html#5332" class="Datatype">Error</a>
  <a id="Error.InvalidArgument"></a><a id="5380" href="Test.Golden.html#5380" class="InductiveConstructor">InvalidArgument</a> <a id="5396" class="Symbol">:</a> <a id="5398" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="5405" class="Symbol">→</a> <a id="5407" href="Test.Golden.html#5332" class="Datatype">Error</a>

<a id="show"></a><a id="5414" href="Test.Golden.html#5414" class="Function">show</a> <a id="5419" class="Symbol">:</a> <a id="5421" href="Test.Golden.html#5332" class="Datatype">Error</a> <a id="5427" class="Symbol">→</a> <a id="5429" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
<a id="5436" href="Test.Golden.html#5414" class="Function">show</a> <a id="5441" href="Test.Golden.html#5352" class="InductiveConstructor">MissingExecutable</a> <a id="5459" class="Symbol">=</a> <a id="5461" class="String">&quot;Expected a path to Agda, got nothing&quot;</a>
<a id="5500" href="Test.Golden.html#5414" class="Function">show</a> <a id="5505" class="Symbol">(</a><a id="5506" href="Test.Golden.html#5380" class="InductiveConstructor">InvalidArgument</a> <a id="5522" href="Test.Golden.html#5522" class="Bound">arg</a><a id="5525" class="Symbol">)</a> <a id="5527" class="Symbol">=</a> <a id="5529" class="String">&quot;Invalid argument: &quot;</a> <a id="5550" href="Data.String.Base.html#2400" class="Function Operator">String.++</a> <a id="5560" href="Test.Golden.html#5522" class="Bound">arg</a>

<a id="5565" class="Comment">-- Process the command line options</a>
<a id="options"></a><a id="5601" href="Test.Golden.html#5601" class="Function">options</a> <a id="5609" class="Symbol">:</a> <a id="5611" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="5616" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="5623" class="Symbol">→</a> <a id="5625" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="5628" class="Symbol">(</a><a id="5629" href="Test.Golden.html#5332" class="Datatype">Error</a> <a id="5635" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="5637" href="Test.Golden.html#4413" class="Record">Options</a><a id="5644" class="Symbol">)</a>
<a id="5646" href="Test.Golden.html#5601" class="Function">options</a><a id="5653" class="Symbol">(</a><a id="5654" href="Test.Golden.html#5654" class="Bound">exe</a> <a id="5658" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5660" href="Test.Golden.html#5660" class="Bound">rest</a><a id="5664" class="Symbol">)</a> <a id="5666" class="Symbol">=</a> <a id="5668" href="Test.Golden.html#6469" class="Function">mkOptions</a> <a id="5678" href="Test.Golden.html#5654" class="Bound">exe</a> <a id="5682" href="Test.Golden.html#5660" class="Bound">rest</a> <a id="5687" class="Keyword">where</a>

  <a id="5696" href="Test.Golden.html#5696" class="Function">go</a> <a id="5699" class="Symbol">:</a> <a id="5701" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="5706" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="5713" class="Symbol">→</a> <a id="5715" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="5721" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="5728" class="Symbol">→</a> <a id="5730" href="Test.Golden.html#4413" class="Record">Options</a> <a id="5738" class="Symbol">→</a> <a id="5740" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="5747" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="5749" class="Symbol">(</a><a id="5750" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="5756" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="5763" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5765" href="Test.Golden.html#4413" class="Record">Options</a><a id="5772" class="Symbol">)</a>
  <a id="5776" href="Test.Golden.html#5696" class="Function">go</a> <a id="5779" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>                             <a id="5810" href="Test.Golden.html#5810" class="Bound">mfp</a> <a id="5814" href="Test.Golden.html#5814" class="Bound">opts</a> <a id="5819" class="Symbol">=</a> <a id="5821" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="5826" class="Symbol">(</a><a id="5827" href="Test.Golden.html#5810" class="Bound">mfp</a> <a id="5831" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5833" href="Test.Golden.html#5814" class="Bound">opts</a><a id="5837" class="Symbol">)</a>
  <a id="5841" href="Test.Golden.html#5696" class="Function">go</a> <a id="5844" class="Symbol">(</a><a id="5845" class="String">&quot;--timing&quot;</a>            <a id="5867" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5869" href="Test.Golden.html#5869" class="Bound">args</a><a id="5873" class="Symbol">)</a> <a id="5875" href="Test.Golden.html#5875" class="Bound">mfp</a> <a id="5879" href="Test.Golden.html#5879" class="Bound">opts</a> <a id="5884" class="Symbol">=</a>
    <a id="5890" href="Test.Golden.html#5696" class="Function">go</a> <a id="5893" href="Test.Golden.html#5869" class="Bound">args</a> <a id="5898" href="Test.Golden.html#5875" class="Bound">mfp</a> <a id="5902" class="Symbol">(</a><a id="5903" class="Keyword">record</a> <a id="5910" href="Test.Golden.html#5879" class="Bound">opts</a> <a id="5915" class="Symbol">{</a> <a id="5917" href="Test.Golden.html#4713" class="Field">timing</a> <a id="5924" class="Symbol">=</a> <a id="5926" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a> <a id="5931" class="Symbol">})</a>
  <a id="5936" href="Test.Golden.html#5696" class="Function">go</a> <a id="5939" class="Symbol">(</a><a id="5940" class="String">&quot;--interactive&quot;</a>       <a id="5962" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5964" href="Test.Golden.html#5964" class="Bound">args</a><a id="5968" class="Symbol">)</a> <a id="5970" href="Test.Golden.html#5970" class="Bound">mfp</a> <a id="5974" href="Test.Golden.html#5974" class="Bound">opts</a> <a id="5979" class="Symbol">=</a>
    <a id="5985" href="Test.Golden.html#5696" class="Function">go</a> <a id="5988" href="Test.Golden.html#5964" class="Bound">args</a> <a id="5993" href="Test.Golden.html#5970" class="Bound">mfp</a> <a id="5997" class="Symbol">(</a><a id="5998" class="Keyword">record</a> <a id="6005" href="Test.Golden.html#5974" class="Bound">opts</a> <a id="6010" class="Symbol">{</a> <a id="6012" href="Test.Golden.html#4645" class="Field">interactive</a> <a id="6024" class="Symbol">=</a> <a id="6026" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a> <a id="6031" class="Symbol">})</a>
  <a id="6036" href="Test.Golden.html#5696" class="Function">go</a> <a id="6039" class="Symbol">(</a><a id="6040" class="String">&quot;--failure-file&quot;</a> <a id="6057" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="6059" href="Test.Golden.html#6059" class="Bound">fp</a> <a id="6062" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="6064" href="Test.Golden.html#6064" class="Bound">args</a><a id="6068" class="Symbol">)</a> <a id="6070" href="Test.Golden.html#6070" class="Bound">mfp</a> <a id="6074" href="Test.Golden.html#6074" class="Bound">opts</a> <a id="6079" class="Symbol">=</a>
    <a id="6085" href="Test.Golden.html#5696" class="Function">go</a> <a id="6088" href="Test.Golden.html#6064" class="Bound">args</a> <a id="6093" href="Test.Golden.html#6070" class="Bound">mfp</a> <a id="6097" class="Symbol">(</a><a id="6098" class="Keyword">record</a> <a id="6105" href="Test.Golden.html#6074" class="Bound">opts</a> <a id="6110" class="Symbol">{</a> <a id="6112" href="Test.Golden.html#4791" class="Field">failureFile</a> <a id="6124" class="Symbol">=</a> <a id="6126" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="6131" href="Test.Golden.html#6059" class="Bound">fp</a> <a id="6134" class="Symbol">})</a>
  <a id="6139" href="Test.Golden.html#5696" class="Function">go</a> <a id="6142" class="Symbol">(</a><a id="6143" class="String">&quot;--only&quot;</a>              <a id="6165" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="6167" href="Test.Golden.html#6167" class="Bound">args</a><a id="6171" class="Symbol">)</a> <a id="6173" href="Test.Golden.html#6173" class="Bound">mfp</a> <a id="6177" href="Test.Golden.html#6177" class="Bound">opts</a> <a id="6182" class="Symbol">=</a>
    <a id="6188" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6193" class="Symbol">(</a><a id="6194" href="Test.Golden.html#6173" class="Bound">mfp</a> <a id="6198" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="6200" class="Symbol">(</a><a id="6201" class="Keyword">record</a> <a id="6208" href="Test.Golden.html#6177" class="Bound">opts</a> <a id="6213" class="Symbol">{</a> <a id="6215" href="Test.Golden.html#4566" class="Field">onlyNames</a> <a id="6225" class="Symbol">=</a> <a id="6227" href="Test.Golden.html#6167" class="Bound">args</a> <a id="6232" class="Symbol">}))</a>
  <a id="6238" href="Test.Golden.html#5696" class="Function">go</a> <a id="6241" class="Symbol">(</a><a id="6242" class="String">&quot;--only-file&quot;</a> <a id="6256" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="6258" href="Test.Golden.html#6258" class="Bound">fp</a>    <a id="6264" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="6266" href="Test.Golden.html#6266" class="Bound">args</a><a id="6270" class="Symbol">)</a> <a id="6272" href="Test.Golden.html#6272" class="Bound">mfp</a> <a id="6276" href="Test.Golden.html#6276" class="Bound">opts</a> <a id="6281" class="Symbol">=</a>
    <a id="6287" href="Test.Golden.html#5696" class="Function">go</a> <a id="6290" href="Test.Golden.html#6266" class="Bound">args</a> <a id="6295" class="Symbol">(</a><a id="6296" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="6301" href="Test.Golden.html#6258" class="Bound">fp</a><a id="6303" class="Symbol">)</a> <a id="6305" class="Symbol">(</a><a id="6306" class="Keyword">record</a> <a id="6313" href="Test.Golden.html#6276" class="Bound">opts</a> <a id="6318" class="Symbol">{</a> <a id="6320" href="Test.Golden.html#4566" class="Field">onlyNames</a> <a id="6330" class="Symbol">=</a> <a id="6332" href="Test.Golden.html#6266" class="Bound">args</a> <a id="6337" class="Symbol">})</a>
  <a id="6342" href="Test.Golden.html#5696" class="Function">go</a> <a id="6345" class="Symbol">(</a><a id="6346" class="String">&quot;--no-colour&quot;</a>         <a id="6368" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="6370" href="Test.Golden.html#6370" class="Bound">args</a><a id="6374" class="Symbol">)</a> <a id="6376" href="Test.Golden.html#6376" class="Bound">mfp</a> <a id="6380" href="Test.Golden.html#6380" class="Bound">opts</a> <a id="6385" class="Symbol">=</a>
    <a id="6391" href="Test.Golden.html#5696" class="Function">go</a> <a id="6394" href="Test.Golden.html#6370" class="Bound">args</a> <a id="6399" href="Test.Golden.html#6376" class="Bound">mfp</a> <a id="6403" class="Symbol">(</a><a id="6404" class="Keyword">record</a> <a id="6411" href="Test.Golden.html#6380" class="Bound">opts</a> <a id="6416" class="Symbol">{</a> <a id="6418" href="Test.Golden.html#4883" class="Field">colour</a> <a id="6425" class="Symbol">=</a> <a id="6427" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a> <a id="6433" class="Symbol">})</a>
  <a id="6438" href="Test.Golden.html#5696" class="CatchallClause Function">go</a><a id="6440" class="CatchallClause"> </a><a id="6441" class="CatchallClause Symbol">(</a><a id="6442" href="Test.Golden.html#6442" class="CatchallClause Bound">arg</a><a id="6445" class="CatchallClause"> </a><a id="6446" href="Agda.Builtin.List.html#182" class="CatchallClause InductiveConstructor Operator">∷</a><a id="6447" class="CatchallClause"> </a><a id="6448" class="CatchallClause Symbol">_)</a><a id="6450" class="CatchallClause"> </a><a id="6451" class="CatchallClause Symbol">_</a><a id="6452" class="CatchallClause"> </a><a id="6453" class="CatchallClause Symbol">_</a> <a id="6455" class="Symbol">=</a> <a id="6457" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="6462" href="Test.Golden.html#6442" class="Bound">arg</a>

  <a id="6469" href="Test.Golden.html#6469" class="Function">mkOptions</a> <a id="6479" class="Symbol">:</a> <a id="6481" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="6488" class="Symbol">→</a> <a id="6490" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="6495" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="6502" class="Symbol">→</a> <a id="6504" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="6507" class="Symbol">(</a><a id="6508" href="Test.Golden.html#5332" class="Datatype">Error</a> <a id="6514" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="6516" href="Test.Golden.html#4413" class="Record">Options</a><a id="6523" class="Symbol">)</a>
  <a id="6527" href="Test.Golden.html#6469" class="Function">mkOptions</a> <a id="6537" href="Test.Golden.html#6537" class="Bound">exe</a> <a id="6541" href="Test.Golden.html#6541" class="Bound">rest</a> <a id="6546" class="Symbol">=</a> <a id="6548" class="Keyword">do</a>
    <a id="6555" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6560" class="Symbol">(</a><a id="6561" href="Test.Golden.html#6561" class="Bound">mfp</a> <a id="6565" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="6567" href="Test.Golden.html#6567" class="Bound">opts</a><a id="6571" class="Symbol">)</a> <a id="6573" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="6575" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="6580" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="6582" href="Test.Golden.html#5696" class="Function">go</a> <a id="6585" href="Test.Golden.html#6541" class="Bound">rest</a> <a id="6590" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="6598" class="Symbol">(</a><a id="6599" href="Test.Golden.html#4911" class="Function">initOptions</a> <a id="6611" href="Test.Golden.html#6537" class="Bound">exe</a><a id="6614" class="Symbol">)</a>
      <a id="6622" class="Keyword">where</a> <a id="6628" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="6633" href="Test.Golden.html#6633" class="Bound">arg</a> <a id="6637" class="Symbol">→</a> <a id="6639" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="6644" class="Symbol">(</a><a id="6645" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="6650" class="Symbol">(</a><a id="6651" href="Test.Golden.html#5380" class="InductiveConstructor">InvalidArgument</a> <a id="6667" href="Test.Golden.html#6633" class="Bound">arg</a><a id="6670" class="Symbol">))</a>
    <a id="6677" href="Test.Golden.html#6677" class="Bound">term</a> <a id="6682" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="6684" href="Data.Maybe.Base.html#1661" class="Function">fromMaybe</a> <a id="6694" class="String">&quot;&quot;</a> <a id="6697" href="IO.Base.html#1973" class="Function Operator">&lt;$&gt;</a> <a id="6701" href="System.Environment.html#777" class="Function">lookupEnv</a> <a id="6711" class="String">&quot;TERM&quot;</a>
    <a id="6722" class="Keyword">let</a> <a id="6726" href="Test.Golden.html#6726" class="Bound">opts</a> <a id="6731" class="Symbol">=</a> <a id="6733" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="6736" href="Relation.Nullary.Decidable.Core.html#1560" class="Field">does</a> <a id="6741" class="Symbol">(</a><a id="6742" href="Test.Golden.html#6677" class="Bound">term</a> <a id="6747" href="Data.String.Properties.html#2306" class="Function Operator">≟</a> <a id="6749" class="String">&quot;DUMB&quot;</a><a id="6755" class="Symbol">)</a>
               <a id="6772" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="6777" class="Keyword">record</a> <a id="6784" href="Test.Golden.html#6567" class="Bound">opts</a> <a id="6789" class="Symbol">{</a> <a id="6791" href="Test.Golden.html#4883" class="Field">colour</a> <a id="6798" class="Symbol">=</a> <a id="6800" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a> <a id="6806" class="Symbol">}</a>
               <a id="6823" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="6828" href="Test.Golden.html#6567" class="Bound">opts</a>
    <a id="6837" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="6842" href="Test.Golden.html#6842" class="Bound">fp</a> <a id="6845" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="6847" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="6852" href="Test.Golden.html#6561" class="Bound">mfp</a>
      <a id="6862" class="Keyword">where</a> <a id="6868" class="CatchallClause Symbol">_</a> <a id="6870" class="Symbol">→</a> <a id="6872" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="6877" class="Symbol">(</a><a id="6878" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6883" href="Test.Golden.html#6726" class="Bound">opts</a><a id="6887" class="Symbol">)</a>
    <a id="6893" href="Test.Golden.html#6893" class="Bound">only</a> <a id="6898" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="6900" href="IO.html#2873" class="Function">readFiniteFile</a> <a id="6915" href="Test.Golden.html#6842" class="Bound">fp</a>
    <a id="6922" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="6927" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="6929" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6934" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="6936" class="Keyword">record</a> <a id="6943" href="Test.Golden.html#6726" class="Bound">opts</a> <a id="6948" class="Symbol">{</a> <a id="6950" href="Test.Golden.html#4566" class="Field">onlyNames</a> <a id="6960" class="Symbol">=</a> <a id="6962" href="Data.String.Base.html#5084" class="Function">lines</a> <a id="6968" href="Test.Golden.html#6893" class="Bound">only</a> <a id="6973" href="Data.List.Base.html#1943" class="Function Operator">++</a> <a id="6976" href="Test.Golden.html#4566" class="Field">onlyNames</a> <a id="6986" href="Test.Golden.html#6726" class="Bound">opts</a> <a id="6991" class="Symbol">}</a>

<a id="6994" href="Test.Golden.html#5601" class="Function">options</a> <a id="7002" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="7005" class="Symbol">=</a> <a id="7007" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="7012" class="Symbol">(</a><a id="7013" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="7018" href="Test.Golden.html#5352" class="InductiveConstructor">MissingExecutable</a><a id="7035" class="Symbol">)</a>


<a id="7039" class="Comment">-- The result of a test run</a>
<a id="7067" class="Comment">-- `Left` corresponds to a failure and `Right` to a success</a>
<a id="Result"></a><a id="7127" href="Test.Golden.html#7127" class="Function">Result</a> <a id="7134" class="Symbol">:</a> <a id="7136" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="7140" href="Test.Golden.html#7127" class="Function">Result</a> <a id="7147" class="Symbol">=</a> <a id="7149" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="7156" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="7158" href="Agda.Builtin.String.html#318" class="Postulate">String</a>

<a id="7166" class="Comment">-- Run the specified golden test with the supplied options.</a>
<a id="runTest"></a><a id="7226" href="Test.Golden.html#7226" class="Function">runTest</a> <a id="7234" class="Symbol">:</a> <a id="7236" href="Test.Golden.html#4413" class="Record">Options</a> <a id="7244" class="Symbol">→</a> <a id="7246" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="7253" class="Symbol">→</a> <a id="7255" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="7258" href="Test.Golden.html#7127" class="Function">Result</a>
<a id="7265" href="Test.Golden.html#7226" class="Function">runTest</a> <a id="7273" href="Test.Golden.html#7273" class="Bound">opts</a> <a id="7278" href="Test.Golden.html#7278" class="Bound">testPath</a> <a id="7287" class="Symbol">=</a> <a id="7289" class="Keyword">do</a>

  <a id="7295" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a> <a id="7300" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="7302" href="System.Directory.html#3120" class="Function">doesDirectoryExist</a> <a id="7321" class="Symbol">(</a><a id="7322" href="System.FilePath.Posix.Primitive.html#2556" class="Postulate">mkFilePath</a> <a id="7333" href="Test.Golden.html#7278" class="Bound">testPath</a><a id="7341" class="Symbol">)</a>
    <a id="7347" class="Keyword">where</a> <a id="7353" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a> <a id="7359" class="Symbol">→</a> <a id="7361" href="Test.Golden.html#8906" class="Function">fail</a> <a id="7366" href="Test.Golden.html#8527" class="Function">directoryNotFound</a>

  <a id="7387" href="Test.Golden.html#7387" class="Bound">time</a> <a id="7392" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="7394" href="System.Clock.html#2777" class="Function">time′</a> <a id="7400" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="7402" href="System.Process.html#655" class="Function">callCommand</a> <a id="7414" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="7416" href="Data.String.Base.html#2743" class="Function">unwords</a>
           <a id="7435" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="7437" class="String">&quot;cd&quot;</a> <a id="7442" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="7444" href="Test.Golden.html#7278" class="Bound">testPath</a>
           <a id="7464" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="7466" class="String">&quot;&amp;&amp;&quot;</a> <a id="7471" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="7473" class="String">&quot;sh ./run&quot;</a> <a id="7484" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="7486" href="Test.Golden.html#7273" class="Bound">opts</a> <a id="7491" class="Symbol">.</a><a id="7492" href="Test.Golden.html#4493" class="Field">exeUnderTest</a>
           <a id="7516" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="7518" class="String">&quot;| tr -d &#39;\\r&#39; &gt; output&quot;</a>
           <a id="7554" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="7556" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

  <a id="7562" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="7567" href="Test.Golden.html#7567" class="Bound">out</a> <a id="7571" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="7573" href="Test.Golden.html#9007" class="Function">readLocalFile</a> <a id="7587" class="String">&quot;output&quot;</a>
    <a id="7600" class="Keyword">where</a> <a id="7606" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="7614" class="Symbol">→</a> <a id="7616" href="Test.Golden.html#8906" class="Function">fail</a> <a id="7621" class="Symbol">(</a><a id="7622" href="Test.Golden.html#8706" class="Function">fileNotFound</a> <a id="7635" class="String">&quot;output&quot;</a><a id="7643" class="Symbol">)</a>
  <a id="7647" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="7652" href="Test.Golden.html#7652" class="Bound">exp</a> <a id="7656" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="7658" href="Test.Golden.html#9007" class="Function">readLocalFile</a> <a id="7672" class="String">&quot;expected&quot;</a>
    <a id="7687" class="Keyword">where</a> <a id="7693" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="7701" class="Symbol">→</a> <a id="7703" class="Keyword">do</a> <a id="7706" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="7709" href="Test.Golden.html#7273" class="Bound">opts</a> <a id="7714" class="Symbol">.</a><a id="7715" href="Test.Golden.html#4645" class="Field">interactive</a>
                         <a id="7752" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="7757" href="Test.Golden.html#9774" class="Function">mayOverwrite</a> <a id="7770" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="7778" href="Test.Golden.html#7567" class="Bound">out</a>
                         <a id="7807" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="7812" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="7821" class="Symbol">(</a><a id="7822" href="Test.Golden.html#8706" class="Function">fileNotFound</a> <a id="7835" class="String">&quot;expected&quot;</a><a id="7845" class="Symbol">)</a>
                       <a id="7870" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="7875" class="Symbol">(</a><a id="7876" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="7881" href="Test.Golden.html#7278" class="Bound">testPath</a><a id="7889" class="Symbol">)</a>

  <a id="7894" class="Keyword">let</a> <a id="7898" href="Test.Golden.html#7898" class="Bound">result</a> <a id="7905" class="Symbol">=</a> <a id="7907" href="Relation.Nullary.Decidable.Core.html#1560" class="Field">does</a> <a id="7912" class="Symbol">(</a><a id="7913" href="Test.Golden.html#7567" class="Bound">out</a> <a id="7917" href="Data.String.Properties.html#2306" class="Function Operator">String.≟</a> <a id="7926" href="Test.Golden.html#7652" class="Bound">exp</a><a id="7929" class="Symbol">)</a>

  <a id="7934" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="7937" href="Test.Golden.html#7898" class="Bound">result</a>
    <a id="7948" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="7953" href="Test.Golden.html#10590" class="Function">printTiming</a> <a id="7965" class="Symbol">(</a><a id="7966" href="Test.Golden.html#7273" class="Bound">opts</a> <a id="7971" class="Symbol">.</a><a id="7972" href="Test.Golden.html#4713" class="Field">timing</a><a id="7978" class="Symbol">)</a> <a id="7980" href="Test.Golden.html#7387" class="Bound">time</a>
           <a id="7996" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="7998" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="8001" href="Test.Golden.html#7273" class="Bound">opts</a> <a id="8006" class="Symbol">.</a><a id="8007" href="Test.Golden.html#4883" class="Field">colour</a>
               <a id="8029" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="8034" href="System.Console.ANSI.html#2086" class="Function">withCommand</a> <a id="8046" class="Symbol">(</a><a id="8047" href="System.Console.ANSI.html#987" class="InductiveConstructor">setColour</a> <a id="8057" href="System.Console.ANSI.html#556" class="InductiveConstructor">foreground</a> <a id="8068" href="System.Console.ANSI.html#699" class="InductiveConstructor">classic</a> <a id="8076" href="System.Console.ANSI.html#623" class="InductiveConstructor">green</a><a id="8081" class="Symbol">)</a>
               <a id="8098" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="8103" href="Function.Base.html#704" class="Function">id</a>
           <a id="8117" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="8119" class="String">&quot;success&quot;</a>
    <a id="8133" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="8138" class="Keyword">do</a> <a id="8141" href="Test.Golden.html#10590" class="Function">printTiming</a> <a id="8153" class="Symbol">(</a><a id="8154" href="Test.Golden.html#7273" class="Bound">opts</a> <a id="8159" class="Symbol">.</a><a id="8160" href="Test.Golden.html#4713" class="Field">timing</a><a id="8166" class="Symbol">)</a> <a id="8168" href="Test.Golden.html#7387" class="Bound">time</a>
             <a id="8186" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="8188" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="8191" href="Test.Golden.html#7273" class="Bound">opts</a> <a id="8196" class="Symbol">.</a><a id="8197" href="Test.Golden.html#4883" class="Field">colour</a>
               <a id="8219" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="8224" href="System.Console.ANSI.html#2086" class="Function">withCommand</a> <a id="8236" class="Symbol">(</a><a id="8237" href="System.Console.ANSI.html#987" class="InductiveConstructor">setColour</a> <a id="8247" href="System.Console.ANSI.html#556" class="InductiveConstructor">foreground</a> <a id="8258" href="System.Console.ANSI.html#707" class="InductiveConstructor">bright</a> <a id="8265" href="System.Console.ANSI.html#619" class="InductiveConstructor">red</a><a id="8268" class="Symbol">)</a>
               <a id="8285" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="8290" href="Function.Base.html#704" class="Function">id</a>
             <a id="8306" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="8308" class="String">&quot;FAILURE&quot;</a>
            <a id="8330" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="8333" href="Test.Golden.html#7273" class="Bound">opts</a> <a id="8338" class="Symbol">.</a><a id="8339" href="Test.Golden.html#4645" class="Field">interactive</a>
              <a id="8365" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="8370" href="Test.Golden.html#9774" class="Function">mayOverwrite</a> <a id="8383" class="Symbol">(</a><a id="8384" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="8389" href="Test.Golden.html#7652" class="Bound">exp</a><a id="8392" class="Symbol">)</a> <a id="8394" href="Test.Golden.html#7567" class="Bound">out</a>
              <a id="8412" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="8417" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="8426" class="Symbol">(</a><a id="8427" href="Data.String.Base.html#2801" class="Function">unlines</a> <a id="8435" class="Symbol">(</a><a id="8436" href="Test.Golden.html#9540" class="Function">expVsOut</a> <a id="8445" href="Test.Golden.html#7652" class="Bound">exp</a> <a id="8449" href="Test.Golden.html#7567" class="Bound">out</a><a id="8452" class="Symbol">))</a>

  <a id="8458" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="8463" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="8465" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="8468" href="Test.Golden.html#7898" class="Bound">result</a> <a id="8475" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="8480" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="8485" href="Test.Golden.html#7278" class="Bound">testPath</a> <a id="8494" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="8499" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="8504" href="Test.Golden.html#7278" class="Bound">testPath</a>

  <a id="8516" class="Keyword">where</a>

    <a id="8527" href="Test.Golden.html#8527" class="Function">directoryNotFound</a> <a id="8545" class="Symbol">:</a> <a id="8547" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
    <a id="8558" href="Test.Golden.html#8527" class="Function">directoryNotFound</a> <a id="8576" class="Symbol">=</a> <a id="8578" href="Data.String.Base.html#2743" class="Function">unwords</a>
                      <a id="8608" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="8610" class="String">&quot;Directory&quot;</a>
                      <a id="8644" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="8646" href="Test.Golden.html#7278" class="Bound">testPath</a>
                      <a id="8677" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="8679" class="String">&quot;does not exist&quot;</a> <a id="8696" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="8698" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

    <a id="8706" href="Test.Golden.html#8706" class="Function">fileNotFound</a> <a id="8719" class="Symbol">:</a> <a id="8721" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="8728" class="Symbol">→</a> <a id="8730" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
    <a id="8741" href="Test.Golden.html#8706" class="Function">fileNotFound</a> <a id="8754" href="Test.Golden.html#8754" class="Bound">name</a> <a id="8759" class="Symbol">=</a> <a id="8761" href="Data.String.Base.html#2743" class="Function">unwords</a>
                      <a id="8791" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="8793" class="String">&quot;File&quot;</a>
                      <a id="8822" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="8824" class="Symbol">(</a><a id="8825" href="Test.Golden.html#7278" class="Bound">testPath</a> <a id="8834" href="Data.String.Base.html#2400" class="Function Operator">String.++</a> <a id="8844" class="String">&quot;/output&quot;</a><a id="8853" class="Symbol">)</a>
                      <a id="8877" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="8879" class="String">&quot;does not exist&quot;</a> <a id="8896" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="8898" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

    <a id="8906" href="Test.Golden.html#8906" class="Function">fail</a> <a id="8911" class="Symbol">:</a> <a id="8913" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="8920" class="Symbol">→</a> <a id="8922" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="8925" href="Test.Golden.html#7127" class="Function">Result</a>
    <a id="8936" href="Test.Golden.html#8906" class="Function">fail</a> <a id="8941" href="Test.Golden.html#8941" class="Bound">msg</a> <a id="8945" class="Symbol">=</a> <a id="8947" class="Keyword">do</a> <a id="8950" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="8959" href="Test.Golden.html#8941" class="Bound">msg</a>
                  <a id="8981" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="8986" class="Symbol">(</a><a id="8987" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="8992" href="Test.Golden.html#7278" class="Bound">testPath</a><a id="9000" class="Symbol">)</a>

    <a id="9007" href="Test.Golden.html#9007" class="Function">readLocalFile</a> <a id="9021" class="Symbol">:</a> <a id="9023" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="9030" class="Symbol">→</a> <a id="9032" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="9035" class="Symbol">(</a><a id="9036" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="9042" href="Agda.Builtin.String.html#318" class="Postulate">String</a><a id="9048" class="Symbol">)</a>
    <a id="9054" href="Test.Golden.html#9007" class="Function">readLocalFile</a> <a id="9068" href="Test.Golden.html#9068" class="Bound">name</a> <a id="9073" class="Symbol">=</a> <a id="9075" class="Keyword">do</a>
      <a id="9084" class="Keyword">let</a> <a id="9088" href="Test.Golden.html#9088" class="Bound">fp</a> <a id="9091" class="Symbol">=</a> <a id="9093" href="Data.String.Base.html#2588" class="Function">concat</a> <a id="9100" class="Symbol">(</a><a id="9101" href="Test.Golden.html#7278" class="Bound">testPath</a> <a id="9110" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="9112" class="String">&quot;/&quot;</a> <a id="9116" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="9118" href="Test.Golden.html#9068" class="Bound">name</a> <a id="9123" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="9125" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="9127" class="Symbol">)</a>
      <a id="9135" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a> <a id="9140" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="9142" href="System.Directory.html#3068" class="Function">doesFileExist</a> <a id="9156" class="Symbol">(</a><a id="9157" href="System.FilePath.Posix.Primitive.html#2556" class="Postulate">mkFilePath</a> <a id="9168" href="Test.Golden.html#9088" class="Bound">fp</a><a id="9170" class="Symbol">)</a>
        <a id="9180" class="Keyword">where</a> <a id="9186" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a> <a id="9192" class="Symbol">→</a> <a id="9194" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="9199" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>
      <a id="9213" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="9218" href="IO.Base.html#1973" class="Function Operator">&lt;$&gt;</a> <a id="9222" href="IO.html#2873" class="Function">readFiniteFile</a> <a id="9237" href="Test.Golden.html#9088" class="Bound">fp</a>

    <a id="9245" href="Test.Golden.html#9245" class="Function">getAnswer</a> <a id="9255" class="Symbol">:</a> <a id="9257" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="9260" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>
    <a id="9269" href="Test.Golden.html#9245" class="Function">getAnswer</a> <a id="9279" class="Symbol">=</a> <a id="9281" href="IO.Base.html#3674" class="Function">untilJust</a> <a id="9291" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="9293" class="Keyword">do</a>
      <a id="9302" href="Test.Golden.html#9302" class="Bound">str</a> <a id="9306" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="9308" href="IO.Finite.html#1045" class="Function">getLine</a>
      <a id="9322" href="Function.Base.html#4062" class="Function Operator">case</a> <a id="9327" href="Test.Golden.html#9302" class="Bound">str</a> <a id="9331" href="Function.Base.html#4062" class="Function Operator">of</a> <a id="9334" class="Symbol">λ</a> <a id="9336" class="Keyword">where</a>
        <a id="9350" class="String">&quot;y&quot;</a> <a id="9354" class="Symbol">→</a> <a id="9356" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="9361" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="9363" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="9368" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
        <a id="9381" class="String">&quot;n&quot;</a> <a id="9385" class="Symbol">→</a> <a id="9387" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="9392" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="9394" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="9399" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>
        <a id="9413" class="String">&quot;&quot;</a>  <a id="9417" class="Symbol">→</a> <a id="9419" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="9424" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="9426" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="9431" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a> <a id="9437" class="Comment">-- default answer is no</a>
        <a id="9469" class="Symbol">_</a>   <a id="9473" class="Symbol">→</a> <a id="9475" class="Keyword">do</a> <a id="9478" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="9487" class="String">&quot;Invalid answer.&quot;</a>
                 <a id="9522" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="9527" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>

    <a id="9540" href="Test.Golden.html#9540" class="Function">expVsOut</a> <a id="9549" class="Symbol">:</a> <a id="9551" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="9558" class="Symbol">→</a> <a id="9560" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="9567" class="Symbol">→</a> <a id="9569" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="9574" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
    <a id="9585" href="Test.Golden.html#9540" class="Function">expVsOut</a> <a id="9594" href="Test.Golden.html#9594" class="Bound">exp</a> <a id="9598" href="Test.Golden.html#9598" class="Bound">out</a> <a id="9602" class="Symbol">=</a> <a id="9604" class="String">&quot;Expected:&quot;</a> <a id="9616" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="9618" href="Test.Golden.html#9594" class="Bound">exp</a> <a id="9622" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="9624" class="String">&quot;Given:&quot;</a> <a id="9633" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="9635" href="Test.Golden.html#9598" class="Bound">out</a> <a id="9639" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="9641" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

    <a id="9649" href="Test.Golden.html#9649" class="Function">hasFailed</a> <a id="9659" class="Symbol">:</a> <a id="9661" href="System.Exit.Primitive.html#402" class="Datatype">ExitCode</a> <a id="9670" class="Symbol">→</a> <a id="9672" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>
    <a id="9681" href="Test.Golden.html#9649" class="Function">hasFailed</a> <a id="9691" href="System.Exit.Primitive.html#425" class="InductiveConstructor">ExitSuccess</a>        <a id="9710" class="Symbol">=</a> <a id="9712" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>
    <a id="9722" href="Test.Golden.html#9649" class="Function">hasFailed</a> <a id="9732" class="Symbol">(</a><a id="9733" href="System.Exit.Primitive.html#450" class="InductiveConstructor">ExitFailure</a> <a id="9745" href="Test.Golden.html#9745" class="Bound">code</a><a id="9749" class="Symbol">)</a> <a id="9751" class="Symbol">=</a> <a id="9753" href="Test.Golden.html#9745" class="Bound">code</a> <a id="9758" href="Data.Integer.Base.html#2610" class="Function Operator">ℤ.≤ᵇ</a> <a id="9763" href="Agda.Builtin.Int.html#246" class="InductiveConstructor Operator">ℤ.+</a> <a id="9767" class="Number">0</a>

    <a id="9774" href="Test.Golden.html#9774" class="Function">mayOverwrite</a> <a id="9787" class="Symbol">:</a> <a id="9789" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="9795" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="9802" class="Symbol">→</a> <a id="9804" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="9811" class="Symbol">→</a> <a id="9813" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="9816" class="Symbol">_</a>
    <a id="9822" href="Test.Golden.html#9774" class="Function">mayOverwrite</a> <a id="9835" href="Test.Golden.html#9835" class="Bound">mexp</a> <a id="9840" href="Test.Golden.html#9840" class="Bound">out</a> <a id="9844" class="Symbol">=</a> <a id="9846" class="Keyword">do</a>
      <a id="9855" href="Function.Base.html#4062" class="Function Operator">case</a> <a id="9860" href="Test.Golden.html#9835" class="Bound">mexp</a> <a id="9865" href="Function.Base.html#4062" class="Function Operator">of</a> <a id="9868" class="Symbol">λ</a> <a id="9870" class="Keyword">where</a>
        <a id="9884" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="9892" class="Symbol">→</a> <a id="9894" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="9903" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="9905" href="Data.String.Base.html#2801" class="Function">unlines</a>
          <a id="9923" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="9925" class="String">&quot;Golden value missing. I computed the following result:&quot;</a>
          <a id="9992" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="9994" href="Test.Golden.html#9840" class="Bound">out</a>
          <a id="10008" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10010" class="String">&quot;Accept new golden value? [y/N]&quot;</a>
          <a id="10053" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10055" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>
        <a id="10066" class="Symbol">(</a><a id="10067" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="10072" href="Test.Golden.html#10072" class="Bound">exp</a><a id="10075" class="Symbol">)</a> <a id="10077" class="Symbol">→</a> <a id="10079" class="Keyword">do</a>
          <a id="10092" href="Test.Golden.html#10092" class="Bound">code</a> <a id="10097" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="10099" href="System.Process.html#735" class="Function">system</a> <a id="10106" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="10108" href="Data.String.Base.html#2588" class="Function">concat</a>
            <a id="10127" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="10129" class="String">&quot;git diff --no-index --exit-code --word-diff=color &quot;</a>
            <a id="10194" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10196" href="Test.Golden.html#7278" class="Bound">testPath</a> <a id="10205" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10207" class="String">&quot;/expected &quot;</a>
            <a id="10232" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10234" href="Test.Golden.html#7278" class="Bound">testPath</a> <a id="10243" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10245" class="String">&quot;/output&quot;</a>
            <a id="10267" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10269" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>
          <a id="10282" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="10291" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="10293" href="Data.String.Base.html#2801" class="Function">unlines</a>
            <a id="10313" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="10315" class="String">&quot;Golden value differs from actual value.&quot;</a>
            <a id="10369" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10371" class="Symbol">(</a><a id="10372" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="10375" href="Test.Golden.html#9649" class="Function">hasFailed</a> <a id="10385" href="Test.Golden.html#10092" class="Bound">code</a> <a id="10390" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="10395" href="Test.Golden.html#9540" class="Function">expVsOut</a> <a id="10404" href="Test.Golden.html#10072" class="Bound">exp</a> <a id="10408" href="Test.Golden.html#9840" class="Bound">out</a> <a id="10412" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="10417" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="10419" class="Symbol">)</a>
            <a id="10433" href="Data.List.Base.html#1943" class="Function Operator">++</a> <a id="10436" class="String">&quot;Accept actual value as new golden value? [y/N]&quot;</a>
            <a id="10497" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10499" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

      <a id="10509" href="Test.Golden.html#10509" class="Bound">b</a> <a id="10511" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="10513" href="Test.Golden.html#9245" class="Function">getAnswer</a>
      <a id="10529" href="IO.Base.html#3334" class="Function">when</a> <a id="10534" href="Test.Golden.html#10509" class="Bound">b</a> <a id="10536" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="10538" href="IO.Finite.html#1276" class="Function">writeFile</a> <a id="10548" class="Symbol">(</a><a id="10549" href="Test.Golden.html#7278" class="Bound">testPath</a> <a id="10558" href="Data.String.Base.html#2400" class="Function Operator">String.++</a> <a id="10568" class="String">&quot;/expected&quot;</a><a id="10579" class="Symbol">)</a> <a id="10581" href="Test.Golden.html#9840" class="Bound">out</a>

    <a id="10590" href="Test.Golden.html#10590" class="Function">printTiming</a> <a id="10602" class="Symbol">:</a> <a id="10604" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a> <a id="10609" class="Symbol">→</a> <a id="10611" href="System.Clock.html#1932" class="Record">Time</a> <a id="10616" class="Symbol">→</a> <a id="10618" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="10625" class="Symbol">→</a> <a id="10627" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="10630" class="Symbol">_</a>
    <a id="10636" href="Test.Golden.html#10590" class="Function">printTiming</a> <a id="10648" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a> <a id="10654" class="Symbol">_</a>    <a id="10659" href="Test.Golden.html#10659" class="Bound">msg</a> <a id="10663" class="Symbol">=</a> <a id="10665" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="10674" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="10676" href="Data.String.Base.html#2588" class="Function">concat</a> <a id="10683" class="Symbol">(</a><a id="10684" href="Test.Golden.html#7278" class="Bound">testPath</a> <a id="10693" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10695" class="String">&quot;: &quot;</a> <a id="10700" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10702" href="Test.Golden.html#10659" class="Bound">msg</a> <a id="10706" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10708" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="10710" class="Symbol">)</a>
    <a id="10716" href="Test.Golden.html#10590" class="Function">printTiming</a> <a id="10728" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>  <a id="10734" href="Test.Golden.html#10734" class="Bound">time</a> <a id="10739" href="Test.Golden.html#10739" class="Bound">msg</a> <a id="10743" class="Symbol">=</a>
      <a id="10751" class="Keyword">let</a> <a id="10755" href="Test.Golden.html#10755" class="Bound">time</a>  <a id="10761" class="Symbol">=</a> <a id="10763" href="Data.Nat.Show.html#1972" class="Function">ℕ.show</a> <a id="10770" class="Symbol">(</a><a id="10771" href="Test.Golden.html#10734" class="Bound">time</a> <a id="10776" class="Symbol">.</a><a id="10777" href="System.Clock.html#1978" class="Field">seconds</a><a id="10784" class="Symbol">)</a> <a id="10786" href="Data.String.Base.html#2400" class="Function Operator">String.++</a> <a id="10796" class="String">&quot;s&quot;</a>
          <a id="10810" href="Test.Golden.html#10810" class="Bound">spent</a> <a id="10816" class="Symbol">=</a> <a id="10818" class="Number">9</a> <a id="10820" href="Agda.Builtin.Nat.html#319" class="Primitive Operator">+</a> <a id="10822" href="Data.List.Base.html#4992" class="Function">List.sum</a> <a id="10831" class="Symbol">(</a><a id="10832" href="Data.List.Base.html#1620" class="Function">List.map</a> <a id="10841" href="Data.String.Base.html#2464" class="Function">String.length</a> <a id="10855" class="Symbol">(</a><a id="10856" href="Test.Golden.html#7278" class="Bound">testPath</a> <a id="10865" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10867" href="Test.Golden.html#10755" class="Bound">time</a> <a id="10872" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="10874" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="10876" class="Symbol">))</a>
               <a id="10894" class="Comment">-- ^ hack: both &quot;success&quot; and &quot;FAILURE&quot; have the same length</a>
               <a id="10970" class="Comment">--   can&#39;t use `String.length msg` because the msg contains escape codes</a>
          <a id="11053" href="Test.Golden.html#11053" class="Bound">pad</a>   <a id="11059" class="Symbol">=</a> <a id="11061" href="Data.String.Base.html#2515" class="Function">String.replicate</a> <a id="11078" class="Symbol">(</a><a id="11079" class="Number">72</a> <a id="11082" href="Data.Nat.Base.html#3211" class="Primitive Operator">∸</a> <a id="11084" href="Test.Golden.html#10810" class="Bound">spent</a><a id="11089" class="Symbol">)</a> <a id="11091" class="String">&#39; &#39;</a>
      <a id="11101" class="Keyword">in</a> <a id="11104" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="11113" class="Symbol">(</a><a id="11114" href="Data.String.Base.html#2588" class="Function">concat</a> <a id="11121" class="Symbol">(</a><a id="11122" href="Test.Golden.html#7278" class="Bound">testPath</a> <a id="11131" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="11133" class="String">&quot;: &quot;</a> <a id="11138" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="11140" href="Test.Golden.html#10739" class="Bound">msg</a> <a id="11144" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="11146" href="Test.Golden.html#11053" class="Bound">pad</a> <a id="11150" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="11152" href="Test.Golden.html#10755" class="Bound">time</a> <a id="11157" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="11159" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="11161" class="Symbol">))</a>

<a id="11165" class="Comment">-- A test pool is characterised by</a>
<a id="11200" class="Comment">--  + a name</a>
<a id="11213" class="Comment">--  + and a list of directory paths</a>
<a id="11249" class="Keyword">record</a> <a id="TestPool"></a><a id="11256" href="Test.Golden.html#11256" class="Record">TestPool</a> <a id="11265" class="Symbol">:</a> <a id="11267" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="11271" class="Keyword">where</a>
  <a id="11279" class="Keyword">constructor</a> <a id="mkTestPool"></a><a id="11291" href="Test.Golden.html#11291" class="InductiveConstructor">mkTestPool</a>
  <a id="11304" class="Keyword">field</a>
    <a id="TestPool.poolName"></a><a id="11314" href="Test.Golden.html#11314" class="Field">poolName</a> <a id="11323" class="Symbol">:</a> <a id="11325" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
    <a id="TestPool.testCases"></a><a id="11336" href="Test.Golden.html#11336" class="Field">testCases</a> <a id="11346" class="Symbol">:</a> <a id="11348" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="11353" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
<a id="11360" class="Keyword">open</a> <a id="11365" href="Test.Golden.html#11256" class="Module">TestPool</a>

<a id="11375" class="Keyword">module</a> <a id="Summary"></a><a id="11382" href="Test.Golden.html#11382" class="Module">Summary</a> <a id="11390" class="Keyword">where</a>

  <a id="11399" class="Comment">-- The summary of a test pool run</a>
  <a id="11435" class="Keyword">record</a> <a id="Summary.Summary"></a><a id="11442" href="Test.Golden.html#11442" class="Record">Summary</a> <a id="11450" class="Symbol">:</a> <a id="11452" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="11456" class="Keyword">where</a>
    <a id="11466" class="Keyword">constructor</a> <a id="Summary.mkSummary"></a><a id="11478" href="Test.Golden.html#11478" class="InductiveConstructor">mkSummary</a>
    <a id="11492" class="Keyword">field</a>
      <a id="Summary.Summary.success"></a><a id="11504" href="Test.Golden.html#11504" class="Field">success</a> <a id="11512" class="Symbol">:</a> <a id="11514" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="11519" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
      <a id="Summary.Summary.failure"></a><a id="11532" href="Test.Golden.html#11532" class="Field">failure</a> <a id="11540" class="Symbol">:</a> <a id="11542" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="11547" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
  <a id="11556" class="Keyword">open</a> <a id="11561" href="Test.Golden.html#11442" class="Module">Summary</a> <a id="11569" class="Keyword">public</a>

  <a id="Summary.init"></a><a id="11579" href="Test.Golden.html#11579" class="Function">init</a> <a id="11584" class="Symbol">:</a> <a id="11586" href="Test.Golden.html#11442" class="Record">Summary</a>
  <a id="11596" href="Test.Golden.html#11579" class="Function">init</a> <a id="11601" class="Symbol">=</a> <a id="11603" href="Test.Golden.html#11478" class="InductiveConstructor">mkSummary</a> <a id="11613" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="11616" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

  <a id="Summary.merge"></a><a id="11622" href="Test.Golden.html#11622" class="Function">merge</a> <a id="11628" class="Symbol">:</a> <a id="11630" href="Test.Golden.html#11442" class="Record">Summary</a> <a id="11638" class="Symbol">→</a> <a id="11640" href="Test.Golden.html#11442" class="Record">Summary</a> <a id="11648" class="Symbol">→</a> <a id="11650" href="Test.Golden.html#11442" class="Record">Summary</a>
  <a id="11660" href="Test.Golden.html#11622" class="Function">merge</a> <a id="11666" class="Symbol">(</a><a id="11667" href="Test.Golden.html#11478" class="InductiveConstructor">mkSummary</a> <a id="11677" href="Test.Golden.html#11677" class="Bound">ws1</a> <a id="11681" href="Test.Golden.html#11681" class="Bound">ls1</a><a id="11684" class="Symbol">)</a> <a id="11686" class="Symbol">(</a><a id="11687" href="Test.Golden.html#11478" class="InductiveConstructor">mkSummary</a> <a id="11697" href="Test.Golden.html#11697" class="Bound">ws2</a> <a id="11701" href="Test.Golden.html#11701" class="Bound">ls2</a><a id="11704" class="Symbol">)</a> <a id="11706" class="Symbol">=</a>
   <a id="11711" href="Test.Golden.html#11478" class="InductiveConstructor">mkSummary</a> <a id="11721" class="Symbol">(</a><a id="11722" href="Test.Golden.html#11697" class="Bound">ws2</a> <a id="11726" href="Data.List.Base.html#1943" class="Function Operator">++</a> <a id="11729" href="Test.Golden.html#11677" class="Bound">ws1</a><a id="11732" class="Symbol">)</a> <a id="11734" class="Symbol">(</a><a id="11735" href="Test.Golden.html#11701" class="Bound">ls2</a> <a id="11739" href="Data.List.Base.html#1943" class="Function Operator">++</a> <a id="11742" href="Test.Golden.html#11681" class="Bound">ls1</a><a id="11745" class="Symbol">)</a>

  <a id="Summary.update"></a><a id="11750" href="Test.Golden.html#11750" class="Function">update</a> <a id="11757" class="Symbol">:</a> <a id="11759" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="11764" href="Test.Golden.html#7127" class="Function">Result</a> <a id="11771" class="Symbol">→</a> <a id="11773" href="Test.Golden.html#11442" class="Record">Summary</a> <a id="11781" class="Symbol">→</a> <a id="11783" href="Test.Golden.html#11442" class="Record">Summary</a>
  <a id="11793" href="Test.Golden.html#11750" class="Function">update</a> <a id="11800" href="Test.Golden.html#11800" class="Bound">res</a> <a id="11804" href="Test.Golden.html#11804" class="Bound">sum</a> <a id="11808" class="Symbol">=</a>
    <a id="11814" class="Keyword">let</a> <a id="11818" class="Symbol">(</a><a id="11819" href="Test.Golden.html#11819" class="Bound">ls2</a> <a id="11823" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="11825" href="Test.Golden.html#11825" class="Bound">ws2</a><a id="11828" class="Symbol">)</a> <a id="11830" class="Symbol">=</a> <a id="11832" href="Data.List.Base.html#3893" class="Function">partitionSums</a> <a id="11846" href="Test.Golden.html#11800" class="Bound">res</a> <a id="11850" class="Keyword">in</a>
    <a id="11857" href="Test.Golden.html#11622" class="Function">merge</a> <a id="11863" href="Test.Golden.html#11804" class="Bound">sum</a> <a id="11867" class="Symbol">(</a><a id="11868" href="Test.Golden.html#11478" class="InductiveConstructor">mkSummary</a> <a id="11878" href="Test.Golden.html#11825" class="Bound">ws2</a> <a id="11882" href="Test.Golden.html#11819" class="Bound">ls2</a><a id="11885" class="Symbol">)</a>

<a id="11888" class="Keyword">open</a> <a id="11893" href="Test.Golden.html#11382" class="Module">Summary</a> <a id="11901" class="Keyword">using</a> <a id="11907" class="Symbol">(</a><a id="11908" href="Test.Golden.html#11442" class="Record">Summary</a><a id="11915" class="Symbol">)</a> <a id="11917" class="Keyword">hiding</a> <a id="11924" class="Symbol">(</a><a id="11925" class="Keyword">module</a> <a id="11932" href="Test.Golden.html#11442" class="Module">Summary</a><a id="11939" class="Symbol">)</a>

<a id="11942" class="Comment">-- Only keep the tests that have been asked for</a>
<a id="filterTests"></a><a id="11990" href="Test.Golden.html#11990" class="Function">filterTests</a> <a id="12002" class="Symbol">:</a> <a id="12004" href="Test.Golden.html#4413" class="Record">Options</a> <a id="12012" class="Symbol">→</a> <a id="12014" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="12019" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="12026" class="Symbol">→</a> <a id="12028" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="12033" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
<a id="12040" href="Test.Golden.html#11990" class="Function">filterTests</a> <a id="12052" href="Test.Golden.html#12052" class="Bound">opts</a> <a id="12057" class="Symbol">=</a> <a id="12059" href="Function.Base.html#4062" class="Function Operator">case</a> <a id="12064" href="Test.Golden.html#4566" class="Field">onlyNames</a> <a id="12074" href="Test.Golden.html#12052" class="Bound">opts</a> <a id="12079" href="Function.Base.html#4062" class="Function Operator">of</a> <a id="12082" class="Symbol">λ</a> <a id="12084" class="Keyword">where</a>
  <a id="12092" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="12095" class="Symbol">→</a> <a id="12097" href="Function.Base.html#704" class="Function">id</a>
  <a id="12102" href="Test.Golden.html#12102" class="CatchallClause Bound">xs</a> <a id="12105" class="Symbol">→</a> <a id="12107" class="Keyword">let</a> <a id="12111" href="Test.Golden.html#12111" class="Bound">names</a> <a id="12117" class="Symbol">=</a> <a id="12119" href="Data.List.Base.html#1620" class="Function">List.map</a> <a id="12128" href="Data.String.Base.html#1533" class="Primitive">String.toList</a> <a id="12142" href="Test.Golden.html#12102" class="Bound">xs</a> <a id="12145" class="Keyword">in</a>
       <a id="12155" href="Data.List.Base.html#11417" class="Function">filter</a> <a id="12162" class="Symbol">(λ</a> <a id="12165" href="Test.Golden.html#12165" class="Bound">n</a> <a id="12167" class="Symbol">→</a> <a id="12169" href="Data.List.Relation.Unary.Any.html#2680" class="Function">any?</a> <a id="12174" class="Symbol">(λ</a> <a id="12177" href="Test.Golden.html#12177" class="Bound">m</a> <a id="12179" class="Symbol">→</a> <a id="12181" href="Data.List.Relation.Binary.Infix.Heterogeneous.Properties.html#6668" class="Function">infix?</a> <a id="12188" href="Data.Char.Properties.html#1575" class="Function Operator">Char._≟_</a> <a id="12197" href="Test.Golden.html#12177" class="Bound">m</a> <a id="12199" class="Symbol">(</a><a id="12200" href="Data.String.Base.html#1533" class="Primitive">String.toList</a> <a id="12214" href="Test.Golden.html#12165" class="Bound">n</a><a id="12215" class="Symbol">))</a> <a id="12218" href="Test.Golden.html#12111" class="Bound">names</a><a id="12223" class="Symbol">)</a>

<a id="poolRunner"></a><a id="12226" href="Test.Golden.html#12226" class="Function">poolRunner</a> <a id="12237" class="Symbol">:</a> <a id="12239" href="Test.Golden.html#4413" class="Record">Options</a> <a id="12247" class="Symbol">→</a> <a id="12249" href="Test.Golden.html#11256" class="Record">TestPool</a> <a id="12258" class="Symbol">→</a> <a id="12260" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="12263" href="Test.Golden.html#11442" class="Record">Summary</a>
<a id="12271" href="Test.Golden.html#12226" class="Function">poolRunner</a> <a id="12282" href="Test.Golden.html#12282" class="Bound">opts</a> <a id="12287" href="Test.Golden.html#12287" class="Bound">pool</a> <a id="12292" class="Symbol">=</a> <a id="12294" class="Keyword">do</a>
  <a id="12299" class="Comment">-- check there is a non-empty list of tests we want to run</a>
  <a id="12360" class="Keyword">let</a> <a id="12364" href="Test.Golden.html#12364" class="Bound">tests</a> <a id="12370" class="Symbol">=</a> <a id="12372" href="Test.Golden.html#11990" class="Function">filterTests</a> <a id="12384" href="Test.Golden.html#12282" class="Bound">opts</a> <a id="12389" class="Symbol">(</a><a id="12390" href="Test.Golden.html#12287" class="Bound">pool</a> <a id="12395" class="Symbol">.</a><a id="12396" href="Test.Golden.html#11336" class="Field">testCases</a><a id="12405" class="Symbol">)</a>
  <a id="12409" class="Symbol">(_</a> <a id="12412" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="12414" class="Symbol">_)</a> <a id="12417" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="12419" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="12424" href="Test.Golden.html#12364" class="Bound">tests</a>
    <a id="12434" class="Keyword">where</a> <a id="12440" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="12443" class="Symbol">→</a> <a id="12445" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="12450" href="Test.Golden.html#11579" class="Function">Summary.init</a>

  <a id="12466" class="Comment">-- announce the test pool and run them</a>
  <a id="12507" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="12516" href="Test.Golden.html#12621" class="Function">banner</a>
  <a id="12525" href="Test.Golden.html#12751" class="Function">loop</a> <a id="12530" href="Test.Golden.html#11579" class="Function">Summary.init</a> <a id="12543" href="Test.Golden.html#12364" class="Bound">tests</a>

  <a id="12552" class="Keyword">where</a>

  <a id="12561" href="Test.Golden.html#12561" class="Function">separator</a> <a id="12571" class="Symbol">:</a> <a id="12573" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
  <a id="12582" href="Test.Golden.html#12561" class="Function">separator</a> <a id="12592" class="Symbol">=</a> <a id="12594" href="Data.String.Base.html#2515" class="Function">String.replicate</a> <a id="12611" class="Number">72</a> <a id="12614" class="String">&#39;-&#39;</a>

  <a id="12621" href="Test.Golden.html#12621" class="Function">banner</a> <a id="12628" class="Symbol">:</a> <a id="12630" href="Agda.Builtin.String.html#318" class="Postulate">String</a>
  <a id="12639" href="Test.Golden.html#12621" class="Function">banner</a> <a id="12646" class="Symbol">=</a> <a id="12648" href="Data.String.Base.html#2801" class="Function">unlines</a>
         <a id="12665" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="12667" class="String">&quot;&quot;</a> <a id="12670" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="12672" href="Test.Golden.html#12561" class="Function">separator</a>
         <a id="12691" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="12693" href="Test.Golden.html#12287" class="Bound">pool</a> <a id="12698" class="Symbol">.</a><a id="12699" href="Test.Golden.html#11314" class="Field">poolName</a>
         <a id="12717" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="12719" href="Test.Golden.html#12561" class="Function">separator</a> <a id="12729" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="12731" class="String">&quot;&quot;</a>
         <a id="12743" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="12745" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

  <a id="12751" href="Test.Golden.html#12751" class="Function">loop</a> <a id="12756" class="Symbol">:</a> <a id="12758" href="Test.Golden.html#11442" class="Record">Summary</a> <a id="12766" class="Symbol">→</a> <a id="12768" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="12773" href="Agda.Builtin.String.html#318" class="Postulate">String</a> <a id="12780" class="Symbol">→</a> <a id="12782" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="12785" href="Test.Golden.html#11442" class="Record">Summary</a>
  <a id="12795" href="Test.Golden.html#12751" class="Function">loop</a> <a id="12800" href="Test.Golden.html#12800" class="Bound">acc</a> <a id="12804" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a> <a id="12807" class="Symbol">=</a> <a id="12809" href="IO.Base.html#1249" class="InductiveConstructor">pure</a> <a id="12814" href="Test.Golden.html#12800" class="Bound">acc</a>
  <a id="12820" href="Test.Golden.html#12751" class="Function">loop</a> <a id="12825" href="Test.Golden.html#12825" class="Bound">acc</a> <a id="12829" class="Symbol">(</a><a id="12830" href="Test.Golden.html#12830" class="Bound">test</a> <a id="12835" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="12837" href="Test.Golden.html#12837" class="Bound">tests</a><a id="12842" class="Symbol">)</a> <a id="12844" class="Symbol">=</a> <a id="12846" class="Keyword">do</a>
    <a id="12853" href="Test.Golden.html#12853" class="Bound">res</a> <a id="12857" href="IO.Base.html#2084" class="Function Operator">&lt;-</a> <a id="12860" href="Test.Golden.html#7226" class="Function">runTest</a> <a id="12868" href="Test.Golden.html#12282" class="Bound">opts</a> <a id="12873" href="Test.Golden.html#12830" class="Bound">test</a>
    <a id="12882" href="Test.Golden.html#12751" class="Function">loop</a> <a id="12887" class="Symbol">(</a><a id="12888" href="Test.Golden.html#11750" class="Function">Summary.update</a> <a id="12903" class="Symbol">(</a><a id="12904" href="Test.Golden.html#12853" class="Bound">res</a> <a id="12908" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="12910" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="12912" class="Symbol">)</a> <a id="12914" href="Test.Golden.html#12825" class="Bound">acc</a><a id="12917" class="Symbol">)</a> <a id="12919" href="Test.Golden.html#12837" class="Bound">tests</a>

<a id="runner"></a><a id="12926" href="Test.Golden.html#12926" class="Function">runner</a> <a id="12933" class="Symbol">:</a> <a id="12935" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="12940" href="Test.Golden.html#11256" class="Record">TestPool</a> <a id="12949" class="Symbol">→</a> <a id="12951" href="IO.Base.html#1180" class="Datatype">IO</a> <a id="12954" href="Agda.Builtin.Unit.html#158" class="Record">⊤</a>
<a id="12956" href="Test.Golden.html#12926" class="Function">runner</a> <a id="12963" href="Test.Golden.html#12963" class="Bound">tests</a> <a id="12969" class="Symbol">=</a> <a id="12971" class="Keyword">do</a>
  <a id="12976" class="Comment">-- figure out the options</a>
  <a id="13004" href="Test.Golden.html#13004" class="Bound">args</a> <a id="13009" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="13011" href="System.Environment.html#660" class="Function">getArgs</a>
  <a id="13021" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="13026" href="Test.Golden.html#13026" class="Bound">opts</a> <a id="13031" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="13033" href="Test.Golden.html#5601" class="Function">options</a> <a id="13041" href="Test.Golden.html#13004" class="Bound">args</a>
    <a id="13050" class="Keyword">where</a> <a id="13056" href="Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="13061" href="Test.Golden.html#13061" class="Bound">err</a> <a id="13065" class="Symbol">→</a> <a id="13067" href="System.Exit.html#1366" class="Function">die</a> <a id="13071" class="Symbol">(</a><a id="13072" href="Data.String.Base.html#2801" class="Function">unlines</a> <a id="13080" class="Symbol">(</a><a id="13081" href="Test.Golden.html#5414" class="Function">show</a> <a id="13086" href="Test.Golden.html#13061" class="Bound">err</a> <a id="13090" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="13092" href="Test.Golden.html#5118" class="Function">usage</a> <a id="13098" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="13100" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a><a id="13102" class="Symbol">))</a>

  <a id="13108" class="Comment">-- run the tests</a>
  <a id="13127" href="Test.Golden.html#13127" class="Bound">ress</a> <a id="13132" href="IO.Base.html#2084" class="Function Operator">←</a> <a id="13134" href="IO.html#2045" class="Function">List.mapM</a> <a id="13144" class="Symbol">(</a><a id="13145" href="Test.Golden.html#12226" class="Function">poolRunner</a> <a id="13156" href="Test.Golden.html#13026" class="Bound">opts</a><a id="13160" class="Symbol">)</a> <a id="13162" href="Test.Golden.html#12963" class="Bound">tests</a>
  <a id="13170" class="Keyword">let</a> <a id="13174" class="Keyword">open</a> <a id="13179" href="Test.Golden.html#11382" class="Module">Summary</a>
  <a id="13189" class="Keyword">let</a> <a id="13193" href="Test.Golden.html#13193" class="Bound">res</a> <a id="13197" class="Symbol">=</a> <a id="13199" href="Data.List.Base.html#4426" class="Function">List.foldl</a> <a id="13210" href="Test.Golden.html#11622" class="Function">merge</a> <a id="13216" href="Test.Golden.html#11579" class="Function">init</a> <a id="13221" href="Test.Golden.html#13127" class="Bound">ress</a>

  <a id="13229" class="Comment">-- report the result</a>
  <a id="13252" class="Keyword">let</a> <a id="13256" href="Test.Golden.html#13256" class="Bound">nsucc</a> <a id="13262" class="Symbol">=</a> <a id="13264" href="Data.List.Base.html#5072" class="Function">List.length</a> <a id="13276" class="Symbol">(</a><a id="13277" href="Test.Golden.html#13193" class="Bound">res</a> <a id="13281" class="Symbol">.</a><a id="13282" href="Test.Golden.html#11504" class="Field">success</a><a id="13289" class="Symbol">)</a>
  <a id="13293" class="Keyword">let</a> <a id="13297" href="Test.Golden.html#13297" class="Bound">nfail</a> <a id="13303" class="Symbol">=</a> <a id="13305" href="Data.List.Base.html#5072" class="Function">List.length</a> <a id="13317" class="Symbol">(</a><a id="13318" href="Test.Golden.html#13193" class="Bound">res</a> <a id="13322" class="Symbol">.</a><a id="13323" href="Test.Golden.html#11532" class="Field">failure</a><a id="13330" class="Symbol">)</a>
  <a id="13334" class="Keyword">let</a> <a id="13338" href="Test.Golden.html#13338" class="Bound">ntotal</a> <a id="13345" class="Symbol">=</a> <a id="13347" href="Test.Golden.html#13256" class="Bound">nsucc</a> <a id="13353" href="Agda.Builtin.Nat.html#319" class="Primitive Operator">+</a> <a id="13355" href="Test.Golden.html#13297" class="Bound">nfail</a>
  <a id="13363" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="13372" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="13374" href="Data.String.Base.html#2588" class="Function">concat</a> <a id="13381" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="13383" href="Data.Nat.Show.html#1972" class="Function">ℕ.show</a> <a id="13390" href="Test.Golden.html#13256" class="Bound">nsucc</a> <a id="13396" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="13398" class="String">&quot;/&quot;</a> <a id="13402" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="13404" href="Data.Nat.Show.html#1972" class="Function">ℕ.show</a> <a id="13411" href="Test.Golden.html#13338" class="Bound">ntotal</a> <a id="13418" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="13420" class="String">&quot; tests successful&quot;</a> <a id="13440" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="13442" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

  <a id="13448" class="Comment">-- deal with failures</a>
  <a id="13472" class="Keyword">let</a> <a id="13476" href="Test.Golden.html#13476" class="Bound">list</a> <a id="13481" class="Symbol">=</a> <a id="13483" href="Data.String.Base.html#2801" class="Function">unlines</a> <a id="13491" class="Symbol">(</a><a id="13492" href="Test.Golden.html#13193" class="Bound">res</a> <a id="13496" class="Symbol">.</a><a id="13497" href="Test.Golden.html#11532" class="Field">failure</a><a id="13504" class="Symbol">)</a>
  <a id="13508" href="IO.Base.html#3334" class="Function">when</a> <a id="13513" class="Symbol">(</a><a id="13514" class="Number">0</a> <a id="13516" href="Data.Nat.Base.html#1310" class="Primitive Operator">&lt;ᵇ</a> <a id="13519" href="Test.Golden.html#13297" class="Bound">nfail</a><a id="13524" class="Symbol">)</a> <a id="13526" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="13528" class="Keyword">do</a>
    <a id="13535" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="13544" class="String">&quot;Failing tests:&quot;</a>
    <a id="13565" href="IO.Finite.html#1506" class="Function">putStrLn</a> <a id="13574" href="Test.Golden.html#13476" class="Bound">list</a>
  <a id="13581" href="IO.Base.html#3457" class="Function">whenJust</a> <a id="13590" class="Symbol">(</a><a id="13591" href="Test.Golden.html#13026" class="Bound">opts</a> <a id="13596" class="Symbol">.</a><a id="13597" href="Test.Golden.html#4791" class="Field">failureFile</a><a id="13608" class="Symbol">)</a> <a id="13610" href="Function.Base.html#2003" class="Function Operator">$</a> <a id="13612" class="Symbol">λ</a> <a id="13614" href="Test.Golden.html#13614" class="Bound">fp</a> <a id="13617" class="Symbol">→</a> <a id="13619" href="IO.Finite.html#1276" class="Function">writeFile</a> <a id="13629" href="Test.Golden.html#13614" class="Bound">fp</a> <a id="13632" href="Test.Golden.html#13476" class="Bound">list</a>

  <a id="13640" class="Comment">-- exit</a>
  <a id="13650" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="13653" class="Number">0</a> <a id="13655" href="Data.Nat.Base.html#1136" class="Primitive Operator">≡ᵇ</a> <a id="13658" href="Test.Golden.html#13297" class="Bound">nfail</a>
   <a id="13667" href="Data.Bool.Base.html#1292" class="Function Operator">then</a> <a id="13672" href="System.Exit.html#1311" class="Function">exitSuccess</a>
   <a id="13687" href="Data.Bool.Base.html#1292" class="Function Operator">else</a> <a id="13692" href="System.Exit.html#1248" class="Function">exitFailure</a>
</pre></body></html>